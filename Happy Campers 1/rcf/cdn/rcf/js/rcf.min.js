/*! RCF (2.0.62) UGLY: "2015-01-26 Monday, 4:09:13 PM" */ 
!function(a,b){b.RCF=b.RCF||{},RCF.ActivityView=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(a){if(RCF.Utils.isEmpty(a))throw"Empty / Invalid activity div passed to Activity View constructor";var b=this;this.$activity=a,this.$jPlayer=null,this.id=a[0].id,this.markedBehaviors=[],this.unmarkedBehaviors=[],Math.seedrandom(this.id);try{this._setupActivityAudioPlayer()}catch(c){alert("Error setting up jPlayer instance for activity ["+this.id+"]\n\n"+c)}try{this._createUnmarkedBehaviors()}catch(c){alert("Error creating unmarked behaviors for activity ["+this.id+"]\n\n"+c)}try{this._createMarkedBehaviors()}catch(c){alert("Error creating marked behaviors for activity ["+this.id+"]\n\n"+c)}var d=null;d=this.$activity.find("[data-rcfinteraction]:not(.example)"),d=d.filter("[data-rcfinteraction!=videoElement]"),d=d.filter("[data-rcfinteraction!=flashObject]"),d=d.filter("[data-rcfinteraction!=audioElement]"),d=d.filter("[data-rcfinteraction!=inlineAudioElement]"),d=d.filter("[data-rcfinteraction!=unmarkedTextInput]"),d=d.filter("[data-rcfinteraction!=flashcard]"),d=d.filter("[data-rcfinteraction!=interactiveImage]"),d=d.filter("[data-rcfinteraction!=carousel]"),d=d.filter("[data-rcfinteraction!=simpleCarousel]"),this.$answerableObjects=d,this.answerIndex=null,RCF.subscribe("rcf.new.carousel.page",function(){b.answerIndex=null});try{this._setupTextAreas()}catch(c){alert("Error initializing text areas for activity ["+this.id+"]\n\n"+c)}if("mobile"!=RCF.Application.getDeviceMode())try{this._setupBlockHeights()}catch(c){alert("Error setting block equalised heights for activity ["+this.id+"]\n\n"+c)}try{this._setupMobileSortables()}catch(c){alert("Error setting block equalised heights for activity ["+this.id+"]\n\n"+c)}try{this._setupLastChild()}catch(c){alert("Error setting up last child for activity ["+this.id+"]\n\n"+c)}},_setupTextAreas:function(){var b=this.$activity,c=null;if("function"==typeof a.fn.autosize&&(c=b.find("textarea"),c.length>0))try{c.autosize()}catch(d){alert("Error autosizing the TextAreas for activity ["+this.id+"] \n\n"+d)}},_setupBlockHeights:function(){var b=this.$activity,c=b.find("[data-equaliseheight='y']");RCF.Utils.isEmpty(c)||c.each(function(){var b=a(this).children("div.block"),c=Math.max.apply(Math,b.map(function(){try{return parseInt(a(this).height())}catch(b){return 1}}).get());b.css("min-height",c+"px")})},_setupActivityAudioPlayer:function(){var c=this.$activity.find(".activityJPlayer"),d=this,e=this.$activity.attr("data-levelassetsurl")+"/audio/";d.audioQueue=[],d.audioCallback=null,c.length<1||(this.$jPlayer=a(c[0]),this.originalAudioID=null,this.$jPlayer.jPlayer({ready:function(){},supplied:"mp3",swfPath:RCF.options.swfFallbackURL,ended:function(){d.$activity.find("[data-audiolinkid='"+d.originalAudioID+"']").find(".inlinePlayer").removeClass("playing"),d.audioQueue.length>0?(d.$jPlayer.jPlayer("setMedia",{mp3:e+d.audioQueue.shift()}),d.$jPlayer.jPlayer("play")):d.audioCallback&&(d.audioCallback.apply(),d.audioCallback=null)}}).on(a.jPlayer.event.ended,function(){d.$activity.find("[data-audiolinkid='"+d.originalAudioID+"']").find(".inlinePlayer").removeClass("playing")}),this.$activity.on("rcf.play.audio",function(c,f){if(!f)return void(b.console&&console.log("received audio play event for empty link"));var g=a(c.target).attr("data-audiolinkid");d.originalAudioID&&g!=d.originalAudioID&&d.$activity.find("[data-audiolinkid='"+d.originalAudioID+"']").find(".inlinePlayer").removeClass("playing"),d.originalAudioID=a(c.target).attr("data-audiolinkid"),d.$activity.find("[data-audiolinkid='"+d.originalAudioID+"']").find(".inlinePlayer").addClass("playing"),"string"==typeof f?d.audioQueue.push(f):"object"==typeof f&&(a.isArray(f.audio)&&(d.audioQueue=d.audioQueue.concat(f.audio)),f.onComplete&&(d.audioCallback=f.onComplete)),d.audioQueue&&d.audioQueue.length>0&&d.$jPlayer.jPlayer("setMedia",{mp3:e+d.audioQueue.shift()}).jPlayer("play")}),this.$activity.on("rcf.stop.audio",function(){d.audioQueue=[],d.originalAudioID&&(d.$activity.find("[data-audiolinkid='"+d.originalAudioID+"']").find(".inlinePlayer").removeClass("playing"),d.$jPlayer.jPlayer("stop"),d.originalAudioID=null)}),this.$activity.on("click","[data-audiolink]",function(){var b=a(this),c=b.attr("data-audiolink"),d=b.find(".inlinePlayer");d.hasClass("playing")?b.trigger("rcf.stop.audio"):c&&c.length>0&&b.trigger("rcf.play.audio",c)}))},_setupMobileSortables:function(){var b=this.$activity;"mobile"==RCF.Application.getDeviceMode()||"n"==this.$activity.attr("data-desktopdraggable")?b.find("[data-rcfinteraction='ordering']").each(function(){a(this).find(".horizontal.mobile-vertical").removeClass("horizontal").addClass("vertical"),a(this).find(".vertical.mobile-horizontal").removeClass("vertical").addClass("horizontal")}):b.find(".mobile-vertical,.mobile-horizontal").removeClass("mobile-vertical mobile-horizontal")},_createUnmarkedBehaviors:function(){var b=this.$activity,c=b.find("[data-rcfinteraction=flashObject]"),d=b.find("[data-rcfinteraction=interactiveText]"),e=b.find("[data-rcfinteraction=flashcard]"),f=b.find("[data-rcfinteraction=interactiveImage]"),g=b.find("[data-rcfinteraction=carousel]"),h=b.find("[data-rcfinteraction=simpleCarousel]"),i=b.find(".unmarkedTextInput"),j=b.find(".chase"),k=b.find("span.toggle"),l=b.find(".canDoList"),m=b.find(".collapsibleContainer"),n=b.find(".timedMarkupBlock"),o=b.find(".popupLink"),p=b.find("[data-rcfinteraction=hangman]"),q=b.find(".interactiveImageSet"),r=this;if(e.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.FlashcardContainer(b))}catch(s){alert("Error creating Flashcard Container elements\n\n"+s)}if(g.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.CarouselElements(g))}catch(s){alert("Error creating Carousel Elements\n\n"+s)}if(h.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.CarouselElements(h))}catch(s){alert("Error creating simple carousel Elements \n\n"+s)}var t=b.find("[data-rcfinteraction=audioElement]"),u=b.find("[data-rcfinteraction=videoElement]");if(t.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.AudioPlayer(t))}catch(s){alert("Error initializing Audio players for activity ["+r.id+"] \n\n"+s)}if(u.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.VideoPlayer(u))}catch(s){alert("Error initializing Video Players for activity ["+r.id+"]\n\n"+s)}if(c.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.FlashObject(c))}catch(s){alert("Error initializing Flash Objects for activity ["+r.id+"]\n\n"+s)}if(d.length>0&&d.each(function(){try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.InteractiveText(a(this)))}catch(b){alert("Error initializing interactive text block for activity ["+r.id+"] \n\n"+b)}}),k.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.ToggleElements(k))}catch(s){alert("Error initializing Toggle Elements for activity ["+r.id+"]\n\n"+s)}if(j.length>0&&j.each(function(){r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.Chase(a(this)))}),l.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.CanDo(b))}catch(s){alert("Error initializing CanDo Elements for activity [ "+r.id+"]\n\n"+s)}if(o.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.Popup(b))}catch(s){alert("Error initializing popup elements for activity ["+r.id+"]\n\n"+s)}if(m.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.CollapsibleBlock(m))}catch(s){alert("Error initializing collapsible blocks for activity ["+r.id+"]\n\n"+s)}if(n.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.TimedMarkupBlock(n))}catch(s){alert("Error creating timed block handlers")}if(i.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.TextInput(b))}catch(s){alert("Error initializing Unmarked TextInputs for activity ["+r.id+"]\n\n"+s)}if(p.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.Hangman(p))}catch(s){alert("Error creating hangman elements ! \n\n"+s)}if(f.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.InteractiveImages(f))}catch(s){alert("Error creating Interactive Images\n\n"+s)}if(q.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.InteractiveImageSets(q))}catch(s){alert("Error creating Interactive Imagesets\n\n"+s)}var v=b.find("[data-triggerable='y']");if(v.length>0)try{r.unmarkedBehaviors.push(new RCF.Behaviors.Unmarked.TriggerElements(v))}catch(s){alert("Error creating triggerable element handlers\n\n"+s)}},_createMarkedBehaviors:function(){var a=this.$activity,b=a.attr("data-behaviors")||"",c=a.attr("data-mobilebehaviors")||"",d=a.attr("data-desktopbehaviors")||"",e=(b+" "+c+" "+d).trim().replace("  "," ");if(e.length>0){e=RCF.Utils.distinctArray(e.trim().split(" "));try{for(var f=0,g=e.length;g>f;f++){var h=e[f];if(h.trim().length>0){var i=RCF.Behaviors.Marked[h];if(RCF.Utils.isEmpty(i)){alert("No RCF behavior defined for : "+h+" in activity : "+this.id);continue}var j=new RCF.Behaviors.Marked[h](this.$activity);RCF.Utils.isEmpty(j)?alert("No behavior type construct for XSL declared type : "+h):this.markedBehaviors.push(j)}}}catch(k){alert("Error creating marked behaviors ["+e+"]\n\n"+k)}}},_setupLastChild:function(){var a=this.$activity;a.find("div.rubric > *:not(.clear):last").addClass("lastChild"),a.find("> div:not(.clear)").last().addClass("lastChild"),a.find("div.main > div:not(.clear)").last().addClass("lastChild"),a.find("div.backgroundArea > div:last-child").addClass("lastChild"),a.find("div.interactiveText > *:not(.clear):last-child").addClass("lastChild"),a.find("div.blockSet > div.block:last-child").addClass("lastChild"),a.find("div.block > *:not(.clear):last-child").addClass("lastChild"),a.find("div.infoBlock > *:not(.clear):last-child"),a.find("div.locating_popup > span:last-child").addClass("lastChild"),a.find("td > p:last-child").addClass("lastChild"),a.find("th > p:last-child").addClass("lastChild")},showAnswers:function(b,c){if(RCF.Utils.isEmpty(b))throw"Empty AnswersObject passed to RCF [showAnswers]";if(b.id!=this.id)throw"Invalid JSON Answers provided for activity ["+this.id+"]\n\nAnswers provided were for activity ["+b.id+"]";var d=b.answers;if(!RCF.Utils.isEmpty(d)){RCF.Utils.isEmpty(c)&&(c=!1);for(var e=a.merge(a.merge([],this.markedBehaviors),this.unmarkedBehaviors),f=0,g=e.length;g>f;f++){var h=e[f];"function"==typeof h.showAnswers&&h.showAnswers(b,c)}}},showNextAnswer:function(c){var d=this;if(RCF.Utils.isEmpty(c))throw"Empty answers object passed to RCF [showNextAnswer]";if(c.id!=this.id)throw"Invalid JSON answers provided for RCF [showNextAnswer] - provided for activity ["+this.id+"]\n\nAnswers provided were for ["+c.id+"]";var e=c.answers;if(RCF.Utils.isEmpty(e)&&b.console)return console.log("No answers provided for 'showNextAnswer'"),!1;null===this.answerIndex&&this.resetAnswers(!0),this.answerIndex=this.answerIndex||0;var f=this.$answerableObjects;this.$activity.find(".rcfCarousel:not(.simple)").length>0&&(f=f.filter(function(){return a(this).closest(".owl-item.active").length>0}));var g=a(f[this.answerIndex]);if(this.answerIndex>f.length-1)return this.resetAnswers(!0),this.answerIndex=null,!0;if(RCF.Utils.isEmpty(g))return this.resetAnswers(!0),this.answerIndex=null,!1;for(var h=function(a,b,c,e){d.subAnswerIndex=d.subAnswerIndex||0,b.trigger("rcf.single.answer",[c,e]),d.subAnswerIndex++,d.subAnswerIndex>a-1&&(d.subAnswerIndex=0,d.answerIndex++)},i=g.attr("data-rcfid"),j=0;j<e.length;j++)if(e[j].elm==i){var k=null,l="",m=g.attr("data-rcfinteraction");if("categorise"==m){if(g.hasClass("radioTable")?k=g.find("table.radioTable .tableAnswerRow:not(.example)"):g.hasClass("draggable")||g.hasClass("touchable")?k=g.find(".wordBox li.dragItem:not(.distractor)"):g.hasClass("checkboxTable")?k=g.find("table.checkboxTable tr.tableAnswerRow[data-rcfid]:not(.distractor)"):g.hasClass("dropDown")?k=g.find(".categoriseDropDown:not(.example)"):g.hasClass("radioList")?k=g.find(".radioListCategoryItem:not(.example)"):g.hasClass("checkboxList")&&(k=g.find(".checkboxListCategoryItem:not(.distractor)")),!k)continue;l=a(k.get(this.subAnswerIndex)).attr("data-rcfid"),h(k.length,g,e[j],l)}else if("interactiveText"==m){if(g.hasClass("type_selectableCat")?k=a(a.map(e[j].value,function(a){return g.find("[data-rcfid='"+a.elm+"']")})):g.hasClass("type_selectableWords")?k=g.find(".selectable[data-catindex]:not(.example)"):g.hasClass("type_selectable")&&(k=a(a.map(e[j].value,function(a){return g.find("[data-rcfid='"+a+"']")}))),!k)continue;l=a(k.get(this.subAnswerIndex)).attr("data-rcfid"),h(k.length,g,e[j],l)}else"crossword"==m?(k=g.find(".crosswordClueContainer li[data-wordid]:not(.example)"),l=a(k.get(this.subAnswerIndex)).attr("data-wordid"),h(k.length,g,e[j],l)):"verticalCrossword"==m?(k=g.find(".vcLine:not(.example)"),l=a(k.get(this.subAnswerIndex)).attr("data-rcf-wordid"),h(k.length,g,e[j],l)):"matching"==m?(k=g.find(".matchTargets .matchTarget:not(.distractor,.example)"),l=a(k.get(this.subAnswerIndex)).attr("data-rcfid"),h(k.length,g,e[j],l)):!a.isArray(e[j].value)||"list"!=e[j].type&&"composite"!=e[j].type?(g.trigger("rcf.single.answer",e[j]),this.answerIndex>f.length-1?this.answerIndex=null:this.answerIndex++):h(e[j].value.length,g,e[j],this.subAnswerIndex);break}return this.answerIndex<e.length},hasMoreAnswers:function(){var a=null!==this.$answerableObjects&&this.$answerableObjects.length>0;if(!a)return!1;var b=this.answerIndex||0;return b<this.$answerableObjects.length},showMarkedAnswers:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Marked AnswersObject passed to RCF [showMarkedAnswers]";if(RCF.Utils.isEmpty(b.activity_id))throw"Empty activity_id passed to RCF [showMarkedAnswers]";if(b.activity_id!=this.id)throw"Invalid JSON Answers provided for activity ["+this.id+"]\n\nAnswers provided were for activity ["+b.id+"]";var c=b.answers;if(!RCF.Utils.isEmpty(c)){this.$activity.addClass("marking");try{for(var d=a.merge(a.merge([],this.markedBehaviors),this.unmarkedBehaviors),e=0,f=d.length;f>e;e++){var g=d[e];"function"==typeof g.showMarkedAnswers&&g.showMarkedAnswers(b)}}catch(h){throw"Error when trying to mark the answers : "+h}}},hideMarkedAnswers:function(){this.$activity.removeClass("marking");try{for(var b=a.merge(a.merge([],this.markedBehaviors),this.unmarkedBehaviors),c=0,d=b.length;d>c;c++){var e=b[c];"function"==typeof e.clearMarkedAnswers&&e.clearMarkedAnswers()}}catch(f){throw"Error trying to hide marked answers : "+f}},showUserAnswers:function(){try{for(var b=a.merge(a.merge([],this.markedBehaviors),this.unmarkedBehaviors),c=0,d=b.length;d>c;c++){var e=b[c];"function"==typeof e.showUserAnswers&&e.showUserAnswers()}}catch(f){throw"Error trying to show users answers : "+f}},isComplete:function(){for(var a=!0,b=0;b<this.markedBehaviors.length;b++){var c=this.markedBehaviors[b];if("function"==typeof c.isComplete&&!c.isComplete()){a=!1;break}}return a},getUserAnswers:function(){var b={};b.id=this.id,b.answers=[];try{for(var c=a.merge(a.merge([],this.markedBehaviors),this.unmarkedBehaviors),d=0,e=c.length;e>d;d++)if("function"==typeof c[d].getUserAnswers){var f=c[d].getUserAnswers();"object"==typeof f&&a.merge(b.answers,f)}}catch(g){throw"Error trying to get the users answers : "+g}return b},resetAnswers:function(b){this.answerIndex=0,this.subAnswerIndex=0,this.$activity.trigger("rcf.stop.audio");try{for(var c=a.merge(a.merge([],this.markedBehaviors),this.unmarkedBehaviors),d=0,e=c.length;e>d;d++)"function"==typeof c[d].reset&&c[d].reset(b)}catch(f){throw"Error trying to reset answers : "+f}},closeView:function(){if(this.markedBehaviors&&this.unmarkedBehaviors){for(var b=a.merge(a.merge([],this.markedBehaviors),this.unmarkedBehaviors),c=0,d=b.length;d>c;c++)"function"==typeof b[c].close&&b[c].close(),b[c]=null;b=null}this.$jPlayer&&this.$jPlayer.length>0&&this.$jPlayer.jPlayer("destroy"),this.unmarkedBehaviors=null,this.markedBehaviors=null,this.$answerableObjects=null,this.answerIndex=null,RCF.unsubscribe("rcf.new.carousel.page")},disable:function(){this.$activity.parent().find(".rcfInteractiveMask").addClass("show")},enable:function(){this.$activity.parent().find(".rcfInteractiveMask").removeClass("show")}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Version={version:"2.0.62"},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.BehaviorName={TYPEIN:"rcf_typein",TYPEIN_GROUP:"rcf_typein_group",DROPDOWN:"rcf_dropdown",CHECKBOXLIST:"rcf_checkboxlist",CHECKBOXLIST_SELECTABLE:"rcf_checkbox_item_selectable",RADIOLIST:"rcf_radiolist",RADIOITEM_SELECTABLE:"rcf_radio_item_selectable",SELECTABLE_ELEMENTS:"rcf_selectable",TOGGLE_ELEMENTS:"rcf_toggle",ORDERING:"rcf_ordering",DROPPABLES:"rcf_droppables",LOCATING:"rcf_locating",CAT_RADIOTABLE:"rcf_categorise_radioTable",CAT_CHECKBOXTABLE:"rcf_categorise_checkboxTable",CAT_CHECKBOXLIST:"rcf_categorise_checkboxList",CAT_DRAGGABLE:"rcf_categorise_draggable",CAT_DROPDOWN:"rcf_categorise_dropDown",CAT_RADIOLIST:"rcf_categorise_radioList",CAT_TOUCHABLE:"rcf_categorise_touchable",CAT_SELECTABLE:"rcf_categorise_selectable",WORDSNAKE:"rcf_wordsnake",WORDSEARCH:"rcf_wordsearch",CROSSWORD:"rcf_crossword",VERTICAL_CROSSWORD:"rcf_vertical_crossword",MATCHING:"rcf_matching",PELMANISM:"rcf_pelmanism",MOVING_TARGETS:"rcf_moving_targets",COMPOSITE_SCENE:"rcf_composite_scene"},RCF.channel=a({}),RCF.subscribe=function(){b.RCF.channel.on.apply(b.RCF.channel,arguments)},RCF.unsubscribe=function(){b.RCF.channel.off.apply(b.RCF.channel,arguments)},RCF.publish=function(){b.RCF.channel.trigger.apply(b.RCF.channel,arguments)},RCF.Application=function(){var c={useRetinaImages:!1,swfFallbackURL:"/cdn/rcf/swf",disableTextSelection:!1,minWidth768:"1000px",videoSize:{desktop:{width:"480px",height:"272px"},mobile:{width:"240px",height:"135px"}}},d=null,e=function(){var a=RCF.Utils.cookie("deviceMode");return RCF.Utils.isEmpty(a)&&(a="",RCF.Utils.isMobileDevice()&&(a="mobile"),RCF.Utils.isTabletDevice()?a="mobile":a.length<1&&(a="desktop"),RCF.Utils.cookie("deviceMode",a)),a},f=function(d){var f=null,g=null;if(RCF.Utils.isEmpty(d))throw"Invalid options passed to RCF.Application";try{f=a.extend({},c,d)}catch(h){throw"Error setting Options for the RCF.Application ! \n\n"+h}if(RCF.Utils.isEmpty(f.swfFallbackURL))throw"No SWF Fallback URL provided - needs passing to RCF Initialization in parameters";RCF.options=f;try{g=e()}catch(h){b.console&&console.log("Error getting DeviceMode - defaulting to 'desktop' :\n\n"+h),g=""}RCF.Utils.isEmpty(g)&&(g="",RCF.Utils.isMobileDevice()&&(g="mobile"),RCF.Utils.isTabletDevice()?g="tablet":g.length<1&&(g="desktop"),RCF.Utils.cookie("deviceMode",g)),"function"==typeof FastClick&&FastClick.attach(document.body)},g=function(){RCF.unsubscribe("show.correct.answers"),RCF.unsubscribe("set.answers"),RCF.unsubscribe("show.user.answers"),RCF.unsubscribe("show.marked.answers"),RCF.unsubscribe("hide.marked.answers"),RCF.unsubscribe("try.again"),RCF.unsubscribe("reset.answers"),RCF.unsubscribe("get.user.answers"),RCF.unsubscribe("update.categories.size"),RCF.unsubscribe("show.next.answer"),RCF.Utils.isEmpty(d)||d.closeView()},h=function(c,f){var h=null;if(RCF.Utils.isEmpty(c))throw"Invalid ActivityContainer passed to RCF.Application";if(h=c.find("*[data-rcfxmlid]:first"),0===h.length)throw"No RCF Content found inside supplied Activity Container";RCF.Utils.isEmpty(f)||a.extend(RCF.options,f);var j=RCF.Utils.isIE();g();var q=e();"desktop"==q?(c.removeClass("mobile"),a(".mobile").remove(),h.removeAttr("data-mobilebehaviors")):"mobile"==q&&(c.removeClass("desktop"),a(".desktop").remove(),h.removeAttr("data-desktopbehaviors")),c.addClass(q),a("#activityCSS").remove(),a("#activity768CSS").remove();var r=a("#activityCSS"),s=a("#activity768CSS"),t="";if(t=a("#mobStyleCSS").text(),t.length>0&&(r=a("<style id='activityCSS'>"+t+"</style>"),a("head").append(r)),t=a("#desktopStyleCSS").text(),t.length>0){var u="@media screen and (min-width: "+(RCF.options.minWidth768||"1000px")+") ",v="<style id='activity768CSS'>\n"+(j?"\n":u+"{\n")+t+"\n"+(j?"":"}")+"\n</style>";s=a(v),a("head").append(s)}c.addClass(j?"isIE":"");for(var w="transform WebkitTransform MozTransform OTransform msTransform".split(" "),x=!1,y=0;y<w.length&&!(x=void 0!==c[0].style[w[y]]);y++);x||c.addClass("no-csstransforms3d"),d=new RCF.ActivityView(h),RCF.subscribe("show.correct.answers",function(a,c){b.console&&console.log("show.correct.answers is deprecated and will be removed - please use 'set.answers' instead."),k(c)}),RCF.subscribe("try.again",function(a,b){l(b)}),RCF.subscribe("set.answers",function(a,b){k(b)}),RCF.subscribe("show.user.answers",function(){m()}),RCF.subscribe("show.marked.answers",function(a,b){n(b)}),RCF.subscribe("hide.marked.answers",function(){o()}),RCF.subscribe("reset.answers",function(){p()}),RCF.subscribe("get.user.answers",function(){RCF.publish("deliver.user.answers",d.getUserAnswers())}),RCF.subscribe("update.categories.size",function(){var b=0,d=c.find(".category .dropTarget");if(d.length>0){d.css("height","auto"),d.each(function(){var c=0;try{c=parseInt(a(this).css("height"))}catch(d){c=1}b=Math.max(b,c)});var e=c.find(".categories h3"),f=Math.max.apply(Math,e.map(function(){try{return parseInt(a(this).height())}catch(b){return 1}}).get());e.css("min-height",f+"px"),d.css("height",b+"px")}}),RCF.subscribe("show.next.answer",function(a,b){i(b)}),RCF.publish("update.categories.size")},i=function(a){return d?d.showNextAnswer(a):void 0},j=function(){return d?d.hasMoreAnswers():!1},k=function(a){d&&a&&d.showAnswers(a)},l=function(a){d&&a&&d.showAnswers(a,!0)},m=function(){d&&d.showUserAnswers()},n=function(a){d&&d.showMarkedAnswers(a)},o=function(){d&&d.hideMarkedAnswers()},p=function(){d&&d.resetAnswers()},q=function(){return d?d.getUserAnswers():void 0},r=function(){return d?d.isComplete():void 0},s=function(){return RCF.Version};return{initialize:f,getDeviceMode:e,cleanUp:g,updateContent:h,setAnswers:k,showUserAnswers:m,showMarkedAnswers:n,hideMarkedAnswers:o,resetAnswers:p,getUserAnswers:q,showNextAnswer:i,hasMoreAnswers:j,isActivityComplete:r,getVersion:s}}()}(jQuery,window),function(a,b){function c(a,b){if(!a)return!1;if(b.length!=a.length)return!1;for(var d=0;d<b.length;d++)if(b[d]instanceof Array&&a[d]instanceof Array){if(!c(b[d],a[d]))return!1}else if(b[d]!=a[d])return!1;return!0}b.RCF=b.RCF||{},a.extend({inArrayIn:function(b,c,d){if("string"!=typeof b)return a.inArray.apply(this,arguments);if(c){var e=c.length;for(d=d?0>d?Math.max(0,e+d):d:0,b=b.toLowerCase();e>d;d++)if(d in c&&c[d].toLowerCase()==b)return d;return-1}}}),RCF.MarkingEngine=function(){function d(a){this.json=a}var e=function(a,b,c){return c&&"n"==c?a.toLowerCase()==b.toLowerCase():a==b},f=function(f,g){var h="",i="",j=null,k=null,l=0,m=0,n="",o=new d(f);g.activity_id=g.id;for(var p in g.answers){var q=g.answers[p];q.verification=[];var r=q.elm,s=!1,t=0,u="",v="";if(r&&q.type){if(h=q.value,j=o.getAnswerObject(r),null===j){b.console&&console.log("No answers object for this activity - most likely it is unmarked");continue}if(k=j.type,i=j.markType||"item","unmarked"===i)continue;if(n=j.value,"simple"==k)s=e(h,n,j.caseSensitive),q.verification[0]=s?1:0,s&&m++;else if("choice"==k)for(l in n){if(s=e(h,n[l],j.caseSensitive)){q.verification[0]=1,m++;break}q.verification[0]=0}else if("sequence"==k)if("list"==i)s=c(h,n),q.verification[0]=s?1:0,s&&m++;else for(t=0;t<n.length;t++)u=h[t],v=n[t],q.verification.push(u==v?1:0),u==v&&m++;else if("list"==k){if("item"==i)if(a.isArray(h))for(t=0;t<h.length;t++)q.verification.push(a.inArray(h[t],n)>-1?1:0),a.inArray(h[t],n)>-1&&m++;else q.verification.push(a.inArray(h,n)>-1?1:0),a.inArray(h,n)>-1&&m++}else if("composite"==k){var w=null;if("list"==i){var x=!0;if(w=q.verification,a.isArray(h))for(t=0;t<h.length;t++){var y=h[t],z=n[t];if(y.elm!=z.elm){x=!1;break}if("choice"==z.type){if(x=z.caseSensitive&&"n"===z.caseSensitive?a.inArrayIn(y.value,z.value)>-1:a.inArray(y.value,z.value)>-1,!x)break}else if("simple"==z.type)if(z.caseSensitive&&"n"===z.caseSensitive){if(y.value.toLowerCase()!=z.value.toLowerCase()){x=!1;break}}else if(y.value!=z.value){x=!1;break}}w.push(x?1:0),x&&m++}else if("item"==i&&a.isArray(h))for(t=0;t<h.length;t++){var A=h[t],B=A.elm,C=!1,D=0,E=null,F=A.verification=[];for(D=0;D<n.length;D++)if(E=n[D],E.elm===B){C=!0;break}if(C){if(A.elm==E.elm)if("list"==E.type)if("item"==E.markType){if(a.isArray(A.value))for(var G=0;G<A.value.length;G++)F.push(a.inArray(A.value[G],E.value)>-1?1:0),a.inArray(A.value[G],E.value)>-1&&m++}else"list"==E.markType;else"simple"==E.type?A.value&&A.value.length>0&&(F.push(A.value==E.value?1:0),A.value==E.value&&m++):"choice"===E.type&&(F.push(a.inArray(A.value,E.value)>-1?1:0),a.inArray(A.value,E.value)>-1&&m++)}else F.push(0)}}else if("complexordering"==k){for(t=0;t<n.length&&!(s=c(h,n[t]));t++);q.verification[0]=s?1:0,s&&m++}}}return g.score=m,g};return d.prototype={getAnswerObject:function(a){var b=this.json;for(var c in b.answers){var d=b.answers[c];if(d.elm&&d.elm===a)return d}return null}},{getMarkedAnswers:f}}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.COMPOSITE_SCENE]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(a){if(this.$activity=a,RCF.Utils.isEmpty(a))throw"No activity passed to composite scene interaction";if(this.$compositeScene=a.find("*[data-rcfinteraction='compositeScene']").first(),RCF.Utils.isEmpty(this.$compositeScene))throw"No composite scene in activity !";this.gameStartAudio=this.$compositeScene.attr("data-audio-gamestart"),this.gameOverAudio=this.$compositeScene.attr("data-audio-gameover"),this.incorrectAudio=this.$compositeScene.attr("data-audio-incorrect"),this.$startGameButton=this.$activity.find(".startGameButton"),this._setupEventHandlers(),this._initializeGame()},_initializeGame:function(){var a=this;this.$compositeScene.removeClass("complete").removeClass("playing"),a.$activity.trigger("rcf.play.audio",a.gameStartAudio)},_setupItems:function(){var a=this;this.$compositeScene.find(".sceneItem[data-addedrank='y']").removeAttr("data-addedrank").removeAttr("data-sortindex").removeAttr("data-rank"),this.$compositeScene.find(".sceneItems").mmRandomize(".sceneItem",(new Date).getTime()),this.$gameItems=this.$compositeScene.find(".sceneItem"),this.$gameItems.tsort("",{attr:"data-sortindex",order:"asc"}),this.$gameItems.removeClass("correct current"),this.$currentItem=a.$gameItems.first(),this.$currentItem.addClass("current")},_setupEventHandlers:function(){var b=this;this.$activity.on("click","*[data-rcfinteraction]:not(.complete) .playClueButton",function(){b.$activity.trigger("rcf.stop.audio");var a=b.$compositeScene.find(".sceneItem.current").attr("data-audio-clue");a&&b.$activity.trigger("rcf.play.audio",a)}),this.$activity.on("click","*[data-rcfinteraction]:not(.complete) .sceneItem.current",function(){var c=a(this),d=null,e=c.attr("data-audio-correct");c.addClass("correct").removeClass("current"),c=c.next(),d=RCF.Utils.isEmpty(c)?b.gameOverAudio:c.attr("data-audio-clue"),b.$activity.trigger("rcf.stop.audio"),RCF.Utils.isEmpty(c)?b.$compositeScene.removeClass("playing").addClass("complete"):c.addClass("current"),b.$activity.trigger("rcf.play.audio",{audio:[e,d]})}),this.$activity.on("click","*[data-rcfinteraction]:not(.complete) .sceneItem:not(.current)",function(){b.$activity.trigger("rcf.stop.audio");var a=b.$compositeScene.find(".sceneItem.current");RCF.Utils.isEmpty(a)||b.$activity.trigger("rcf.play.audio",{audio:[b.incorrectAudio,a.attr("data-audio-clue")]})}),this.$compositeScene.on("click",".startGameButton",function(){b._setupItems(),b.$activity.trigger("rcf.stop.audio"),b.$compositeScene.removeClass("complete").addClass("playing");var a=b.$compositeScene.find(".sceneItem.current").attr("data-audio-clue");b.$activity.trigger("rcf.play.audio",a)})},isComplete:function(){return this.$compositeScene.hasClass("complete")},close:function(){this.$activity.trigger("rcf.stop.audio")},reset:function(){this._initializeGame()}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.MOVING_TARGETS]=function(){function a(a){this._initialize(a)}return a.prototype={_initialize:function(a){if(this.$activity=a,this.$movingTargets=a.find("*[data-rcfinteraction='movingTargets']").first(),this.$gameStage=this.$movingTargets.find(".rcfMovingTargets"),RCF.Utils.isEmpty(this.$gameStage))throw"Error ! No rcfMovingTargets stage !";var c=b.Phaser||!1;if(!c)return this.$gameStage.addClass("missingLibrary"),void this.$gameStage.html("<h2>PhaserJS library missing</h2><h3>This activity requires the use of the PhaserJS game library</h3>");var d="";d=this.$activity.attr("id"),d+=this.$activity.attr("data-seed")||"",Math.seedrandom(d);var e=this.$gameStage.find(".jsonObject").text();try{this.gameSettings=JSON.parse(e)}catch(f){throw"Error getting game settings for Moving Targets ! \n\n"+f}this.$gameStage.find(".jsonObject").text(""),this.movingTargetsGame=new RCF.Handlers.MovingTargetsGame(this.$gameStage,this.gameSettings)},isComplete:function(){return this.$gameStage.hasClass("complete")},reset:function(){this.movingTargetsGame.resetGame()}},a}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Handlers=RCF.Handlers||{},RCF.Handlers.MovingTargetsGame=function(){function a(a,b){if(RCF.Utils.isEmpty(a))throw"No $gameStage passed to moving targets game";if(!b)throw"No game settings json passed to moving targets game";this.$gameStage=a,this.gameSettings=b,this.game=new Phaser.Game(d,e,Phaser.CANVAS,a[0].id,this),this.remainingClues=[],this.currentClue=null,this.gameTargets=null,this.crosshairs=null,this.collisionTarget=null,this.clueButton=null,this.successAudio=null,this.failAudio=null,this.gameOverAudio=null}var b=-300,c=300,d=700,e=480;return a.prototype={preload:function(){function a(a,b){["sceneBackground","targetBackground","foreground"].forEach(function(b){var d=a[b];d&&c.game.load.image(b,d)}),["crosshairs","collisionTarget","clueButton"].forEach(function(b){var d=a[b];if(!d)throw'Image asset expected in ("assets"): "'+b+'"';c.game.load.image(b,d)}),b.forEach(function(a){c.game.load.image(a.image.split("/").pop(),a.image,!0)})}function b(a,b){["fail","success","gameover"].forEach(function(b){var d=a[b];if(!d)throw'Audio asset expected in ("audio"): "'+b+'"';c.game.load.audio(b,d)}),b.forEach(function(a){c.game.load.audio(a.id,a.audio)})}var c=this;a(c.gameSettings.assets,c.gameSettings.targets),b(c.gameSettings.audio,c.gameSettings.targets),c.game.stage.disableVisibilityChange=!0},create:function(){function a(){g.gameSettings.assets.sceneBackground&&(g.sceneBackground=g.game.add.tileSprite(0,0,g.game.world.width,g.game.world.height,"sceneBackground"),g.sceneBackground.autoScroll(h*-.6,0)),g.gameSettings.assets.targetBackground&&(g.targetBackground=g.game.add.tileSprite(0,120,g.game.world.width,g.game.world.height-150,"targetBackground"),g.targetBackground.autoScroll(h,0)),g.gameSettings.assets.foreground&&(g.foreground=g.game.add.tileSprite(0,g.game.world.height-50,g.game.world.width,100,"foreground"),g.foreground.autoScroll(-1.2*h,0),g.game.add.tween(g.foreground).to({y:g.game.world.height-100},1500,Phaser.Easing.Cubic.InOut,!0,0,Number.MAX_VALUE,!0))}function d(){g.gameTargets=g.game.add.group(),g.gameTargets.enableBody=!0,g.gameTargets.physicsBodyType=Phaser.Physics.ARCADE;var a=0;g.gameSettings.targets.forEach(function(d){var e=null;try{var f=d.image.split("/").pop();e=g.gameTargets.create(b-a*c,160,f),a++}catch(i){console.log("Error loading target ["+d.id+"] \n\n"+i)}e&&(e.id=d.id,e.body.velocity.setTo(parseInt(h),0),e.body.acceleration.setTo(0,0))})}function e(){g.crosshairs=g.game.add.sprite(g.game.camera.width/2-224,g.game.camera.height/2-141,"crosshairs"),g.collisionTarget=g.game.add.sprite(g.game.camera.width/2-15,g.game.camera.height/2-15,"collisionTarget")
}function f(){g.clueButton=g.game.add.button(g.game.world.width-140,10,"clueButton",function(){g.$gameStage.hasClass("complete")||g.currentClue.play()},this),g.clueButton.input.useHandCursor=!0}var g=this,h=g.gameSettings.speed;g.scale.pageAlignHorizontally=!0,a(),d(),e(),f(),g.failAudio=g.game.add.audio("fail"),g.successAudio=g.game.add.audio("success"),g.gameOverAudio=g.game.add.audio("gameover"),g.resetGame()},_initialiseClues:function(){var a=this;a.remainingClues=[];for(var b=0;b<a.gameSettings.targets.length;b++){var c=a.gameSettings.targets[b],d=a.game.add.audio(c.id);a.remainingClues.push(d)}RCF.Utils.shuffleArrayItems(a.remainingClues),a.currentClue=a.remainingClues.pop()},update:function(){function a(a){if(!e.$gameStage.hasClass("complete")){var b=a.x-e.game.camera.width/2;e.gameTargets.forEach(function(c){c.x-=b+a.width/2}),e._pauseGame(),a.id===e.currentClue.key?0===e.remainingClues.length?(e.successAudio.onStop.addOnce(function(){e.gameOverAudio.play(),e.$gameStage.addClass("complete")}),e.successAudio.play()):(e.currentClue=e.remainingClues.pop(),e.successAudio.onStop.addOnce(function(){e.currentClue.onStop.addOnce(function(){e._resumeGame()}),e.currentClue.play()}),e.successAudio.play()):(e.failAudio.onStop.addOnce(function(){e.currentClue.onStop.addOnce(function(){e._resumeGame()}),e.currentClue.play()}),e.failAudio.play())}}var b=0,d=null,e=this;e.gameTargets.forEach(function(b){b.overlap(e.collisionTarget)?b.inputEnabled||(b.inputEnabled=!0,b.input.useHandCursor=!0,b.events.onInputDown.add(a)):(b.inputEnabled=!1,b.events.onInputDown.removeAll())}),e.gameTargets.forEach(function(a){a.x<b&&(b=a.x),a.x>a.width*e.gameTargets.length&&(d=a)}),null!=d&&(d.x=b-c)},_pauseGame:function(){var a=this;a.gameTargets.forEach(function(a){a.body.velocity.setTo(0,0)}),a.targetBackground&&a.targetBackground.autoScroll(0,0)},_resumeGame:function(){var a=this,b=a.gameSettings.speed;a.gameTargets.forEach(function(a){a.body.velocity.setTo(parseInt(b),0)}),a.targetBackground&&a.targetBackground.autoScroll(b,0)},resetGame:function(){var a=this,d=a.gameTargets.length,e=0;a.$gameStage.removeClass("complete"),a._initialiseClues();for(var f=[],g=0;d>g;g++)f[g]=b-g*c;RCF.Utils.shuffleArrayItems(f),a.gameTargets.forEach(function(a){a.x=f[e],e++}),a.currentClue.play(),a._resumeGame()}},a}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CAT_CHECKBOXLIST]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into CategoriseCheckBoxList constructor !";if(this.$activity=b,this.$selector=this.$activity.find(".categorise.complexCategorise.checkboxList[data-rcfinteraction=categorise]"),!RCF.Utils.isEmpty(this.$selector)){this.$selector.find("input[type=checkbox].example").prop("checked",!0),this.$selector.on("change","input[type=checkbox].example",function(b){return b.stopPropagation(),b.preventDefault(),a(this).prop("checked","y"==a(this).attr("data-correct")),!1});var c=this.$selector.find(".checkboxListCategoryItem");this.$selector.mmRandomizeRanks(".checkboxListCategoryItem"),c.tsort("",{attr:"data-rank",order:"asc"}),this.$activity.on("rcf.single.answer",".categorise.checkboxList",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=[];for(var h in c.value){var i=c.value[h];for(var j in i.value)i.value[j]===d&&g.push(i.elm)}if(g.length>0)for(var k=0;k<g.length;k++)e.find("input[type=checkbox][data-rcfid='"+d+"'][value='"+g[k]+"']").prop("checked",!0)}})}},showAnswers:function(c,d){this.$selector.each(function(){var b=a(this);b.find("input[type=checkbox]:not(.example)").each(function(){var b=a(this);b.data("user-answer",b.prop("checked")?b.val():null),b.prop("checked",!1)})});for(var e in c.answers){var f=c.answers[e],g=f.elm;if(!RCF.Utils.isEmpty(g)){var h=this.$selector.filter(".categorise[data-rcfid='"+g+"']");if(!RCF.Utils.isEmpty(h))for(var i in f.value){var j=f.value[i],k=j.elm;if(a.isArray(j.value)||!b.console)for(var l in j.value){var m=j.value[l],n=h.find("input[type=checkbox][data-rcfid='"+m+"'][value='"+k+"']");if(!RCF.Utils.isEmpty(n)){var o=d?j.verification&&"1"==j.verification[l]:!0;n.prop("checked",o)}}else console.log("no array passed to [rcf_categorise_checkboxlist.show answers] ! - skipping")}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=c.value[f];if(!RCF.Utils.isEmpty(g.verification))for(var h in g.value){var i=e.find("input[type=checkbox][data-rcfid='"+g.value[h]+"'][value='"+g.elm+"']:checked");if(!RCF.Utils.isEmpty(i)){var j="1"==g.verification[h]?"correct":"wrong";i.parent().find(".mark").addClass(j)}}}}}},showUserAnswers:function(){this.reset(),this.$selector.find("input[type=checkbox]:not(.example)").each(function(){var b=a(this),c=b.data("user-answer");RCF.Utils.isEmpty(c)||b.prop("checked",!0)})},isComplete:function(){var b=!0;return this.$selector.each(function(){a(this).find(".complexCategoriseCheckBox:not(.example):checked").length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"composite",value:b.find(".checkboxListCategoryItem:first input[type=checkbox]").map(function(){var c=this.value;return{elm:c,type:"list",value:b.find("input[type=checkbox][value='"+c+"']:not(.example):checked").map(function(){return a(this).attr("data-rcfid")}).get()}}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find("input[type=checkbox]:not(.example)").prop("checked",!1)}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CAT_CHECKBOXTABLE]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into Categorise CheckBoxTable constructor !";if(this.$activity=b,this.$selector=this.$activity.find(".categorise[data-rcfinteraction='categorise'].checkboxTable"),!RCF.Utils.isEmpty(this.$selector)){var c=this.$selector.find("input[type='checkbox'].complexCategoriseCheckBox");c.filter(".example").filter("[data-correct='y']").prop("checked",!0),c.filter(".example").on("change",function(b){b.preventDefault();var c=a(this).prop("checked");return c=!c,a(this).prop("checked",c),!1}),this.$selector.find("table").mmRandomizeRanks(".tableAnswerRow:not(.example)"),this.$selector.each(function(){var b=a(this),c=b.find(".tableAnswerRow:not(.example)");c.tsort("",{attr:"data-rank",order:"asc"}),c.filter(":odd").addClass("odd"),c.filter(":even").addClass("even")}),this.$activity.on("rcf.single.answer",".categorise.checkboxTable",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=[];for(var h in c.value){var i=c.value[h];for(var j in i.value)i.value[j]===d&&g.push(i.elm)}if(g.length>0)for(var k=e.find("input[type='checkbox'][data-rcfid='"+d+"']"),l=0;l<g.length;l++)k.filter("[data-catid='"+g[l]+"']").prop("checked","true")}})}},showAnswers:function(c,d){var e=this.$selector.find(".categoryCol");e.each(function(){var b=a(this),c=b.attr("data-rcfid"),d=[];d=b.closest("table").find("input[type=checkbox][data-catid='"+c+"']:checked").map(function(){return a(this).attr("data-rcfid")}).get(),b.data("user-answer",d)}),e.closest("table").find("input[type=checkbox]:not(.example)").prop("checked",!1);for(var f in c.answers){var g=c.answers[f],h=g.elm;if(!RCF.Utils.isEmpty(h)){var i=this.$selector.filter(".categorise[data-rcfid='"+h+"']");if(!RCF.Utils.isEmpty(i))for(var j in g.value){var k=g.value[j],l=k.elm;if(a.isArray(k.value)||!b.console)for(var m in k.value){var n=k.value[m],o=i.find("tr[data-rcfid='"+n+"']");RCF.Utils.isEmpty(o)||(o.find("input[type=checkbox][data-catid='"+l+"']").prop("checked",!1),(d&&k.verification&&"1"==k.verification[m]||RCF.Utils.isEmpty(d)||!d)&&o.find("input[type=checkbox][data-catid='"+l+"']").prop("checked",!0))}else console.log("no array passed to [rcf_categorise_checkboxtable.show answers] ! - skipping")}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=c.value[f];for(var h in g.value)if(!RCF.Utils.isEmpty(g.verification)){var i=e.find("input[type=checkbox][data-rcfid='"+g.value[h]+"'][data-catid='"+g.elm+"']:checked");if(!RCF.Utils.isEmpty(i)){var j="1"==g.verification[h]?"correct":"wrong";i.parent().find(".mark").addClass(j)}}}}}},showUserAnswers:function(){var b=this.$selector.find(".categoryCol");b.closest("table").find("input[type=checkbox]:not(.example)").prop("checked",!1),b.each(function(){var b=a(this),c=b.attr("data-rcfid"),d=b.data("user-answer");if(!RCF.Utils.isEmpty(d))for(var e=b.closest("table"),f=0,g=d.length;g>f;f++){var h=d[f];e.find("tr[data-rcfid='"+h+"']").find("input[type=checkbox][data-catid='"+c+"']").prop("checked",!0)}})},isComplete:function(){var b=!0;return this.$selector.each(function(){a(this).find(".complexCategoriseCheckBox:not(.example):checked").length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"composite",value:b.find(".categoryCol").map(function(){var b=a(this).attr("data-rcfid");return{elm:a(this).attr("data-rcfid"),type:"list",value:a(this).closest("table").find(".tableAnswerRow").map(function(){var c=a(this),d=a(this).attr("data-rcfid"),e=c.find("input[type=checkbox][data-catid='"+b+"']:checked:not(.example)");return RCF.Utils.isEmpty(e)?void 0:d}).get()}}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){var a=this.$selector.find(".categoryCol");a.removeData("user-answer").closest("table").find("input[type=checkbox]:not(.example)").prop("checked",!1)}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CAT_DRAGGABLE]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"No Activity passed to draggable categorise initialize";if(this.$activity=b,this.$selector=this.$activity.find("[data-rcfinteraction=categorise].categorise.draggable"),!RCF.Utils.isEmpty(this.$selector)){var c=RCF.Utils.cookie("deviceMode"),d=RCF.Utils.isEmpty(c)?RCF.Utils.isTabletDevice()||RCF.Utils.isMobileDevice()?"touchable":"draggable":"desktop"!=c?"touchable":"draggable",e=this.$activity.attr("data-desktopdraggable");"n"===e&&(d="touchable"),this.mode=d,this._setupMovableHandlers();var f=this;this.$activity.on("rcf.single.answer",".categorise.draggable[data-rcfinteraction=categorise]:not(.example)",function(b,c,d){var e=a(this),g=c.elm;if(g===e.attr("data-rcfid")){var h=[];for(var i in c.value){var j=c.value[i];for(var k in j.value)j.value[k]===d&&h.push(j.elm)}if(h.length>0){for(var l=e.find(".wordBox li[data-rcfid='"+d+"']"),m=0;m<h.length;m++){var n=e.find(".category[data-rcfid='"+h[m]+"'] .dropTarget ul");n.append(l.removeClass("selected").clone())}e.hasClass("complexCategorise")||l.addClass("dragged")}RCF.publish("update.categories.size"),f._setupMovableHandlers()}})}},_setupMovableHandlers:function(){var b=this;b.categoriseObjects=[],b.$selector.each(function(){b.categoriseObjects.push(new RCF.Handlers.MovableCategoriseHandler(a(this),b.mode))})},showAnswers:function(c,d){var e=this.$selector.find(".category");e.each(function(){var b=a(this),c=[];b.find("li:not(.answers)").each(function(){c.push(this.id)}),b.data("user-answer",c)}),e.find("li:not(.example)").remove();for(var f in c.answers){var g=c.answers[f],h=g.elm;if(void 0!==h){var i=this.$selector.filter("[data-rcfid='"+h+"']");if(!RCF.Utils.isEmpty(i)){if(i.find(".wordBox li").removeClass("dragged"),!a.isArray(g.value)&&b.console){console.log("no array answerObject passed to [rcf_categorise_draggable.showAnswers] ! - skipping");continue}for(var j in g.value){var k=g.value[j],l=k.elm,m=i.find(".category[data-rcfid='"+l+"'] .dropTarget ul");if(a.isArray(k.value)||!b.console)for(var n in k.value){var o=k.value[n],p=i.find(".wordBox li[data-rcfid='"+o+"']");(d&&k.verification&&"1"==k.verification[n]||RCF.Utils.isEmpty(d)||!d)&&(m.append(p.removeClass("selected").clone()),p.closest(".categorise").hasClass("complexCategorise")||p.addClass("dragged"))}else console.log("no categoryObject array passed to [rcf_categorise_draggable.show answers] ! - skipping")}}}}this.$selector.find(".wordBox li.distractor").removeClass("dragged"),e.find("li:not(.example)").removeClass("dragged"),RCF.publish("update.categories.size"),this._setupMovableHandlers()},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=c.value[f];if(!RCF.Utils.isEmpty(g.verification)){var h=e.find(".category[data-rcfid='"+g.elm+"']");for(var i in g.value){var j=h.find(".dragItem[data-rcfid='"+g.value[i]+"']");if(!RCF.Utils.isEmpty(j)){var k="1"==g.verification[i]?"correct":"wrong";j.find(".mark").addClass(k)}}}}}}},showUserAnswers:function(){this.$selector.find(".category li:not(.example)").remove(),this.$selector.find(".wordBox li").removeClass("dragged");var b=this.$selector.find(".category");b.each(function(){var b=a(this),c=b.closest(".categorise").find(".wordBox"),d=b.data("user-answer");if(RCF.Utils.isEmpty(d));else for(var e=0,f=d.length;f>e;e++){var g=d[e],h=c.find("li[id='"+g+"']");RCF.Utils.isEmpty(h)||(b.find(".dropTarget ul").append(h.clone()),b.closest(".categorise").hasClass("complexCategorise")||h.addClass("dragged"))}}),RCF.publish("update.categories.size"),this._setupMovableHandlers()},isComplete:function(){var b=!0;return this.$selector.each(function(){a(this).find(".category li:not(.example)").length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"composite",value:b.find(".category").map(function(){return{elm:a(this).attr("data-rcfid"),type:"list",value:a(this).find("li:not(.example)").map(function(){return a(this).attr("data-rcfid")}).get()}}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find(".category").removeData("user-answer"),this.$selector.find(".category li:not(.example)").remove(),this.$selector.find(".wordBox li:not(.example)").data("moved","").removeClass("dragged").removeClass("selected"),this.$selector.find(".dropTarget").css("height",""),RCF.publish("update.categories.size")}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CAT_DROPDOWN]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into Categorise DropDown constructor !";if(this.$activity=b,this.$selector=this.$activity.find(".categorise[data-rcfinteraction='categorise'].dropDown"),!RCF.Utils.isEmpty(this.$selector)){var c=this.$selector.find("li");this.$selector.mmRandomizeRanks("li:not(.example)"),c.tsort("",{attr:"data-rank",order:"asc"}),this.$selector.filter(".example").focus(function(){var b=a(this).data("existingVal");RCF.Utils.isEmpty(b)&&a(this).data("existingVal",a(this).val())}).on("change",function(){return a(this).val(a(this).data("existingVal")),!1}),this.$selector.find("select:not(.example)").prop("selectedIndex",-1),this.$activity.on("rcf.single.answer",".categorise.dropDown[data-rcfinteraction=categorise]:not(.example)",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=[];for(var h in c.value){var i=c.value[h];for(var j in i.value)i.value[j]===d&&g.push(i.elm)}if(g.length>0)for(var k=e.find(".categoriseDropDown[data-rcfid='"+d+"'] select"),l=0;l<g.length;l++)k[0].value=g[l]}})}},showAnswers:function(c,d){this.$selector.each(function(){var b=a(this),c=a(b.find("select:not(.example)")[0]),d={elm:b.attr("data-rcfid"),value:c.find("option").map(function(){var c=a(this),d=c.attr("data-rcfid");return{elm:d,value:b.find("option[value='"+d+"']:selected").map(function(){return a(this).closest(".categoriseDropDown").attr("data-rcfid")}).get()}}).get()};b.data("user-answer",d),b.find("select:not(.example)").prop("selectedIndex","-1")});for(var e in c.answers){var f=c.answers[e],g=f.elm;if(!RCF.Utils.isEmpty(g)){var h=this.$selector.filter(".categorise[data-rcfid='"+g+"']");if(!RCF.Utils.isEmpty(h))for(var i in f.value){var j=f.value[i],k=j.elm;if(a.isArray(j.value)||!b.console)for(var l in j.value){var m=j.value[l],n=h.find(".categoriseDropDown[data-rcfid='"+m+"'] select");d?j.verification&&"1"==j.verification[l]?n[0].value=k:n.prop("selectedIndex",-1):n[0].value=k}else console.log("no array passed to [rcf_categorise_dropdown.show answers] ! - skipping")}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(void 0!==d){var e=this.$selector.filter(".categorise[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=c.value[f];if(!RCF.Utils.isEmpty(g.verification))for(var h in g.value){var i=e.find(".categoriseDropDown[data-rcfid='"+g.value[h]+"'] select");if(!RCF.Utils.isEmpty(i)){var j="1"==g.verification[h]?"correct":"wrong";i.closest(".categoriseDropDown").find(".mark").addClass(j)}}}}}},showUserAnswers:function(){this.$selector.each(function(){var c=a(this);c.find("select:not(.example)").prop("selectedIndex","-1");var d=c.data("user-answer");if(!RCF.Utils.isEmpty(d)){var e=d.elm;if(e!=c.attr("data-rcfid"))return void(b.console&&console.log("Saved user answers are for different category !"));for(var f in d.value){var g=d.value[f],h=g.elm,i=g.value;for(var j in i){var k=i[j],l=c.find(".categoriseDropDown[data-rcfid='"+k+"'] select");RCF.Utils.isEmpty(l)||(l[0].value=h)}}}})},isComplete:function(){var b=!0;return this.$selector.find("select:not(.example)").each(function(){var c=a(this);c.find("option:selected").length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this),c=a(b.find("select:not(.example)")[0]);return{elm:b.attr("data-rcfid"),type:"composite",value:c.find("option").map(function(){var c=a(this),d=c.attr("data-rcfid");return{elm:d,type:"list",value:b.find("option[value='"+d+"']:selected").map(function(){return a(this).closest(".categoriseDropDown:not(.example)").attr("data-rcfid")}).get()}}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find("select:not(.example)").prop("selectedIndex",-1)}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CAT_RADIOLIST]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into Categorise RadioList constructor !";if(this.$activity=b,this.$selector=b.find(".categorise.radioList[data-rcfinteraction=categorise]"),!RCF.Utils.isEmpty(this.$selector)){var c=this.$selector.find("li.radioListCategoryItem");this.$selector.mmRandomizeRanks("li.radioListCategoryItem:not(.example)"),c.tsort("",{attr:"data-rank",order:"asc"}),this.$selector.find(".radioListCategoryItem:not(.example) input[type=radio]").prop("checked",!1),this.$selector.find(".radioListCategoryItem.example").find("input[type=radio]").on("change",function(b){b.stopPropagation(),b.preventDefault(),"y"==a(this).attr("data-correct")||a(this).closest(".radioList").find("input[type='radio']").filter("[data-correct='y']").prop("checked",!0)}),this.$activity.on("rcf.single.answer",".categorise.radioList[data-rcfinteraction=categorise]:not(.example)",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=[];for(var h in c.value){var i=c.value[h];for(var j in i.value)i.value[j]===d&&g.push(i.elm)}if(g.length>0)for(var k=0;k<g.length;k++)e.find("input[data-rcfid='"+d+"'][value='"+g[k]+"']").prop("checked",!0)}})}},showAnswers:function(c,d){this.$selector.each(function(){var b=a(this),c=b.find(".radioListCategoryItem:first input[type=radio]"),d={elm:b.attr("data-rcfid"),value:c.map(function(){var c=this.value;return{elm:c,value:b.find(".radioListCategoryItem:not(.example) input[type=radio][value='"+c+"']:checked").map(function(){return a(this).attr("data-rcfid")}).get()}}).get()};b.data("user-answer",d),b.find(".radioListCategoryItem:not(.example) input[type=radio]").prop("checked",!1)});for(var e in c.answers){var f=c.answers[e],g=f.elm;if(!RCF.Utils.isEmpty(g)){var h=this.$selector.filter(".categorise[data-rcfid='"+g+"']");if(!RCF.Utils.isEmpty(h))for(var i in f.value){var j=f.value[i];if(a.isArray(j.value)||!b.console){var k=j.elm;for(var l in j.value){var m=j.value[l],n=h.find("input[type=radio][data-rcfid='"+m+"'][value='"+k+"']");n.length>0&&(d?j.verification&&"1"==j.verification[l]?n.prop("checked",!0):n.prop("checked",!1):n.prop("checked",!0))}}else console.log("no array passed to [rcf_categorise_radiolist.show answers] ! - skipping")}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=c.value[f];if(!RCF.Utils.isEmpty(g.verification))for(var h in g.value){var i=e.find("input[type=radio][data-rcfid='"+g.value[h]+"']:checked");if(!RCF.Utils.isEmpty(i)){var j="1"==g.verification[h]?"correct":"wrong";i.closest(".categoriseRadioList").find(".mark").addClass(j)}}}}}},showUserAnswers:function(){this.$activity.find(".radioListCategoryItem:not(.example) input[type=radio]").prop("checked",!1),this.$selector.each(function(){var c=a(this),d=c.data("user-answer");if(!RCF.Utils.isEmpty(d)){var e=d.elm;if(e!=c.attr("data-rcfid"))return void(b.console&&console.log("Saved user answers are for a different categorise... aborting"));for(var f in d.value){var g=d.value[f],h=g.elm,i=g.value;for(var j in i){var k=i[j],l=c.find(".radioListCategoryItem:not(.example) input[type=radio][data-rcfid='"+k+"'][value='"+h+"']");RCF.Utils.isEmpty(l)||l.prop("checked",!0)}}}})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this),d=c.find(".radioListCategoryItem:not(.example)"),e=d.find("input[type=radio]:checked");d.length!==e.length&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this),c=b.find(".radioListCategoryItem:first input[type=radio]");return{elm:b.attr("data-rcfid"),type:"composite",value:c.map(function(){var c=this.value;return{elm:c,type:"list",value:b.find(".radioListCategoryItem:not(.example) input[type=radio][value='"+c+"']:checked").map(function(){return a(this).attr("data-rcfid")}).get()}}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find(".radioListCategoryItem:not(.example) input[type=radio]").prop("checked",!1)}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CAT_RADIOTABLE]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into CategoriseCheckBoxList constructor !";if(this.$activity=b,this.$selector=this.$activity.find(".categorise.radioTable[data-rcfinteraction=categorise]"),!RCF.Utils.isEmpty(this.$selector)){var c=this,d=this.$selector.find(".tableAnswerRow:not(.example)");this.$selector.find("table").mmRandomizeRanks(".tableAnswerRow"),d.tsort("",{attr:"data-rank",order:"asc"});var e=this.$selector.find(".tableAnswerRow");e.filter(":odd").addClass("odd"),e.filter(":even").addClass("even"),this.$selector.find("input[type=radio].example").on("change",function(b){b.stopPropagation(),b.preventDefault(),"y"==a(this).attr("data-correct")||a(this).closest("tr").find("input[type=radio]").filter("[data-correct='y']").prop("checked",!0)}),this.$selector.on("click","td",function(){var b=a(this).find("input[type=radio]:not(.example)");RCF.Utils.isEmpty(b)||b.prop("checked",!0)}),this.$activity.on("rcf.single.answer",".categorise.radioTable[data-rcfinteraction=categorise]:not(.example)",function(b,d,e){var f=a(this),g=d.elm;if(g===f.attr("data-rcfid")){var h="";for(var i in d.value){var j=d.value[i];for(var k in j.value)if(j.value[k]===e){h=j.elm;break}if(h.length>0)break}if(h.length>0){var l=c.$selector.find(".tableAnswerRow:not(.example) input[type='radio'][data-rcfid='"+e+"']"),m=c.$selector.find(".tableAnswerRow:not(.example) input[type='radio'][data-rcfid='"+e+"']:checked"),n=l.closest("tr");n.data("user-answer",m.val()),m=l.filter("[value='"+h+"']"),m.prop("checked",!0)}}})}},showAnswers:function(c,d){this.$selector.find(".tableAnswerRow:not(.example)").each(function(){var b=a(this),c=b.find("input[type=radio]:not(.example):checked");RCF.Utils.isEmpty(c)||b.data("user-answer",c.val())});for(var e in c.answers){var f=c.answers[e],g=f.elm,h=this.$selector.filter("[data-rcfid='"+g+"']");if(!RCF.Utils.isEmpty(h))for(var i in f.value){var j=f.value[i],k=j.elm;if(a.isArray(j.value)||!b.console)for(var l in j.value){var m=j.value[l];h.find("[data-rcfid='"+m+"']").prop("checked",!1),(d&&j.verification&&"1"==j.verification[l]||RCF.Utils.isEmpty(d)||!d)&&h.find("[data-rcfid='"+m+"'][value='"+k+"']").prop("checked",!0)}else console.log("no array passed to [rcf_categorise_radiotable.show answers] ! - skipping")}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=c.value[f];if(!RCF.Utils.isEmpty(g.verification))for(var h in g.value){var i=e.find("input[type=radio][data-rcfid='"+g.value[h]+"']:checked");if(!RCF.Utils.isEmpty(i)){var j="1"==g.verification[h]?"correct":"wrong";i.closest(".radioTableItem").find(".mark").addClass(j)}}}}}},showUserAnswers:function(){this.$selector.find(".tableAnswerRow:not(.example)").each(function(){var b=a(this),c=b.data("user-answer");RCF.Utils.isEmpty(c)?b.find("input[type=radio]").prop("checked",!1):b.find("input[type=radio][value='"+c+"']").prop("checked",!0)})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this),d=c.find(".tableAnswerRow:not(.example)");d.find("input[type=radio]:checked").length<d.length&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this),c=b;return{elm:b.attr("data-rcfid"),type:"composite",value:c.find(".tableHeadRow th[data-catid]").map(function(){var b=a(this).attr("data-catid");return{elm:b,type:"list",value:c.find(".tableAnswerRow:not(.example) input[type=radio][value='"+b+"']:checked").map(function(){return a(this).attr("data-rcfid")}).get()}}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find(".tableAnswerRow:not(.example)").removeData("user-answer").find("input[type=radio]").prop("checked",!1)}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CAT_SELECTABLE]=function(){function c(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into the behavior constructor (CategoriseSelectable)";if(this.$activity=b,this.$selector=this.$activity.find(".eSpan.selectableCat:not(.example)"),!RCF.Utils.isEmpty(this.$selector)){this.$popup=this.$selector.closest(".interactiveText").find(".interactiveText_popup");var c=this.$activity.find(".interactiveText").attr("data-cats");this.categoryNames=c.replace("|"," ");var d=a("#rcfCatSelectMask"),e=b.closest(".activityContainer");d.length<1&&(d=a("<div class='rcfMask' id='rcfCatSelectMask'></div>").appendTo(e)),this.$mask=d,this._initialize()}}return c.prototype={_initialize:function(){var c=this;c.$selector.closest(".interactiveText").on("click",".eSpan.selectableCat:not(.example, .selecting)",function(d){var e=a(this);c.$popup.detach().prependTo(e).css("z-index","10020"),c.$selector.removeClass("selecting"),e.addClass("selecting");var f=e.data("user-answer");RCF.Utils.isEmpty(f)?c.$popup.find(".clear").hide():c.$popup.find(".clear").show(),d.pageX+c.$popup.width()>a(b).width()-80?c.$popup.css("left",-1*c.$popup.width()):c.$popup.css("left",0),c.$popup.height()>e.offset().top?c.$popup.css("bottom",c.$popup.height()/2*-1+"px"):c.$popup.css("bottom",e.height()+5),c.$popup.$fromElement=e,c.$mask.parent().css("position","relative"),c.$mask.css({opacity:"0.4"}).show().one("click",function(){a(this).parent().css("position","static"),c.$popup.fadeOut(200),c.$mask.hide(),e.removeClass("selecting")}),c.$popup.fadeIn(200),d.preventDefault(),d.stopPropagation()}),c.$popup.on("click","span",function(b){for(var d=c.$popup.$fromElement,e=d.find(".answer"),f=a(this),g=f.attr("data-catid"),h=c.categoryNames,i=h.split(" "),j=0,k=i.length;k>j;j++)d.removeClass("cat_"+(j+1));d.removeClass(h),f.hasClass("clear")?(d.removeData("user-answer").removeClass("selecting answered"),e.removeData("user-answer").text("").hide()):(e.text(" ("+a(this).text()+")").show(),d.data("chosen-answer",g).data("user-answer",g).removeClass("selecting").addClass("answered").addClass(h.split(" ")[f.index()]).addClass(f.attr("data-catIndex"))),c.$popup.$fromElement=null,c.$popup.fadeOut(200),c.$mask.hide(),b.preventDefault(),b.stopPropagation()}),c.$activity.on("rcf.single.answer",".interactiveText.type_selectableCat[data-rcfinteraction='interactiveText']",function(b,d,e){var f=a(this),g=d.elm;if(g===f.attr("data-rcfid")){c.$popup.fadeOut(200);for(var h=0;h<d.value.length;h++){var i=d.value[h];if(i.elm===e){var j=f.find("[data-rcfid='"+e+"']"),k=c.$popup.find("[data-catid='"+i.value+"']"),l=k.text(),m=k.attr("data-catindex");j.addClass("answered "+l+" "+m).data("chosen-answer",i.value).find(".answer").text(" ("+l+")").show()}}}})},showAnswers:function(b,c){for(var d=this,e="",f=d.categoryNames,g=f.split(" "),h=0,i=g.length;i>h;h++)e+="cat_"+(h+1)+" ";d.$popup.fadeOut(200);for(var j in b.answers){var k=b.answers[j],l=k.elm,m=k.type;if(!RCF.Utils.isEmpty(l)){var n=this.$activity.find(".interactiveText[data-rcfid='"+l+"']");if(!RCF.Utils.isEmpty(n)){if(n.find(".eSpan.answered:not(.example)").each(function(){var b=a(this);b.removeClass(f+" answered "+e).data("user-answer",b.data("chosen-answer")).data("chosen-answer","").find(".answer").text("").hide()}),"composite"!=m)throw"Invalid JSON Answers provided for interactive text block - should be 'composite' : \n\n"+JSON.stringify(b);for(var o in k.value){var p=k.value[o],q=p.elm,r=p.value,s=n.find("[data-rcfid='"+q+"']"),t=d.$popup.find("[data-catid='"+r+"']"),u=t.text(),v=t.attr("data-catindex");(c&&p.verification&&"1"==p.verification[0]||RCF.Utils.isEmpty(c)||!c)&&s.removeClass(f).removeClass(e).data("chosen-answer",r).addClass("answered "+u+" "+v).find(".answer").text(" ("+u+")").show()}}}}},showMarkedAnswers:function(a){var b=a.id,c=this.$activity.attr("id");if(b!=c)throw"Invalid JSON Marked Answers Object provided for activity ["+c+"]\n\nAnswers provided were for activity ["+a.id+"]";this.clearMarkedAnswers();for(var d in a.answers){var e=a.answers[d],f=e.elm;
if(!RCF.Utils.isEmpty(f)){var g=this.$activity.find(".interactiveText[data-rcfinteraction=interactiveText][data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g))for(var h in e.value){var i=e.value[h];if(!RCF.Utils.isEmpty(i.verification)){var j=g.find("[data-rcfid='"+i.elm+"']");if(!RCF.Utils.isEmpty(j)){var k="1"==i.verification[0]?"correct":"wrong";j.find(".mark").addClass(k)}}}}}},showUserAnswers:function(){for(var b=this,c="",d=b.categoryNames,e=d.split(" "),f=0,g=e.length;g>f;f++)c+="cat_"+(f+1)+" ";this.$selector.find(".answer").each(function(){var e=a(this),f=e.closest(".eSpan.selectableCat"),g=f.data("user-answer");if(f.removeClass(c+" answered "+d),RCF.Utils.isEmpty(g))f.data("chosen-answer",""),e.text("").removeClass("answered").hide();else{var h=b.$popup.find("[data-catid='"+g+"']"),i=h.attr("data-catindex"),j=h.text();f.data("chosen-answer",g).addClass("answered "+j+" "+i),e.text(" ("+j+")").addClass("answered").show()}})},isComplete:function(){var b=!0;return this.$activity.find(".interactiveText").each(function(){var c=a(this),d=c.find(".eSpan:not(.example, .selecting)");d.length>d.filter(".answered").length&&(b=!1)}),b},getUserAnswers:function(){return this.$activity.find(".interactiveText").map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"composite",value:b.find(".eSpan.answered:not(.example, .selecting)").map(function(){var b=a(this),c=b.data("chosen-answer");return{elm:b.attr("data-rcfid"),type:"simple",value:c||""}}).get()}}).get()},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){for(var a="",b=this.categoryNames,c=b.split(" "),d=0,e=c.length;e>d;d++)a+="cat_"+(d+1)+" ";this.$activity.find(".interactiveText .eSpan.selectableCat:not(.example, .selecting)").removeClass(b+" answered "+a).removeData("chosen-answer").removeData("user-answer").find(".answer").text("").hide()},close:function(){this.$popup.remove()}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CAT_TOUCHABLE]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into touchable categorise constructor !";if(this.$activity=b,this.$selector=this.$activity.find("[data-rcfinteraction=categorise].categorise.touchable"),!RCF.Utils.isEmpty(this.$selector)){this.categoriseObjects=[];var c=this;c.$selector.each(function(){c.categoriseObjects.push(new RCF.Handlers.MovableCategoriseHandler(a(this),"touchable"))}),this._setupTouchableCategorise(),this.$activity.on("rcf.single.answer",".categorise.touchable[data-rcfinteraction=categorise]:not(.example)",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=[];for(var h in c.value){var i=c.value[h];for(var j in i.value)i.value[j]===d&&g.push(i.elm)}if(g.length>0){for(var k=e.find(".wordBox li[data-rcfid='"+d+"']"),l=0;l<g.length;l++){var m=e.find(".category[data-rcfid='"+g[l]+"'] .dropTarget ul");m.append(k.removeClass("selected").clone())}e.hasClass("complexCategorise")||k.addClass("dragged")}RCF.publish("update.categories.size")}})}},_setupTouchableCategorise:function(){var b=this.$selector.find(".category:even");b.each(function(){a(this).addClass("leftCategory").next(".category").addClass("rightCategory").add(this).wrapAll("<div class='mobileCategoryContainer'>")})},showAnswers:function(c,d){var e=this.$selector.find(".category");e.each(function(){var b=a(this),c=[];b.find("li:not(.answers)").each(function(){c.push(this.id)}),b.data("user-answer",c)}),e.find("li:not(.example)").remove();for(var f in c.answers){var g=c.answers[f],h=g.elm,i=this.$selector.filter("[data-rcfid='"+h+"']");if(!RCF.Utils.isEmpty(i)){i.find(".wordBox li").removeClass("dragged");for(var j in g.value){var k=g.value[j],l=k.elm,m=this.$selector.find("[data-rcfid='"+l+"'].category .dropTarget ul");if(a.isArray(k.value)||!b.console)for(var n in k.value){var o=k.value[n],p=i.find(".wordBox li[data-rcfid='"+o+"']");(d&&k.verification&&"1"==k.verification[n]||RCF.Utils.isEmpty(d)||!d)&&(m.append(p.removeClass("selected").clone()),i.hasClass("complexCategorise")||p.addClass("dragged"))}else console.log("no array passed to [rcf_categorise_touchable.show answers] ! - skipping")}}}e.find("li:not(.example)").removeClass("dragged"),RCF.publish("update.categories.size")},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=c.value[f];if(!RCF.Utils.isEmpty(g.verification))for(var h in g.value){var i=e.find(".category .dragItem[data-rcfid='"+g.value[h]+"']");if(!RCF.Utils.isEmpty(i)){var j="1"==g.verification[h]?"correct":"wrong";i.find(".mark").addClass(j)}}}}}},showUserAnswers:function(){this.$selector.find(".category li:not(.example)").remove(),this.$selector.find(".wordBox li").removeClass("dragged");var b=this.$selector.find(".category");b.each(function(){var b=a(this),c=b.closest(".categorise").find(".wordBox"),d=b.data("user-answer");if(RCF.Utils.isEmpty(d));else for(var e=0,f=d.length;f>e;e++){var g=d[e],h=c.find("li[id='"+g+"']");RCF.Utils.isEmpty(h)||(b.find(".dropTarget ul").append(h.clone()),b.closest(".categorise").hasClass("complexCategorise")||h.addClass("dragged"))}}),RCF.publish("update.categories.size")},isComplete:function(){var b=!1;return this.$selector.each(function(){var c=a(this);c.find(".category li:not(.example)").length>0&&(b=!0)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"composite",value:b.find(".category").map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"list",value:b.find("li").map(function(){return a(this).attr("data-rcfid")}).get()}}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find(".category li:not(.example)").remove(),this.$selector.find(".wordBox li:not(.example)").data("moved","").removeClass("dragged").removeClass("selected"),this.$selector.find(".dropTarget").css("height",""),RCF.publish("update.categories.size")}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CHECKBOXLIST_SELECTABLE]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed to behavior constructor (CheckboxItemSelectable)";this.$activity=b,this.$selector=this.$activity.find("*[data-rcfinteraction=checkboxItemSelect]"),RCF.Utils.isEmpty(this.$selector)||(this.$selector.on("click",".selectable.checkbox:not(.example, .disabled)",function(){var b=a(this),c=b.closest(".checkboxItemSelect"),d=c.find(".selectable.checkbox:not(.example)"),e=parseInt(c.attr("data-rcfrestrict"),10)||0;if(b.toggleClass("selected").data("user-answer",b.hasClass("selected")?"Y":"N"),!(1>e)){var f=d.filter(".selected");f.length>=e?d.not(".selected").addClass("disabled"):d.removeClass("disabled")}}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=checkboxItemSelect]:not(.example)",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=e;if(d||0===d){var h=c.value[d],i=g.find(".checkbox.selectable[data-rcfid='"+h+"']:not(.example)");i.data("user-answer",i.hasClass("selected")?"Y":"").addClass("selected")}}}))},showAnswers:function(a,b){for(var c in a.answers){var d=a.answers[c],e=d.elm,f=d.value,g=d.type;if(!RCF.Utils.isEmpty(f)&&"list"===g){var h=this.$selector.filter(".checkboxItemSelect[data-rcfid='"+e+"']");if(!RCF.Utils.isEmpty(h)){var i=h.find(".checkbox.selectable:not(.example)");i.data("user-answer","N").filter(".selected").data("user-answer","Y").removeClass("selected");for(var j in f){var k=b?d.verification&&"1"==d.verification[j]?"selected":"":"selected";i.filter("[data-rcfid='"+f[j]+"']").addClass(k)}}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g="1"==c.verification[f]?"correct":"wrong";e.find("[data-rcfid='"+c.value[f]+"']").find(".mark").addClass(g)}}}},showUserAnswers:function(){this.$selector.find(".checkbox.selectable:not(.example)").each(function(){var b=a(this);b.removeClass("selected").addClass("Y"==b.data("user-answer")?"selected":"")})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this),d=parseInt(c.attr("data-rcfrestrict"),10)||0,e=c.find(".selectable.checkbox.selected:not(.example)");d>0?e.length!==d&&(b=!1):e.length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"list",value:b.find(".checkbox.selectable.selected:not(.example)").map(function(){return a(this).attr("data-rcfid")}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find(".checkbox.selectable:not(.example)").removeClass("selected").removeData("user-answer")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CHECKBOXLIST]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed to behavior constructor";this.$activity=b,this.$selector=this.$activity.find("*[data-rcfinteraction=checkboxList]"),RCF.Utils.isEmpty(this.$selector)||(this.$selector.on("change",".example",function(b){b.preventDefault();var c=a(this).prop("checked");return c=!c,a(this).prop("checked",c),!1}),this.$selector.on("change",function(){var b=a(this),c=parseInt(b.attr("data-rcfrestrict"),10)||0;if(!(1>c)){var d=b.find("input:checkbox").filter(":not(.example)");d.filter(":checked").length>=c?d.not(":checked").attr("disabled","disabled"):d.removeAttr("disabled")}}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=checkboxList]:not(.example)",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=e;if(d||0===d){var h=c.value[d],i=g.find("input[type='checkbox'][data-rcfid='"+h+"']:not(.example)");i.data("user-answer",i.prop("checked")).prop("checked",!0);var j=parseInt(g.attr("data-rcfrestrict"),10)||0;j>0&&(g.find("input[type='checkbox']:checked").length>=j?g.find("input[type='checkbox']").not(":checked").attr("disabled","disabled"):g.removeAttr("disabled"))}}}))},showAnswers:function(c,d){for(var e in c.answers){var f=c.answers[e],g=f.elm,h=f.value,i=f.type;if(!RCF.Utils.isEmpty(g)&&"list"===i){var j=this.$selector.filter("[data-rcfid='"+g+"']");if(!RCF.Utils.isEmpty(j)){var k=j.find("input[type='checkbox']:not(.example)"),l=parseInt(j.attr("data-rcfrestrict"),10)||0;if(k.data("user-answer",!1).filter(":checked").data("user-answer",!0).prop("checked",!1),!a.isArray(h)){b.console&&console.log("no array passed to [rcf_checkBoxList.show answers] ! - attempting...");var m=h;h=[],h.push(m)}for(var n in h){var o=d?f.verification&&"1"==f.verification[n]?!0:!1:!0;k.filter("[data-rcfid='"+h[n]+"']").prop("checked",o)}l>0&&(k.filter(":checked").length===l?k.filter(":not(:checked)").attr("disabled","disabled"):k.removeAttr("disabled",""))}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=e.find(".checkbox[data-rcfid='"+c.value[f]+"']"),h="1"==c.verification[f]?"correct":"wrong";g.closest(".markable").find(".mark").addClass(h)}}}},showUserAnswers:function(){var b=this.$activity.find("input[type='checkbox']:not(.example)");b.each(function(){var b=a(this);b.prop("checked",b.data("user-answer")||!1)})},isComplete:function(){var b=!0;return this.$selector.filter(":not(.example)").each(function(){var c=a(this),d=parseInt(c.attr("data-rcfrestrict"),10)||0,e=c.find("input[type=checkbox]:checked");d>0?e.length!==d&&(b=!1):e.length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.filter(":not(.example)").map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"list",value:b.find("input[type=checkbox]:checked:not(.example)").map(function(){return a(this).attr("data-rcfid")}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find("input[type='checkbox']:not(.example)").prop("checked",!1).removeAttr("disabled").removeData("user-answer")}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.CROSSWORD]=function(){function c(a){this._initialize(a)}function d(a){this["char"]=a,this.across=null,this.down=null}function e(a,b){this.startOfWord=a,this.index=b.index,this.wordID=b.id,this.isExample=b.isExample,this.wordElement=b}function f(a,b,c,d,e){this.word=a.toUpperCase(),this.id=b,this.index=c,this.isExample=d,this.isExampleFirstLetter=e}function g(a){var c,g=50,h=50,i={};this.getSquareGrid=function(a){for(var b=null,c=0,d=null,e=0,f=0;a>f&&(d=this.getGrid(1),null===d||(e=1*Math.min(d.length,d[0].length)/Math.max(d.length,d[0].length),e>c&&(b=d,c=e),1!==c));f++);return b},this.getGrid=function(a){for(var b=[],d=!1,e=0,f=0,g=0,h=null,i=0;a>i;i++){if(q(),e=o(),f=Math.floor(r.length/2),g=Math.floor(r[0].length/2),h=t[0],"across"==e?g-=Math.floor(h.word.length/2):f-=Math.floor(h.word.length/2),n(h.word,f,g,e)===!1)return c=[h],null;l(h,f,g,e),b.push(t.slice(1));for(var k=0;k<b.length;k++){d=!1;for(var m=0;m<b[k].length;m++){var s=b[k][m],u=p(s.word);if(u){var v=u.row,w=u.col,x=u.direction;l(s,v,w,x),d=!0}else b.length-1==k&&b.push([]),b[k+1].push(s)}if(!d)break}if(d)return j()}return c=b[b.length-1],null},this.getBadWords=function(){return c},this.getLegend=function(b){for(var c={across:[],down:[]},d=!1,e=1,f=0;f<b.length;f++)for(var g=0;g<b[f].length;g++){var h=b[f][g];d=!1;for(var i in c)if(h&&h[i]&&h[i].startOfWord){var j=h[i].index;c[i].push({position:e,index:j,clue:a[j].clue,word:a[j].word,isExample:a[j].isExample,wordID:a[j].id}),d=!0}d&&e++}return c},this.getHTML=function(a){this.deviceMode=RCF.Utils.cookie("deviceMode"),RCF.Utils.isEmpty(this.deviceMode)&&(this.deviceMode="desktop");var c="desktop"!=this.deviceMode;if(null==a)return b.console&&console.log("No grid supplied to 'getHTML'"),"<table class='crossword'><tr><td>No grid supplied</td></tr></table>";var d=[],e=1,f="",g=!1,h=null,i="",j="";d.push("<table class='crossword'>");for(var k=0;k<a.length;k++){d.push("<tr data-row='"+k+"'>");for(var l=0;l<a[k].length;l++){if(h=a[k][l],g=!1,f=h?"word":"no-border",g=h?h.across&&h.across.startOfWord||h.down&&h.down.startOfWord:!1,j=h?h.across&&"y"==h.across.isExample||h.down&&"y"==h.down.isExample:!1,j=j||g&&(h.across&&h.across.startOfWord&&h.across.wordElement.isExampleFirstLetter||h.down&&h.down.startOfWord&&h.down.wordElement.isExampleFirstLetter),d.push("<td data-col='"+l+"' class='"+f+(g?" word"+e:"")+(j?" example ":"")+"' >"),"word"==f){i="",i=h.across&&h.down?"none":h.across?"horizontal":"vertical",g&&d.push("<span class='relSpan'><span class='clueNumber'>"+e+"</span></span>"),d.push("<input class='cwWord "+(j?" example ":"")+(g?"wordStart word"+e:"")+"' type='text' colid='"+l+"' data-direction='"+i+"' ");var m="",n="";h&&h.across&&(m+="|"+h.across.index+"|",n+="|"+h.across.wordID+"|"),h&&h.down&&(m+="|"+h.down.index+"|",n+="|"+h.down.wordID+"|"),j&&d.push(" READONLY value='"+h["char"]+"' "),d.push(" data-letter='"+h["char"]+"' "),d.push(" data-wordindex='"+m+"' data-wordid='"+n+"' "+(c?" READONLY ":"")+">")}else d.push("&nbsp;");g&&e++}d.push("</td>")}return d.push("</table>"),d.join("\n")};var j=function(){var a=g-1,b=0,c=h-1,d=0,e=0,f=0,i=0,j=0,k=null;for(i=0;g>i;i++)for(j=0;h>j;j++)k=r[i][j],null!=k&&(a>i&&(a=i),i>b&&(b=i),c>j&&(c=j),j>d&&(d=j));var l=b-a+1,m=d-c+1,n=new Array(l);for(i=0;l>i;i++)for(j=0;m>j;j++)n[i]=new Array(m);for(i=a,e=0;l>e;i++,e++)for(j=c,f=0;m>f;j++,f++)n[e][f]=r[i][j];return n},k=function(a,b,c,f,g){var h=a.word.charAt(b);null==r[c][f]&&(r[c][f]=new d(h),i[h]||(i[h]=[]),i[h].push({row:c,col:f}));var j=0===b;r[c][f][g]=new e(j,a)},l=function(a,b,c,d){var e=0,f=0,g=0;if("across"==d)for(e=c,f=0;e<c+a.word.length;e++,f++)k(a,f,b,e,d);else{if("down"!=d)throw"Invalid Direction";for(g=b,f=0;g<b+a.word.length;g++,f++)k(a,f,g,c,d)}},m=function(a,b,c){return null==r[b][c]?0:r[b][c]["char"]==a?1:!1},n=function(a,b,c,d){var e=0,f=0,g=!1,h=!1,i=!1,j=!1,k=0;if(0>b||b>=r.length||0>c||c>=r[b].length)return!1;if("across"==d){if(c+a.length>r[b].length)return!1;if(c-1>=0&&null!=r[b][c-1])return!1;if(c+a.length<r[b].length&&null!=r[b][c+a.length])return!1;for(e=b-1,f=c,s=0;e>=0&&f<c+a.length;f++,s++)if(h=null==r[e][f],i=null!=r[b][f]&&r[b][f]["char"]==a.charAt(s),j=h||i,!j)return!1;for(e=b+1,f=c,s=0;e<r.length&&f<c+a.length;f++,s++)if(h=null==r[e][f],i=null!=r[b][f]&&r[b][f]["char"]==a.charAt(s),j=h||i,!j)return!1;for(k=0,f=c,s=0;f<c+a.length;f++,s++){if(g=m(a.charAt(s),b,f),g===!1)return!1;k+=g}}else{if("down"!=d)throw"Invalid Direction";if(b+a.length>r.length)return!1;if(b-1>=0&&null!=r[b-1][c])return!1;if(b+a.length<r.length&&null!=r[b+a.length][c])return!1;for(f=c-1,e=b,s=0;f>=0&&e<b+a.length;e++,s++)if(h=null==r[e][f],i=null!=r[e][c]&&r[e][c]["char"]==a.charAt(s),j=h||i,!j)return!1;for(f=c+1,e=b,s=0;e<b+a.length&&f<r[e].length;e++,s++)if(h=null==r[e][f],i=null!=r[e][c]&&r[e][c]["char"]==a.charAt(s),j=h||i,!j)return!1;for(k=0,e=b,s=0;e<b+a.length;e++,s++){if(g=m(a.charAt(s,1),e,c),g===!1)return!1;k+=g}}return k},o=function(){return Math.floor(2*Math.random())?"across":"down"},p=function(a){for(var b=[],c=0;c<a.length;c++){var d=i[a.charAt(c)];if(d)for(var e=0;e<d.length;e++){var f=d[e],g=f.row,h=f.col,j=n(a,g,h-c,"across"),k=n(a,g-c,h,"down");j!==!1&&b.push({intersections:j,row:g,col:h-c,direction:"across"}),k!==!1&&b.push({intersections:k,row:g-c,col:h,direction:"down"})}}if(b.length<1)return!1;var l=b[Math.floor(Math.random()*b.length)];return l},q=function(){for(var a=0;a<r.length;a++)for(var b=0;b<r[a].length;b++)r[a][b]=null;i={}};if(a.length<2)throw"A crossword must have at least 2 words";var r=new Array(g),s=0;for(s=0;g>s;s++)r[s]=new Array(h);var t=[];for(s=0;s<a.length;s++)t.push(new f(a[s].word,a[s].id,s,a[s].isExample,a[s].firstLetterExample));t.sort(function(a,b){return b.word.length-a.word.length}),this.words=t}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed to Crossword behavior constructor";this.$activity=b,this.$selector=b.find("*[data-rcfinteraction='crossword']");var c="";c=this.$activity.attr("id"),c+=this.$activity.attr("data-seed")||"",Math.seedrandom(c),this.deviceMode=RCF.Utils.cookie("deviceMode"),RCF.Utils.isEmpty(this.deviceMode)&&(this.deviceMode="desktop");var d=this,e=a("#rcfCrosswordMask"),f=b.closest(".activityContainer");e.length<1&&(e=a("<div class='rcfMask' id='rcfCrosswordMask'></div>").appendTo(f)),this.$mask=e,this.$selector.each(function(){var b=a(this),c=b.find(".rcfCrossword"),e=b.find(".crosswordClueContainer"),f=JSON.parse(c.html()),h=new g(f),i=10,j=h.getSquareGrid(i);if(RCF.Utils.isEmpty(j)){var k="<div class='rcfCrossword invalid'><h3>Cannot build a crossword with these words</h3>";k+="<h4>The following words could not be placed in a grid / intersection</h4>";var l=h.getBadWords();k+="<ul>";for(var m=0;m<l.length;m++)k+="<li>id['"+l[m].id+"]: "+l[m].word+"</li>";return k+="</ul>",void c.html(k)}c.html(h.getHTML(j)),b.data("internalCW",h);var n=b.attr("data-hiddenword");if(n&&n.length>0)for(var o=n.toUpperCase().split(""),p=0;p<o.length;p++){var q=c.find("input.cwWord[data-letter='"+o[p]+"']:not(.hiddenLetter,.example)");if(!(q.length<1&&(q=c.find("input.cwWord[data-letter='"+o[p]+"']:not(.hiddenLetter)"),q.length<1))){var r=q.length,s=Math.floor(Math.random()*r);a(q[s]).addClass("hiddenLetter")}}var t=b.find(".hiddenClues"),u=[],v=0,w=h.getLegend(j);for(var x in w){var y=v++<1?"across":"down",z="across"===y?"Across":"Down";u.push("<div class='"+y+"'>"),u.push("<h3>"+z+"</h3>"),u.push("<ul>");for(var A=0;A<w[x].length;A++){var B=t.find("li[data-wordid='"+w[x][A].wordID+"']");B.find(".crosswordClueNumber").text(w[x][A].position),u.push(B[0].outerHTML)}u.push("</ul></div>")}if(t.remove(),e.prepend(u.join("\n")),"desktop"!==d.deviceMode){var C=function(b){D.data("wordID",b),d.$mask.parent().css("position","relative"),d.$mask.css({opacity:"0.4"}).show().on("click",function(){d.$mask.hide(),d.$mask.parent().css("position","static"),D.hide()});var e=c.find("input.cwWord[data-wordid*='|"+b+"|']"),f=e.map(function(){return a(this).val()}).get().join("");f.length<e.length&&(f=e[0].value);var g=c.closest(".crosswordContainer").find(".crosswordClueContainer li[data-wordid='"+b+"']");D.data("wordID",b),D.find(".crosswordClueLabel").html(g.html()+" ("+e.length+")"),D.show(),D.find(".crosswordMobileTypein").val(f).focus().attr("maxlength",e.length)};c.on("click",".cwWord:not(.example)",function(){var b=a(this);if("none"!=b.attr("data-direction")){var c=b.attr("data-wordid").replace(/\|/g,"");C(c)}});var D=c.closest(".crosswordContainer").find(".crosswordPopup");D.on("keyup",function(b){13===b.keyCode?D.find(".okButton").trigger("click"):D.find(".crosswordMobileTypein").val(a(this).find(".crosswordMobileTypein").val().toUpperCase())}),D.on("click",".okButton",function(){var a={elm:c.closest(".crosswordContainer").attr("data-rcfid"),value:[{elm:D.data("wordID"),value:D.find(".crosswordMobileTypein").val()}]};D.hide(),d.$mask.trigger("click"),c.closest(".crosswordContainer").trigger("rcf.single.answer",[a,D.data("wordID")])}),D.on("click",".cancelButton",function(){D.hide(),d.$mask.trigger("click")}),e.on("click","li",function(){var b=a(this),e=b.attr("data-wordid");C(e),d.$activity.scrollTop(c.scrollTop())})}else{var E=c.find("table.crossword"),F=function(b){return a.grep(b.attr("data-wordid").split("|"),function(a){return a.length>0})},G=function(a){return e.find("li[data-wordid='"+a+"']")},H=function(a){return e.find("li:not([data-wordid='"+a.join("'],[data-wordid='")+"'])")},I=function(a){return E.find("input[data-wordid*='|"+a+"|']")},J=function(a){return E.find("input:not([data-wordid*='|"+a.join("|'],[data-wordid*='|")+"|'])")};c.on("click","td .relSpan",function(){var b=a(this).closest("td"),c=b.find("input");c.focus()}),e.on("click","li",function(){var b=a(this),c=b.attr("data-wordid");b.addClass("selected"),H(new Array(c)).removeClass("selected");var d=I(c);d.removeClass("incorrect"),d.addClass("editing"),J(new Array(c)).removeClass("editing"),d.first().focus()}),c.on("focus",".cwWord",function(){var b=a(this),c=F(b);b.hasClass("editing")?(J(c).removeClass("editing"),H(c).removeClass("selected")):(E.find("input").removeClass("editing"),e.find("li").removeClass("selected"),a.each(c,function(a,b){var c=I(b);c.removeClass("incorrect"),c.addClass("editing"),G(b).addClass("selected")})),b.select()}),c.on("keydown",".cwWord",function(b){var d=a(this),e=d.closest("td"),f=e.closest("tr").attr("data-row"),g=e.attr("data-col"),h=c.data("previousOrientation"),i=d.attr("data-direction"),j=function(a,b){return E.find("tr[data-row='"+a+"'] td[data-col='"+b+"'] input")},k=function(a){if("none"===i){var b,c;a?(b=j(f,parseInt(g)-1),c=j(parseInt(f)-1,g)):(b=j(f,parseInt(g)+1),c=j(parseInt(f)+1,g)),b.hasClass("editing")?i=c.hasClass("editing")?null==h||"none"===h?"horizontal":h:"horizontal":c.hasClass("editing")&&(i="vertical")}};if(b.which>=37&&b.which<=40)switch(b.which){case 37:g--;break;case 38:f--;break;case 39:g++;break;case 40:f++}else b.which>64?(d.hasClass("example")||d.val(String.fromCharCode(b.which)),k(!1),"horizontal"===i?g++:"vertical"===i&&f++):8===b.which&&(d.hasClass("example")||d.val(""),k(!0),"horizontal"===i?g--:"vertical"===i&&f--);var l=j(f,g);null==l?e.select():(h=i,c.data("previousOrientation",h),l.focus()),b.preventDefault()})}}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction='crossword']",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=e,h=g.data("internalCW");if(h)for(var i=0;i<c.value.length;i++){var j=c.value[i].elm,k=c.value[i].value;j==d&&(g.find("input.cwWord[data-wordid*='|"+j+"|']").each(function(b){a(this).hasClass("example")||a(this).val(k.substr(b,1))}),g.find("input.cwWord[data-wordid*='|"+j+"|']").addClass("editing"),setTimeout(function(){g.find("input.cwWord").removeClass("editing")},1e3))}}})},showAnswers:function(b,c){for(var d in b.answers){var e=b.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$selector.filter("[data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g)){var h=g,i=h.data("internalCW");if(!i)continue;h.find("input.cwWord:not(.example)").each(function(){var b=a(this);b.data("user-answer",b.val()),b.removeClass("incorrect").val("")});for(var j in e.value){var k=e.value[j].elm,l=e.value[j].value;c&&"0"==e.value[j].verification[0]||h.find("input.cwWord[data-wordid*='|"+k+"|']").each(function(b){a(this).val(l.substr(b,1))})}}}}},showMarkedAnswers:function(b){var c=b.id,d=this.$activity.attr("id");if(c!=d)throw"Invalid JSON Marked answers object provided for activity ["+d+"]\n\nAnswers provided were for activity ["+b.id+"]";this.clearMarkedAnswers();for(var e in b.answers){var f=b.answers[e],g=f.elm;if(!RCF.Utils.isEmpty(g)){var h=this.$selector.filter("[data-rcfid='"+g+"']");if(!RCF.Utils.isEmpty(h))for(var i in f.value){var j=f.value[i],k=j.elm,l="1"==j.verification[0],m=h.find("input.cwWord[data-wordid*='|"+k+"|']");l||m.addClass("incorrect");var n=m.eq(-2).attr("data-direction")||"horizontal";"none"===n&&(n=m.eq(-3).attr("data-direction")||"horizontal");var o=m.last().parent().find(".relSpan.marks");o.length<1?(o=a("<span class='relSpan marks'><span class='mark "+n+(l?" correct":" wrong")+"'></span></span>"),m.last().parent().append(o)):o.append(a("<span class='mark "+n+(l?" correct":" wrong")+"'></span>"))}}}},clearMarkedAnswers:function(){this.$selector.each(function(){a(this).find(".mark").parent().remove(),a(this).find("input.cwWord").removeClass("incorrect")})},showUserAnswers:function(){this.$selector.each(function(){var b=a(this);b.find("input.cwWord:not(.example)").each(function(){var b=a(this);b.val(b.data("user-answer")).removeData("user-answer")})})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this);c.find("input.cwWord").each(function(){a(this).val().length<1&&(b=!1)})}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this),c=b.find(".rcfCrossword"),d=b.data("internalCW");if(d){var e=function(){for(var b=d.words,e=[],f=0;f<b.length;f++){var g=b[f],h=g.index;"y"!==g.isExample&&e.push({elm:g.id,type:"simple",value:c.find("input.cwWord[data-wordindex*='|"+h+"|']").map(function(){return a(this).val()}).get().join("")})}return e}();return{elm:b.attr("data-rcfid"),type:"composite",markType:"item",value:e}}}).get();return b},reset:function(){this.$selector.find(function(){a(this).find("input.cwWord:not(.example)").removeClass("incorrect").val("")})}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.DROPDOWN]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into the behavior constructor (DropDown)";this.$activity=b,this.$selector=this.$activity.find("*[data-rcfinteraction=dropDown]"),RCF.Utils.isEmpty(this.$selector)||(this.$selector.find("select.example").focus(function(){var b=a(this),c=b.data("existingVal");RCF.Utils.isEmpty(c)&&b.data("existingVal",b.val())}).on("change",function(){var b=a(this);return b.val(b.data("existingVal")),!1}),this.$selector=this.$selector.filter(":not(.example)"),this.reset(),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=dropDown]",function(b,c){var d=a(this),e=c.elm;if(e===d.attr("data-rcfid")){var f=d.find("select:not(.example)");f.data("user-answer",f.val()).val(c.value)}}))},showAnswers:function(b,c){for(var d in b.answers){var e=b.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$selector.filter("[data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g)){var h=g.find("select:not(.example)"),i="";c?(i=e.verification&&"1"==e.verification[0]?e.value:"",h.data("user-answer",i),i.length<1&&h.prop("selectedIndex",-1)):(i=a.isArray(e.value)?e.value[0]:e.value,h.data("user-answer",h.val()).val(i))}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e)){var f="1"==c.verification[0]?"correct":"wrong";e.find(".mark").addClass(f)}}}},showUserAnswers:function(){this.$selector.each(function(){var b=a(this);b.find("select:not(.example)").each(function(){var b=a(this),c=b.data("user-answer");RCF.Utils.isEmpty(c)?b[0].selectedIndex=-1:b[0].value=c})})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this).find("select");c[0].selectedIndex<0&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"simple",value:b.filter(":not(.example)").find("select").val()||""}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find("select:not(.example)").removeData("user-answer").prop("selectedIndex",-1)}},b}()}(jQuery,window),function(a,b,c){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.DROPPABLES]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into behavior (SimpleDroppable) !";this.$activity=b,this.activityID=b[0].id,this.$selector=b.find("*[data-rcfinteraction='droppable']:not(.example),[data-rcfinteraction='complexDroppable']:not(.example)"),this.$wordList=this.$activity.find("div.wordBox ul"),this.wordBox=new RCF.Behaviors.Unmarked.WordBox(this.$wordList),this.dropTargets=new RCF.Handlers.DroppableTargetHandler(this.$activity),this.wordBox.randomizeItems(),this._determineUserInteraction();var c=this;this.$activity.on("rcf.single.answer","*[data-rcfinteraction*=roppable]",function(b,d){var e=a(this),f=d.elm;if(f===e.attr("data-rcfid")){var g=d.value;a.isArray(g)&&(g=g[0]),c._showAnswer(f,g),RCF.Utils.isEmpty(c.draggableHandler)||c.draggableHandler.enableDraggables(!0)}})},_determineUserInteraction:function(){var a=RCF.Utils.cookie("deviceMode");if(this.clickStickHandler=null,this.draggableHandler=null,"touch"in c)this.clickStickHandler=new RCF.Handlers.ClickStickHandler(this.$activity,"dragItem","dragTarget",!1);else{var b=RCF.Utils.isEmpty(a)?RCF.Utils.isTabletDevice()||RCF.Utils.isMobileDevice()?"touchable":"draggable":"desktop"!=a?"touchable":"draggable",d=this.$activity.attr("data-droppableclickstick");"y"==d&&(b="touchable");var e=this.$activity.attr("data-desktopdraggable");"n"==e&&(b="touchable"),this.mode=b,"touchable"==this.mode?this.clickStickHandler=new RCF.Handlers.ClickStickHandler(this.$activity,"dragItem","dragTarget",!1):"draggable"==this.mode&&(this.draggableHandler=new RCF.Handlers.DraggableActivityHandler(this.$activity))}},_showAnswer:function(a,b){var c=this.dropTargets.getDropTarget(a),d=this.wordBox.getWordItem(b),e=c.data("wordItemID");RCF.Utils.isEmpty(e)||(this.wordBox.addWordItem(this.wordBox.getWordItem(e)),this.dropTargets.clearDropTargets(c)),this.dropTargets.populateDropTarget(c,d),this.wordBox.removeWordItem(d)
},showAnswers:function(b,c){var d=this;d.wordBox.reset();for(var e in b.answers){var f=b.answers[e],g=f.elm,h=f.value;if(!RCF.Utils.isEmpty(g)){a.isArray(h)&&(h=f.value[0]);var i=d.$selector.filter("[data-rcfid='"+g+"']");RCF.Utils.isEmpty(i)||(i.find(".movable").each(function(){a(this).data("user-answer",a(this).data("wordItemID")||"")}),c?f.verification&&"1"==f.verification[0]?d._showAnswer(g,h):(d.dropTargets.clearDropTargets(i.find(".movable")),h.length>1&&d.wordBox.addWordItem(d.wordBox.getWordItem(h))):d._showAnswer(g,h))}}RCF.Utils.isEmpty(this.draggableHandler)||this.draggableHandler.enableDraggables(!0),RCF.Utils.isEmpty(this.clickStickHandler)||this.clickStickHandler.reset()},showMarkedAnswers:function(a){this.clearMarkedAnswers(),RCF.Utils.isEmpty(this.draggableHandler)||this.draggableHandler.enableDraggables(!1);for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e)){var f="1"==c.verification[0]?"correct":"wrong";e.find(".mark").addClass(f)}}}},showUserAnswers:function(){var b=this;b.wordBox.reset(),this.$selector.find(".movable").each(function(){var c=a(this),d=c.data("user-answer");b._showAnswer(c.closest(".markable").attr("data-rcfid"),d||"")});try{RCF.Utils.isEmpty(this.draggableHandler)||(this.draggableHandler.reset(),this.draggableHandler.enableDraggables(!0))}catch(c){}},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this).find(".dragTarget.movable").data("wordItemID")||"";c.length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"simple",value:b.find(".dragTarget.movable").data("wordItemID")||""}}).get();return b},clearMarkedAnswers:function(){RCF.Utils.isEmpty(this.draggableHandler)||this.draggableHandler.enableDraggables(!0),this.$selector.find(".mark").removeClass("correct wrong")},close:function(){this.clickStickHandler&&(this.clickStickHandler.close(),this.clickStickHandler=null),this.draggableHandler&&(this.draggableHandler.close(),this.draggableHandler=null)},reset:function(){this.dropTargets.clearDropTargets(this.$selector.find(".movable")),this.wordBox.reset();try{var a=this.clickStickHandler||this.draggableHandler;a&&a.reset()}catch(b){console.log("No clickstick / drag handler")}}},b}()}(jQuery,window,document),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.LOCATING]=function(){function c(a){this._initialize(a)}function d(a){return a.length>1?a.replace(/[\])}[{(]/g,"").trim():a}return c.prototype={_initialize:function(c){if(RCF.Utils.isEmpty(c))throw"Empty Activity passed into Locating Behavior";this.$activity=c,this.activityID=c[0].id,this.$selector=this.$activity.find("*[data-rcfinteraction=locating]"),this.$sentenceSelector=this.$selector.filter(":not(.example)"),this.$answerSelector=this.$activity.find("*[data-rcfinteraction=locating] .locating_answer"),this.$popupSelector=this.$activity.find(".locating_popup");var e=null,f=this;this.$answerSelector.filter(":not(.example)").text(""),this.$answerSelector.filter(".example").show();var g=a("#rcfLocatingMask"),h=c.closest(".activityContainer");g.length<1&&(g=a("<div class='rcfMask' id='rcfLocatingMask'></div>").appendTo(h)),this.$mask=g,this.$activity.on("click",".locating .locatingItem:not(.markable,.example), .locating .locating_answer:not(.example)",function(c){var g=a(this).closest(".locating").find(".locatingItem");if(f._hidePopups(),!RCF.Utils.isEmpty(e)&&e[0].id===g[0].id)return void(e=null);e=g;var h=g[0].id,i=a("#loc_popup_"+h),j=g.closest(".locating").attr("data-type");f.$sentenceSelector.filter(".locatingSelecting").removeClass("locatingSelecting"),g.addClass("locatingSelecting"),c.pageX+i.width()>a(b).width()-40?i.css("left",-1*i.width()):i.css("left","0");var k=parseInt(i.css("bottom").replace("px",""));c.pageY-(i.height()+k)<40&&i.css("bottom","-"+(i.height()-i.height()/4)+"px"),"typein"==j&&a("#loc_popup_"+h+" input[type='text']").val(d(a("#loc_answer_"+h).text())).focus(),f.$mask.parent().css("position","relative"),f.$mask.css({opacity:"0.4"}).show().on("click",function(){a(this).parent().css("position","static"),f._hidePopups(),f.$mask.hide(),e=null,g.removeClass("locatingSelecting")}),i.fadeIn("fast",function(){"typein"==j&&a("#loc_popup_"+h+" input[type='text']").focus()}),c.stopPropagation(),c.preventDefault()}),this.$popupSelector.on("click",".locatingSpanPopup",function(b){var c=a(this),d=c.parent().attr("id"),g="#"+d.replace("loc_popup_",""),h=g.replace("loc","loc_answer_loc"),i=c.attr("data-rcfid"),j=a(h);a(g).addClass("answered"),j.data("chosen-answer",i).data("user-answer",i).text(" ("+c.text().trim()+")").show(),f._hidePopups(),f.$mask.hide(),f.$activity.find(".locatingItem").removeClass("locatingSelecting"),e=null,b.preventDefault(),b.stopPropagation()}),this.$popupSelector.on("click",".okButton",function(b){var c=a(this).closest(".locating_popup"),d=c.attr("id"),g="#"+d.replace("loc_popup_",""),h=c.find(".locatingText"),i=g.replace("loc","loc_answer_loc"),j=a(i),k=h.val();k.length>0?(a(g).addClass("answered"),j.data("chosen-answer",k).data("user-answer",k).text(" ("+k+")").show()):(a(g).removeClass("answered"),j.data("chosen-answer","").data("user-answer","").text("").show()),f.$mask.hide(),f._hidePopups(),a(".locatingItem").removeClass("locatingSelecting"),e=null,b.preventDefault(),b.stopPropagation()}),this.$popupSelector.on("keyup",function(b){13===b.keyCode&&a(this).find(".okButton").trigger("click")}),this.$popupSelector.on("click",".cancelButton",function(b){var c=a(this).closest(".locating_popup"),g=c[0].id.replace("loc_popup_",""),h=a("#loc_answer_loc_"+g);c.find("input[type='text']").val(d(h.text())),a(".locatingItem").removeClass("locatingSelecting"),e=null,f.$mask.hide(),f._hidePopups(),b.preventDefault(),b.stopPropagation()}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=locating]",function(b,c){var d=a(this),e=c.elm;if(e===d.attr("data-rcfid")){f._hidePopups();var g=c,h=g.type,i=d,j=i.find(".locatingItem"),k=i.find(".locating_answer"),l=i.attr("data-type"),m="",n="";"simple"==h?n=g.value:("list"==h||"choice"==h)&&(n=g.value[0]),"list"==l?m=f.$popupSelector.filter("[data-locatingid='"+e+"']").find(".locatingSpanPopup[data-rcfid='"+n+"']").text().trim():"typein"==l&&(m=n),k.data("chosen-answer",n).text(" ("+m+")").show(),j.addClass("answered")}})},showAnswers:function(b,c){this._hidePopups();for(var d in b.answers){var e=b.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=e.type,h=this.$sentenceSelector.filter("[data-rcfid='"+f+"']"),i=h.find(".locatingItem");if(!RCF.Utils.isEmpty(h)){var j=h.attr("data-type"),k="",l="";"simple"==g?l=e.value:("list"==g||"choice"==g)&&(l=a.isArray(e.value)?e.value[0]:e.value||""),"list"==j?k=this.$popupSelector.filter("[data-locatingid='"+f+"']").find(".locatingSpanPopup[data-rcfid='"+l+"']").text().trim():"typein"==j&&(k=l);var m=h.find(".locating_answer");if(m.data("user-answer",m.data("chosen-answer")||""),c)e.verification&&"1"==e.verification[0]?(m.data("chosen-answer",l).text(" ("+k+")").show(),i.addClass("answered")):(m.data("chosen-answer","").data("user-answer","").text("").hide(),i.removeClass("answered"));else{var n=k.length>0?" ("+k+")":"";m.data("chosen-answer",l).text(n).show(),k.length>0?i.addClass("answered"):i.removeClass("answered")}}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$sentenceSelector.filter("[data-rcfid='"+d+"']"),f="1"==c.verification[0]?"correct":"wrong";e.closest(".locating").find(".mark").addClass(f)}}},showUserAnswers:function(){var b=this;this.$answerSelector.filter(":not(.example)").each(function(){var c=a(this),d=c.closest(".locating"),e=c.data("user-answer"),f="";RCF.Utils.isEmpty(e)?c.text("").data("chosen-answer","").hide().closest(".locating").find(".locatingItem").removeClass("answered"):("list"===d.attr("data-type")?f=b.$popupSelector.filter("[data-locatingid='"+d.attr("data-rcfid")+"']").find(".locatingSpanPopup[data-rcfid='"+e+"']").text().trim():"typein"===d.attr("data-type")&&(f=e),c.text(" ("+f+")").data("chosen-answer",e).show().closest(".locating").find(".locatingItem").addClass("answered"))})},isComplete:function(){var b=!0;return this.$sentenceSelector.each(function(){var c=a(this),d=c.closest(".locating").find(".locating_answer"),e=d.data("chosen-answer")||"";e.trimAll().length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$sentenceSelector.map(function(){var b=a(this),c=b.closest(".locating").find(".locating_answer"),d=c.data("chosen-answer")||"";return d=RCF.Utils.fixQuotables(d),{elm:b.attr("data-rcfid"),type:"simple",value:d.trimAll()||""}}).get();return b},clearMarkedAnswers:function(){this.$selector.closest(".locating").find(".mark").removeClass("correct wrong")},reset:function(){this.$answerSelector.filter(":not(.example)").removeData("user-answer").removeData("chosen-answer").text("").hide().closest(".locating").find(".locatingItem").removeClass("answered"),this.$selector.find(".locating_popup.typein input").val("")},close:function(){this.$popupSelector.remove()},_hidePopups:function(){this.$popupSelector.fadeOut("fast"),this.$mask.hide()}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},b.jsPlumb=b.jsPlumb||null,RCF.Behaviors.Marked[RCF.BehaviorName.MATCHING]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(c){if(RCF.Utils.isEmpty(c))throw"Empty activity passed to Matching behavior !";var d=this;this.deviceMode=RCF.Utils.cookie("deviceMode"),RCF.Utils.isEmpty(this.deviceMode)&&(this.deviceMode="desktop"),this.isMobile="desktop"!=this.deviceMode,this.plumbing=b.jsPlumb.getInstance(),this.$activity=c,this.$selector=c.find("*[data-rcfinteraction='matching']"),this.$selector.find(".matchTargets").mmRandomize(".matchTargetContainer","seed:matchTargets"),this.$selector.find(".matchItems").mmRandomize(".matchItemContainer","seed:matchItems"),this.$selector.each(function(){var b=a(this);b.data("useAnchors","h"===(b.attr("data-display")||"v")?["Bottom","Top"]:["RightMiddle","LeftMiddle"])}),d.plumbing.bind("click",function(b){var c=a(b.source);c.length>0&&!c.hasClass("example")&&d.plumbing.detachAllConnections(b.targetId)});var e=this.$selector.filter(":not(.example)");e.length>0&&(e.on("click",".matchItemContainer:not(.example)",function(){var b=a(this).find(".matchItem"),c=b.closest(".matchingContainer");b.toggleClass("selected"),b.hasClass("selected")&&b.addClass("currentM"),c.find(".matchItem.selected:not(.currentM)").removeClass("selected"),b.removeClass("currentM")}),e.on("click",".matchTargetContainer:not(.example)",function(){var b=a(this).find(".matchTarget"),c=b.closest(".matchingContainer"),e=c.find(".matchItem.selected").first(),f=c.data("useAnchors");if(e.length>0){d.plumbing.detachAllConnections(e.attr("id")),d.plumbing.detachAllConnections(b.attr("id")),d.plumbing.connect({source:e.attr("id"),target:b.attr("id"),anchors:f,connector:["Bezier",{cssClass:"userAnswer"}],cssClass:"userAnswer",detachable:!1}),e.removeClass("selected"),b.removeClass("selected");try{d.plumbing.repaintEverything()}catch(g){}}})),this.$selector.find(".matchTarget.example").each(function(){var b=a(this),c=b.closest(".matchingContainer"),e=c.data("useAnchors"),f=b.attr("data-matchItem-rcfid").split("|")[0],g=c.find(".matchItem[data-rcfid='"+f+"']");if(RCF.Utils.isEmpty(g))throw"Cannot find matchItem with ID ["+f+"]";d.plumbing.detachAllConnections(b.attr("id")),d.plumbing.connect({source:g.attr("id"),target:b.attr("id"),anchors:e,connector:["Bezier",{cssClass:"showCorrectAnswer"}],cssClass:"showExampleAnswer",detachable:!1})}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction='matching']",function(b,c,e){var f=a(this),g=c.elm;if(g===f.attr("data-rcfid"))for(var h=f,i=h.data("useAnchors"),j=0;j<c.value.length;j++){var k=c.value[j].elm,l=c.value[j].value,m=null,n=null;if(k===e){n=h.find(".matchTarget[data-rcfid='"+k+"']"),m=h.find(".matchItem").filter(function(){return l.indexOf(a(this).attr("data-rcfid"))>-1}),d.plumbing.detachAllConnections(n.attr("id")),m.each(function(){var b=a(this),c=d.plumbing.getConnections({target:n[0].id});if(c.length<1){var e=d.plumbing.getConnections({source:b[0].id});e.length<1&&d.plumbing.connect({source:b.attr("id"),target:n[0].id,anchors:i,connector:["Bezier",{cssClass:"showCorrectAnswer"}],cssClass:"showCorrectAnswer",detachable:!1})}});try{d.plumbing.repaintEverything()}catch(o){}}}}),a(b).resize(function(){try{d.plumbing.repaintEverything()}catch(a){}}),setTimeout(function(){try{d.plumbing.repaintEverything()}catch(a){}},500)},showAnswers:function(b,c){var d=this;d.plumbing.setSuspendDrawing(!0);var e=null,f=null,g=null,h=null,i=null;for(var j in b.answers){var k=b.answers[j],l=k.elm;if(!RCF.Utils.isEmpty(l)){var m=this.$selector.filter("[data-rcfid='"+l+"']");if(!RCF.Utils.isEmpty(m)){e=m,h=e.data("useAnchors"),e.find(".matchTarget:not(.example)").each(function(){var b=a(this);i=d.plumbing.getConnections({target:b[0].id}),i&&i.length>0&&b.data("user-answer",i[0].sourceId),d.plumbing.detachAllConnections(b[0].id)});for(var n in k.value){var o=c&&"1"==k.value[n].verification[0]||(c?!1:!0);f=e.find(".matchTarget[data-rcfid='"+k.value[n].elm+"']"),g="choice"===k.value[n].type&&a.isArray(k.value[n].value)?e.find(".matchItem").filter(function(){return a.inArray(a(this).attr("data-rcfid"),k.value[n].value)>-1}):e.find(".matchItem[data-rcfid='"+k.value[n].value+"']"),(!c||c&&o)&&g.each(function(){var b=a(this),e=d.plumbing.getConnections({target:f[0].id});if(e.length<1){var g=d.plumbing.getConnections({source:b[0].id});g.length<1&&d.plumbing.connect({source:b.attr("id"),target:f.attr("id"),anchors:h,connector:["Bezier",{cssClass:c?"userAnswer":"showCorrectAnswer"}],detachable:c?!0:!1})}}),c&&!o&&f.removeData("user-answer")}}}}try{d.plumbing.setSuspendDrawing(!1,!0),d.plumbing.repaintEverything()}catch(p){}},showMarkedAnswers:function(a){this.clearMarkedAnswers();var b=a.id,c=this.$activity.attr("id");if(b!=c)throw"Invalid JSON Marked answers object provided for activity ["+c+"]\n\nAnswers provided were for activity ["+a.id+"]";this.clearMarkedAnswers();for(var d in a.answers){var e=a.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$selector.filter("[data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g))for(var h in e.value){var i=e.value[h].elm,j=g.find(".matchTarget[data-rcfid='"+i+"']"),k="1"==e.value[h].verification[0];j.length>0&&j.closest(".matchTargetContainer").find(".mark").addClass(k?"correct":"wrong")}}}},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},showUserAnswers:function(){var b=this;b.plumbing.setSuspendDrawing(!0),this.$selector.each(function(){var c=a(this),d=c.data("useAnchors");c.find(".matchTarget:not(.example)").each(function(){var c=a(this),e=c.data("user-answer");b.plumbing.detachAllConnections(c[0].id),e&&b.plumbing.connect({source:e,target:c[0].id,anchors:d,connector:["Bezier",{cssClass:"userAnswer"}],detachable:!0})})}),this.plumbing.setSuspendDrawing(!1,!0),this.plumbing.repaintEverything()},isComplete:function(){var b=!0,c=this;return this.$selector.each(function(){var d=a(this);d.find(".matchTargetContainer:not(.example, .distractor) .matchTarget[data-rcfid]:not(.example, .distractor)").each(function(){var d=a(this),e=c.plumbing.getConnections({target:d.attr("id")});(!e||e.length<1)&&(b=!1)})}),b},getUserAnswers:function(){var b=this,c=this.$selector.map(function(){var c=a(this),d=function(){var d=[];return c.find(".matchTarget:not(.example,.distractor)").each(function(){var c=a(this),e=b.plumbing.getConnections({target:c.attr("id")}),f="";e&&e.length>0&&(f=a("#"+e[0].sourceId).attr("data-rcfid")),d.push({elm:c.attr("data-rcfid"),type:"simple",value:f})}),d}();return{elm:c.attr("data-rcfid"),type:"composite",markType:"item",value:d}}).get();return c},close:function(){var b=this;this.$selector.each(function(){var b=a(this);b.removeData("useAnchors").off("click")}),b.plumbing.reset(),b.plumbing=null},reset:function(){var b=this;b.plumbing.setSuspendDrawing(!0),this.$selector.find(".matchTarget:not(.example)").each(function(){var c=a(this);c.removeData("user-answer"),b.plumbing.detachAllConnections(c[0].id)}),b.plumbing.setSuspendDrawing(!1,!0),b.plumbing.repaintEverything()}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.ORDERING]=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into behavior constructor !";this.$activity=b,this.activityID=b[0].id,this.deviceMode=RCF.Utils.cookie("deviceMode"),RCF.Utils.isEmpty(this.deviceMode)&&(this.deviceMode="desktop");var c="desktop"!=this.deviceMode;if(this.$selector=this.$activity.find("[data-rcfinteraction=ordering]"),!RCF.Utils.isEmpty(this.$selector)){var d=this.$selector.closest("div.activity").attr("data-desktopdraggable");this.$orderingSelector=this.$selector.find("ul.ordering"),this.$orderingSelector.parent().removeClass("mobile desktop").addClass(c?"mobile":"desktop"),this.$orderingSelector.filter(".example").each(function(){var b=a(this);b.find("li").each(function(b){a(this).attr("data-rank",b)})}),this.correctPositioning=this.getUserAnswers(),this.$orderingSelector.filter(":not(.positionable)").mmRandomize("li"),this.$orderingSelector.each(function(){var b=a(this),c=b.find("li.suffix");c.length>0&&(c.appendTo(b),c.attr("data-sortindex",c.index()))}),this.$orderingSelector=this.$orderingSelector.filter(":not(.example)"),this.$orderingSelector.filter(".positionable").find("li").removeClass("selected").tsort("",{attr:"data-sortindex",order:"asc"}),this.originalPositioning=this.getUserAnswers(),c||"n"==d?(this.$selector.find(".desktop").removeClass("desktop").addClass("mobile"),this._setupTouchableOrdering()):this._setupDraggableOrdering();var e=this;this.$selector.filter("[data-feedback='y']").each(function(){var b=a(this);e._showOrderingFeedback(b)}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=ordering]",function(b,c){var d=a(this),f=c.elm;if(f===d.attr("data-rcfid")){var g={answers:[]};g.answers.push(c),e.showAnswers(g)}})}},_setupTouchableOrdering:function(){var b=this;b.$activity.find("ul.ordering:not(.example)").on("click","li",function(){var b=a(this);if("y"!=b.attr("data-fixed")){if(b.hasClass("selected"))return void b.removeClass("selected");b.closest("ul").find("li.selected").removeClass("selected"),b.addClass("selected")}}),b.$activity.find(".orderingControls").on("click","a",function(){var c=a(this),d=null;d=c.closest(".orderingContainer").find("ul.ordering");var e=d.find("li.selected"),f=c.hasClass("orderingUpControl"),g=d.find("li[data-fixed='y']");if(g.each(function(){var b=a(this);b.data("pos",b.index())}),!RCF.Utils.isEmpty(e)){var h=function(){var a=d.hasClass("positionable")?"":".orderingItem";return f?e.prevAll(a).first():e.nextAll(a).first()}();if(!RCF.Utils.isEmpty(h)){if(f?e.insertBefore(h):e.insertAfter(h),!d.hasClass("positionable")){var i=a("<li></li>").prependTo(d);g=d.find("li[data-fixed='y']"),g.detach(),g.each(function(){var b=a(this),c=b.data("pos");b.insertAfter(a("li",d).eq(c))}),i.remove()}"y"==d.attr("data-capitalise")&&(d.hasClass("capitalise")||d.addClass("capitalise"));var j=d.closest("[data-rcfinteraction]");"y"==j.attr("data-feedback")&&b._showOrderingFeedback(j)}}})},_setupDraggableOrdering:function(){var b=this;b.$orderingSelector.each(function(){imagesLoaded(this,function(){var b=a(this.elements[0]),c=b.parent().hasClass("vertical")?"y":"";"y"==c&&b.parent().css("width",b.width()+15+"px")})}),this.$activity.one("mouseenter",function(){b.$orderingSelector.each(function(){var c=a(this),d=c.parent().hasClass("vertical")?"y":"";c.sortable({cancel:"li[data-fixed='y']",placeholder:"draggablePlaceHolder",forcePlaceholderSize:!0,dragOnEmpty:!1,tolerance:"pointer",helper:"original",cursor:"pointer",scrollSpeed:10,axis:d,change:function(){var b=a(this);if(!b.hasClass("positionable")){var c=b.find("li[data-fixed='y']").detach(),d=a("<li></li>").prependTo(this);c.each(function(){var c=a(this),d=c.data("pos");c.insertAfter(a("li",b).eq(d))}),d.remove()}},start:function(b,c){c.placeholder.html("&nbsp;");var d=a(this);d.find("li[data-fixed='y']").each(function(){var b=a(this);b.data("pos",b.index())})},stop:function(){var c=a(this);"y"==c.attr("data-capitalise")&&(c.hasClass("capitalise")||c.addClass("capitalise"));var d=c.closest("[data-rcfinteraction]");"y"==d.attr("data-feedback")&&b._showOrderingFeedback(d)}})})})},_showOrderingFeedback:function(b){var c=this,d=b.attr("data-rcfid"),e=c.getUserAnswers().filter(function(a){return a.elm==d}),f=null,g=b.find("li[data-fixed!='y']"),h=null,i=0;if(b.hasClass("complex"))for(f=JSON.parse(b.attr("data-correctorders")),i=0;i<g.length;i++){var j=!0,k=0;for(h=a(g[i]);j;){var l=a.inArray(a(g[i]).attr("data-rcfid"),f[k]);h.addClass("incorrectPosition").removeClass("correctPosition"),l>-1&&l==i&&(h.addClass("correctPosition").removeClass("incorrectPosition"),j=!1),k++,k>f.length&&(j=!1)}}else if(f=c.correctPositioning.filter(function(a){return a.elm==d}),1==e.length&&1==f.length)for(i=0;i<g.length;i++)h=a(g[i]),"y"!=h.attr("data-fixed")&&(e[0].value[i]==f[0].value[i]?a(g[i]).addClass("correctPosition").removeClass("incorrectPosition"):a(g[i]).addClass("incorrectPosition").removeClass("correctPosition"))},showAnswers:function(c){for(var d in c.answers){var e=c.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$activity.find("*[data-rcfinteraction=ordering][data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g)){var h=g.find("li"),i=0,j=[],k=null;if(g.find("li[data-fixed='y']:not(.suffix)").each(function(){var b=a(this);b.attr("data-showanswer","0").data("pos",b.index())}),h.removeClass("selected"),g.find("li").each(function(b){a(this).attr("user-answer",b)}),"sequence"==e.type)for(var l in e.value){var m=e.value[l].replace(/\'/g,"\\'");RCF.Utils.isEmpty(j[m])&&(j[m]=1),k=g.find("[data-ordervalue='"+m+"']");var n=0;k.length>1?(n=j[m],a(k[n-1]).attr("data-showanswer",i++),j[m]++):k.attr("data-showanswer",i++)}else{var o=null;if(a.isArray(e.value[0])?o=e.value[0]:a.isArray(e.value)&&(o=e.value),null===o&&b.console)return void console.log("Invalid answer object passed to complex ordering : \n"+JSON.stringify(e,null,2));for(var p=0;p<o.length;p++)k=g.find("[data-rcfid='"+o[p]+"']"),k.length>0&&k.attr("data-showanswer",p)}h.filter(".suffix").attr("data-showanswer",h.length-1),h.tsort("",{attr:"data-showanswer",order:"asc"});var q=h.closest("ul");if("y"==q.attr("data-capitalise")&&(q.hasClass("capitalise")||q.addClass("capitalise")),!h.parent().hasClass("positionable")){var r=g,s=r.find("li[data-fixed='y']:not(.suffix)").sort(function(b,c){return parseInt(a(b).attr("data-fixedpos"))>parseInt(a(c).attr("data-fixedpos"))});s.length>0&&(s.detach(),s.each(function(){var b=a(this),c=parseInt(b.attr("data-fixedpos"))-1,d=a("<li class='helper'></li>").prependTo(r.find("ul"));b.insertAfter(a("li",r).eq(c)),d.remove()}))}"y"==g.attr("data-feedback")&&this._showOrderingFeedback(g)}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']"),f=e.attr("data-marktype"),g="";if(!RCF.Utils.isEmpty(e))if("item"==f)for(var h in c.value){var i=c.value[h].replace(/\'/g,"\\'"),j=e.find("[data-ordervalue='"+i+"']");RCF.Utils.isEmpty(j)||(g="1"==c.verification[h]?"correct":"wrong",j.find(".mark").addClass(g))}else"list"==f&&(g="1"==c.verification[0]?"correct":"wrong",e.find(".mark").addClass(g))}}},showUserAnswers:function(){var b=this;this.$orderingSelector.find("li[user-answer]").removeClass("selected").tsort("",{attr:"user-answer",order:"asc"}),this.$orderingSelector.each(function(){var c=a(this).closest("[data-rcfinteraction]");"y"==c.attr("data-feedback")&&b._showOrderingFeedback(c)})},isComplete:function(){for(var a=this.getUserAnswers(),b=!0,c=0;c<a.length;c++){var d=JSON.stringify(a[c]),e=JSON.stringify(this.originalPositioning[c]);if(d===e){b=!1;break}}return b},getUserAnswers:function(){var b=this.$selector.filter(":not(.example)").map(function(){var b=a(this),c=b.find(".ordering").hasClass("positionable"),d=function(){return b.find("ul.ordering.positionable:not(.example) li").map(function(){return a(this).attr("data-ordervalue")}).get()},e=function(){return b.find("ul.ordering:not(.positionable, .example) li:not(.fixed)").map(function(){return a(this).attr("data-ordervalue")}).get()},f=c?d():e();return{elm:b.attr("data-rcfid"),type:b.hasClass("complex")?"complexordering":"sequence",markType:b.attr("data-marktype"),value:f}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},close:function(){this.$orderingSelector&&this.$orderingSelector.each(function(){try{a(this).sortable("destroy")}catch(b){}}),this.$activity.find("ul.ordering:not(.example)").off("click","li")},reset:function(){var b=this;this.$orderingSelector&&(this.$orderingSelector.removeClass("capitalise").find("li:not(.suffix)").removeClass("selected").tsort("",{attr:"data-sortindex",order:"asc"}).removeAttr("user-answer").removeAttr("data-showanswer"),this.$orderingSelector.each(function(){var b=a(this),c=b.find("li.suffix");c.length>0&&c.appendTo(b)}),this.$selector.filter("[data-feedback='y']").each(function(){b._showOrderingFeedback(a(this))}))}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.PELMANISM]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(a){if(RCF.Utils.isEmpty(a))throw"Empty Activity passed into the behavior constructor (Pelmanism)";this.$activity=a,this.$selector=this.$activity.find("*[data-rcfinteraction=pelmanism]"),RCF.Utils.isEmpty(this.$selector)||(this._initialiseCards(),this._createEventHandler())},_initialiseCards:function(){var b=this,c="",d=this.$selector.find(".cards"),e=function(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a};c=new Date-(new Date).setHours(0,0,0,0),Math.seedrandom(c),this.$selector.find(".cardContainer[data-addedrank='y']").removeAttr("data-addedrank").removeAttr("data-rank").removeAttr("data-sortindex"),d.mmRandomize(".cardContainer",c),this.$selector.data("tries",0).data("numSeconds",0).removeClass("hurryUp").find(".cardContainer").removeClass("matchedPair playingCard").find(".card").removeClass("flipped matched userAnswer"),this.$selector.each(function(){var c=a(this),d=c.attr("data-pairs"),f=c.attr("data-numpairs"),g=c.attr("data-timelimit"),h=c.attr("interval"),i=0,j=d.split("|");h>0&&(clearInterval(h),c.attr("interval",0)),g&&g.length>0&&(i=parseInt(g),c.data("numSeconds",i),b._showPelmanismTime(c,i)),e(j),j=j.splice(0,f);for(var k=0;k<j.length;k++)c.find(".card[data-pairClass='"+j[k]+"']").closest(".cardContainer").addClass("playingCard")})},_createEventHandler:function(){var b=this;this.$activity.on("click","*[data-rcfinteraction=pelmanism]:not(.gameOver) .card:not(.flipped)",function(){var c=a(this),d=c.closest(".pelmanismContainer"),e=d.find(".cardContainer.playingCard"),f=d.data("tries")||0,g=d.data("firstPick")||null,h=d.attr("data-timelimit"),i=d.data("numSeconds"),j=d.attr("interval")||0,k=d.attr("data-timeOut")||0,l=d.attr("data-flipbackdelay")||1200,m=null,n=0==f&&!!h&&h.length>0&&0==j;if(c.addClass("flipped"),n&&(i=parseInt(h),d.data("numSeconds",i),j=setInterval(function(){i=parseInt(d.data("numSeconds")||0),--i<0&&(i=0),b._showPelmanismTime(d,i),d.data("numSeconds",i),1>i&&b._setGameOver(d,!1)},1e3),d.attr("interval",j)),!g)return g=c,k>0&&(clearTimeout(k),k=0,d.attr("data-timeOut",0)),void d.data("firstPick",g).find(".card.unmatched[data-cardid!='"+g.data("cardid")+"']").removeClass("unmatched flipped");if(c.attr("data-cardid")!==g.attr("data-cardid")){if(f++,d.data("tries",f).find(".numAttempts").html(f),c.attr("data-pairClass")==g.attr("data-pairClass"))return b._matchCard(g),b._matchCard(c),d.data("firstPick",null),void(d.find(".matched").length===e.length&&b._setGameOver(d,!0));g.addClass("unmatched"),c.addClass("unmatched"),m=c,d.data("firstPick",null),l=isNaN(l)?1200:parseInt(l),500>l&&(l=500),l>5e3&&(l=5e3),k=setTimeout(function(){g.closest(".pelmanismContainer").hasClass("gameOver")||(!g.hasClass("matched")&&g.hasClass("unmatched")&&g.removeClass("flipped unmatched"),!m.hasClass("matched")&&m.hasClass("unmatched")&&m.removeClass("flipped unmatched")),d.attr("data-timeOut",0),k=0},l),d.attr("data-timeOut",k)}})},_matchCard:function(a){a.removeClass("unmatched").addClass("matched userAnswer flipped").closest(".cardContainer").addClass("matchedPair")},_showPelmanismTime:function(a,b){var c=a.find(".timer"),d=0,e=0;RCF.Utils.isEmpty(c)||(b=parseInt(b)||0,a.data("numSeconds",b),d=parseInt(b/60)%60,e=parseInt(b%60,10),11>b&&a.addClass("hurryUp"),c.text((10>d?"0"+d:d)+":"+(10>e?"0"+e:e)))},_setGameOver:function(a,b){var c=parseInt(a.attr("interval")||0),d=parseInt(a.attr("data-timeOut")||0);c>0&&clearInterval(c),d>0&&clearTimeout(d),a.attr("interval",0).removeClass("hurryUp").addClass("gameOver "+(b?"completed":"")).find(".card").addClass(b?"":"unmatched flipped")},showAnswers:function(){var a=this.$selector.find(".card");a.removeClass("unmatched").addClass("flipped").filter(".matched").addClass("userAnswer").end().closest(".cardContainer").addClass("matchedPair shownAnswer")},showUserAnswers:function(){var a=this.$selector.find(".cardContainer.playingCard .card");a.removeClass("flipped").filter(".userAnswer").addClass("flipped").end().filter(":not(.userAnswer)").closest(".cardContainer").removeClass("matchedPair shownAnswer")},getUserAnswers:function(){return this.$selector.map(function(){var b=a(this),c=parseInt(b.attr("data-timelimit")||0),d=parseInt(b.data("numSeconds")||0),e=c-d;return{elm:b.attr("data-rcfid"),type:"composite",markType:"unmarked",markedBy:"nobody",value:[{elm:"tries",type:"simple",value:b.hasClass("completed")?b.data("tries"):"0"},{elm:"timetaken",type:"simple",value:b.hasClass("completed")?e:"0"}]}}).get()},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this);c.hasClass("complete")||c.hasClass("gameOver")||(b=!1)}),b},close:function(){this.$selector.each(function(){var b=a(this),c=b.attr("interval")||0,d=b.attr("data-timeOut")||0;c>0&&clearInterval(c),d>0&&clearTimeout(d)})},reset:function(){this.$selector.removeClass("completed gameOver hurryUp").data("tries",0).data("firstPick",null).find(".card").removeClass("matched unmatched userAnswer flipped").end().find(".numAttempts").html("0");var a=this;setTimeout(function(){a.$selector.find(".cardContainer").removeClass("playingCard matchedPair"),a._initialiseCards()},400)}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.RADIOITEM_SELECTABLE]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed to behavior constructor (radioItemSelectable)";this.$activity=b,this.$selector=this.$activity.find("span.radioItemSelect:not(.example)"),this.$selector.on("click",".selectable.radio",function(){var b=a(this);b.closest(".radioItemSelect").find(".selectable.radio.selected").removeClass("selected"),b.addClass("selected")}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction='radioItemSelect']",function(b,c){var d=a(this),e=c.elm;
e===d.attr("data-rcfid")&&(d.find(".radio.selected").removeClass("selected"),d.find("[data-rcfid='"+c.value+"']").addClass("selected"))})},showAnswers:function(b,c){this.$selector.each(function(){var b=a(this);b.data("user-answer",b.find(".selectable.radio.selected").attr("data-rcfid")||"")}),this.$selector.find(".selectable.radio.selected").removeClass("selected");for(var d in b.answers){var e=b.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=e.value,h=e.type;if("simple"===h){var i=this.$selector.filter("[data-rcfid='"+f+"']").find("[data-rcfid='"+g+"']");RCF.Utils.isEmpty(i)||(c?e.verification&&"1"==e.verification&&i.addClass("selected"):i.addClass("selected"))}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e)){var f=e.find(".radio[data-rcfid='"+c.value+"']");if(!RCF.Utils.isEmpty(f)){var g="1"==c.verification[0]?"correct":"wrong";f.find(".mark").addClass(g)}}}}},showUserAnswers:function(){this.$selector.find(".selectable.radio.selected").removeClass("selected"),this.$selector.each(function(){var b=a(this),c=b.data("user-answer");RCF.Utils.isEmpty(c)||b.find(".selectable.radio[data-rcfid='"+c+"']").addClass("selected")})},isComplete:function(){var a=this.$selector,b=this.$selector.find(".selectable.radio.selected");return a.length===b.length},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this),c=b.find(".selectable.radio.selected");return{elm:b.attr("data-rcfid"),type:"simple",value:c.attr("data-rcfid")||""}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.each(function(){a(this).removeData("user-answer")}),this.$selector.find(".selectable.radio.selected").removeClass("selected")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.RADIOLIST]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed to behavior constructor (radioList)";this.$activity=b,this.$selector=this.$activity.find("*[data-rcfinteraction=radioList]"),this.$selector.filter(".example").find("input[type='radio']").filter("[data-correct='y']").prop("checked",!0),this.$selector.filter(".example").find("input[type='radio']").on("change",function(b){b.stopPropagation(),b.preventDefault(),"y"==a(this).attr("data-correct")||a(this).closest(".radioList").find("input[type='radio']").filter("[data-correct='y']").prop("checked",!0)}),this.$selector=this.$selector.filter(":not(.example)"),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=radioList]",function(b,c){var d=a(this),e=c.elm;if(e===d.attr("data-rcfid")){var f=d;f.data("user-answer",f.find("input[type='radio']:checked").attr("data-rcfid"));var g=c.value;a.isArray(g)&&(g=g[0]),f.find("input[type='radio'][data-rcfid='"+g+"']").prop("checked",!0)}})},showAnswers:function(b,c){this.$selector.each(function(){var b=a(this),c=b.find("input[type='radio']:checked");RCF.Utils.isEmpty(c)||b.data("user-answer",c.attr("data-rcfid"))});for(var d in b.answers){var e=b.answers[d],f=e.elm,g=e.value;if(!RCF.Utils.isEmpty(g)){g=a.isArray(g)?g[0]:g;var h=this.$selector.filter("[data-rcfid='"+f+"']").find("[data-rcfid='"+g+"']");RCF.Utils.isEmpty(h)||(c?e.verification&&"1"==e.verification[0]?h.prop("checked",!0):h.closest("[data-rcfid="+f+"]").removeData("user-answer").find("input[type=radio]").prop("checked",!1):h.prop("checked",!0))}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e)){var f=e.find("input[data-rcfid='"+c.value+"']");if(!RCF.Utils.isEmpty(f)){var g="1"==c.verification[0]?"correct":"wrong";f.parent().find(".mark").addClass(g)}}}}},showUserAnswers:function(){this.$selector.each(function(){var b=a(this),c=b.data("user-answer");b.find("input[type='radio']").prop("checked",!1),RCF.Utils.isEmpty(c)||b.find("input[type='radio'][data-rcfid='"+c+"']").prop("checked",!0)})},isComplete:function(){var a=this.$selector.length,b=this.$selector.find("input[type='radio']:checked").length;return a===b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this),c=b.find("input[type=radio]:checked");return{elm:b.attr("data-rcfid"),type:"simple",value:c.attr("data-rcfid")||""}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.removeData("user-answer").find("input[type='radio']").prop("checked",!1)}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.SELECTABLE_ELEMENTS]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into SelectableElement constructor !";this.$activity=b,this.$selector=this.$activity.find(".interactiveText"),this.$selector.on("click",".selectable:not(.markable, .example, .radio, .disabled)",function(){var b=a(this),c=b.closest(".interactiveText"),d=parseInt(c.attr("data-rcfrestrict"),10)||0,e=c.find(".selectable:not(.markable, .example, .radio)");b.toggleClass(function(){return b.hasClass("selected")?b.removeData("user-answer"):b.data("user-answer","Y"),"selected"}),1>d||(b.hasClass("selected")?e.filter(".selected").length>=d&&e.not(".selected").addClass("disabled"):e.removeClass("disabled"))}),this.$activity.find(".selectable.example:not(.markable, .radio)").addClass("selected"),this.$activity.on("rcf.single.answer",".interactiveText[data-rcfinteraction='interactiveText']",function(b,c,d){var e=a(this),f=c.elm,g=parseInt(e.attr("data-rcfrestrict"),10)||0;if(e.hasClass("type_selectableWords")||e.hasClass("type_selectable")){if(f!==e.attr("data-rcfid"))return;if(e.find(".selectable[data-rcfid='"+d+"']").data("user-answer","Y").find(".selectable").addClass("selected"),g>0){var h=e.find(".selectable:not(.markable, .example, .radio)");h.filter(".selected").length>=g?h.not(".selected").addClass("disabled"):h.not(".selected").removeClass("disabled")}}})},showAnswers:function(a,b){for(var c in a.answers){var d=a.answers[c],e=d.elm;if(!RCF.Utils.isEmpty(e)){var f=this.$activity.find(".interactiveText[data-rcfid='"+e+"']");if(!RCF.Utils.isEmpty(f)){f.find(".selectable:not(.example , .radio, .markable)").removeData("user-answer");var g=parseInt(f.attr("data-rcfrestrict"),10)||0,h=f.find(".selectable.selected:not(.example, .radio, .markable)");h.data("user-answer","Y").removeClass("selected");var i=d.value;for(var j in i)(b&&d.verification&&"1"==d.verification[j]||RCF.Utils.isEmpty(b)||!b)&&f.find(".selectable[data-rcfid='"+i[j]+"']").children().filter(":first-child").addClass("selected");g>0&&(h=f.find(".selectable:not(.markable, .example, .radio)"),h.filter(".selected").length>=g?h.not(".selected").addClass("disabled"):h.not(".selected").removeClass("disabled"))}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification))for(b in c.value){var e=this.$selector.find(".selectable[data-rcfid='"+c.value[b]+"']");if(!RCF.Utils.isEmpty(e)){var f="1"==c.verification[b]?"correct":"wrong";e.find(".mark").addClass(f)}}}},showUserAnswers:function(){this.$selector.find(".selectable:not(.example, .radio, .markable)").each(function(){var b=a(this),c=b.data("user-answer");b.removeClass("selected"),RCF.Utils.isEmpty(c)||b.addClass("selected").removeData("user-answer")})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this),d=parseInt(c.attr("data-rcfrestrict"),10)||0,e=c.find(".selectable.selected:not(.example)");d>0?e.length<d&&(b=!1):e.length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"list",value:b.find(".selectable.selected:not(.markable, .example, .radio)").map(function(){return a(this).parent().attr("data-rcfid")}).get()}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find(".selected:not(.example,.radio)").removeData("user-answer").removeClass("selected"),this.$selector.find(".disabled").removeClass("disabled")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.TYPEIN]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into the behavior constructor (TextInput)";this.$activity=b,this.$selector=this.$activity.find("*[data-rcfinteraction=markedTextInput]");var c=navigator.userAgent,d=c.match(/iPhone/i)||c.match(/iPod/i)||c.match(/iPad/i);d&&this.$selector.css("-webkit-appearance","caret");var e=this.$selector.find("input.markedTextInput");RCF.Utils.isEmpty(e)||this._setupSingleLineInputs(e),this.$activity.on("focusout",".markedTextInput",function(){var b=a(this),c=b.val().replace(/\s+$/,"");b.val(c)}).on("input keyup change paste",".markedTextInput",function(){a(this).toggleClass("populated",a(this).val().length>0)}),this.$selector=this.$selector.filter(":not(.example)"),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=markedTextInput]",function(b,c){var d=a(this),e=c.elm;if(e===d.attr("data-rcfid")){var f=d.find(".markedTextInput");f.data("user-answer",f.val()).val(a.isArray(c.value)?c.value[0]:c.value).toggleClass("populated",f.val().length>0)}})},_setupSingleLineInputs:function(b){var c=this;b.each(function(){var b=a(this),d=b.attr("data-longestString")||"WWWWWWWW",e=a("<span class='text markedTextInput offscreenInput'>"+d+"W</span>").appendTo(c.$activity);try{var f=b;["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing","word-spacing","text-indent","padding","margin"].forEach(function(a){e.css(a,f.css(a))}),f.css("width",e.width())}catch(g){}});var d=this.$activity.find(".offscreenInput"),e=Math.max.apply(Math,d.map(function(){try{return parseInt(a(this).width())}catch(b){return 1}}).get());d.remove(),b.filter("[data-resize='activity']").css("width",e).removeAttr("data-longestString");var f="mobile"==RCF.Utils.cookie("deviceMode");f&&b.each(function(){var b=a(this);if(e>c.$activity.width()-20){var d=a("<textarea>");d.attr({id:this.id,autocomplete:"false",autocapitalize:"off",spellcheck:"false",autocorrect:"off","data-longestitem":b.attr("data-longestitem"),"data-casesensitive":b.attr("data-casesensitive"),"class":b.attr("class"),"data-acceptable":b.attr("data-acceptable")}).val(b.val()),d.toggleClass("populated",b.val()),b.replaceWith(d)}})},showAnswers:function(b,c){for(var d in b.answers){var e=b.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$activity.find("[data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g)){var h=g.find(".markedTextInput");if(RCF.Utils.isEmpty(h))continue;var i=a.isArray(e.value)?e.value[0]:e.value;c?(i=e.verification&&"1"==e.verification[0]?i:"",h.data("user-answer",i).val(i)):h.data("user-answer",h.val()).val(i),h.toggleClass("populated",i.length>0),h.trigger("autosize.resize")}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e)){var f="1"==c.verification[0]?"correct":"wrong";e.find(".mark").addClass(f)}}}},showUserAnswers:function(){this.$selector.each(function(){var b=a(this).find(".markedTextInput");b.val(b.data("user-answer")||"").trigger("autosize.resize").toggleClass("populated",b.val().length>0)})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this),d=c.find(".markedTextInput").val()||"";d.length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this),c=b.find(".markedTextInput").val()||"";return c=c.length>0?c.trimAll():"",{elm:b.attr("data-rcfid"),type:"simple",value:RCF.Utils.fixQuotables(c)}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find(".markedTextInput:not(.example)").val("").removeClass("populated").trigger("autosize.resize").removeData("user-answer")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.TYPEIN_GROUP]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty activity passed into behavior constructor (TypeinGroup)";this.$activity=b,this.$selector=this.$activity.find("*[data-rcfinteraction=typeinGroup]:not(.example)"),this.$typeIns=this.$selector.find("input.typeinGroup:not(.example)");var c=navigator.userAgent,d=c.match(/iPhone/i)||c.match(/iPod/i)||c.match(/iPad/i);d&&this.$selector.css("-webkit-appearance","caret"),this._setupTypeinSizes(this.$activity.find("input.typeinGroup"));var e=this;e.$typeIns.on("focusin",function(){a(this).select()}).on("keydown",function(b){var c=!1;8===b.which&&this.value.length<1&&(c=!0),37===b.which&&0===a(this).getCursorPosition()&&(c=!0),c&&(e.$typeIns.eq(e.$typeIns.index(this)-1).focus(),b.preventDefault())}).on("mouseup",function(){a(this).select()}).on("keyup",function(b){var c=a(this),d=c.val();if(c.toggleClass("populated",d.length>0),d.length<a(this).attr("maxlength"));else{var f=[8,9,16,17,18,19,20,27,33,34,35,36,37,38,40,45,46,144,145];-1==a.inArray(b.which,f)&&(e.$typeIns.eq(e.$typeIns.index(this)+1).focus(),b.stopImmediatePropagation(),b.preventDefault())}}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=typeinGroup]",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){var g=e,h=null;if("list"!=c.markType)throw"TypeInGroup used in 'rcf.single.answer' with markType!=list !";if(d||0===d){var i=c.value[d];h=g.find("input[data-rcfid='"+i.elm+"']"),h.data("user-answer",h.val()).val("choice"===i.type?i.value[0]:c.value[d].value).toggleClass("populated",h.val().length>0)}else for(var j in c.value)h=g.find("input[data-rcfid='"+c.value[j].elm+"']"),h.data("user-answer",h.val()).val("choice"===c.value[j].type?c.value[j].value[0]:c.value[j].value).toggleClass("populated",h.val().length>0)}})},_setupTypeinSizes:function(b){var c=this.$activity,d=0,e=a("<span class='.text'>x</span>").appendTo(c);d=parseInt(e.width())+2,e.remove(),b.each(function(){var b=1,c=a(this);try{b=parseInt(c.attr("data-longestItem"))}catch(e){b=1}b>1&&c.css("width",b*d+10+"px")})},showAnswers:function(b,c){for(var d in b.answers){var e=b.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$activity.find("[data-rcfid='"+f+"'][data-rcfinteraction='typeinGroup']");if(!RCF.Utils.isEmpty(g))for(var h=0;h<e.value.length;h++){var i=e.value[h],j=i.elm,k=g.find("[data-rcfid='"+j+"']"),l=k.val(),m="";m=a.isArray(i.value)?i.value[0]:i.value,c&&e.verification&&"1"!=e.verification[0]&&(l="",m=""),k.data("user-answer",l).val(m).toggleClass("populated",k.val().length>0)}}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e)&&!RCF.Utils.isEmpty(c.verification)){var f="1"==c.verification[0]?"correct":"wrong";e.find(".mark").addClass(f)}}}},showUserAnswers:function(){this.$typeIns.each(function(){var b=a(this);b.val(b.data("user-answer")).toggleClass("populated",b.val().length>0)})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this);c.find("input.typeinGroup:not(.example)").each(function(){var c=a(this).val()||"";c.length<1&&(b=!1)})}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return b.find("input.typeinGroup:not(.example)").length>0?{elm:b.attr("data-rcfid"),type:"composite",markType:"list",value:b.find("input.typeinGroup:not(.example)").map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"simple",value:b.val()||""}}).get()}:void 0}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},reset:function(){this.$selector.find("input.typeinGroup:not(.example)").val("").removeData("user-answer").removeClass("populated")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.VERTICAL_CROSSWORD]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty activity passed vertical crossword behavior constructor";this.$activity=b,this.$selector=this.$activity.find("*[data-rcfinteraction='verticalCrossword']"),this.$typeIns=this.$selector.find("input.vcTypeIn:not(.example)");var c=navigator.userAgent,d=c.match(/iPhone/i)||c.match(/iPod/i)||c.match(/iPad/i);d&&this.$selector.css("-webkit-appearance","caret");var e=this;e.$activity.on("focusin",".vcTypeIn:not(.example)",function(){a(this).select()}).on("focus",".vcTypeIn:not(.example)",function(){a(this).select()}).on("mouseup",".vcTypeIn:not(.example)",function(b){a(this).select(),b.preventDefault()}),this.$typeIns.on("keyup",function(b){var c=!1,d=e.$typeIns.index(this);if(8===b.which&&(a(this).val(""),c=!0),37===b.which&&0===a(this).getCursorPosition()&&(c=!0),c)return--d<0?e.$typeIns.last().focus():e.$typeIns.eq(d).focus(),void b.preventDefault();var f=[8,9,16,17,18,19,20,27,33,34,35,36,37,38,40,45,46,144,145];-1==a.inArray(b.which,f)&&(d=e.$typeIns.index(this),++d>e.$typeIns.length-1?e.$typeIns.first().focus():e.$typeIns.eq(d).focus(),b.stopImmediatePropagation(),b.preventDefault())}),this.$activity.on("rcf.single.answer","*[data-rcfinteraction=verticalCrossword]",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid"))for(var g in c.value){var h=c.value[g];h.elm==d&&e.find(".vcLine[data-rcf-wordid='"+d+"'] input.vcTypeIn").each(function(b){a(this).val(h.value.split("")[b])})}})},showAnswers:function(b,c){for(var d in b.answers){var e=b.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$activity.find("*[data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g)){g.find("input.vcTypeIn:not(.example)").each(function(){a(this).data("user-answer",a(this).val())});for(var h in e.value){var i=e.value[h],j=i.elm,k=i.value,l=g.find("tr.vcLine[data-rcf-wordid='"+j+"']").find("input.vcTypeIn");c&&i.verification&&"1"==i.verification[0]||!c?l.each(function(b){a(this).val(k.split("")[b])}):l.val("").removeData("user-answer")}}}}},showMarkedAnswers:function(a){var b=a.id,c=this.$activity.attr("id");if(b!=c)throw"invalid JSON marked answers object provided for 'showMarkedAnswers'";this.clearMarkedAnswers();for(var d in a.answers){var e=a.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$selector.filter("[data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g))for(var h in e.value){var i=e.value[h],j=i.elm,k="1"==i.verification[0];g.find("tr.vcLine[data-rcf-wordid='"+j+"']").find(".mark").addClass(k?"correct":"wrong")}}}},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},showUserAnswers:function(){this.$typeIns.each(function(){var b=a(this);b.val(b.data("user-answer")||"")})},isComplete:function(){var b=!0;return this.$typeIns.each(function(){a(this).val().length<1&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"composite",markType:"item",value:b.find("tr.vcLine:not(.example)").map(function(){return{elm:a(this).attr("data-rcf-wordid"),type:"simple",value:a(this).find("input.vcTypeIn").map(function(){return a(this).val().toUpperCase()}).get().join("")}}).get()}}).get();return b},reset:function(){this.$typeIns.removeData("user-answer").val("")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.WORDSEARCH]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed to WordSearchGrid behavior constructor";this.$activity=b,this.$selector=b.find("*[data-rcfinteraction=wordSearch]");var c="";c=this.$activity.attr("id"),c+=this.$activity.attr("data-seed")||"",Math.seedrandom(c);var d=this;this.$selector.each(function(){var b=a(this),e=b.find(".wordSearchGridContainer"),f=b.find(".rcfWordSearchGridChosenWords .wordSearchWords"),g=b.attr("data-gridsize"),h=b.attr("data-longestword"),i=b.attr("data-usediagonal"),j=b.attr("data-usevertical"),k=b.attr("data-usereverse"),l=b.attr("data-words"),m="y"===b.attr("data-interactive"),n=!!g&&parseInt(g)||!!h&&parseInt(h)||10,o=new RCF.Handlers.WordSearch.Grid(i,j),p=new RCF.Handlers.WordSearch.WordList(k);p.loadWords(l);var q=parseInt(!!h&&parseInt(h)||p.words.sort(function(a,b){return b.originalValue.length-a.originalValue.length})[0].value.length),r=0;for(q>n&&(n=q+2);8>r;)if(o.validGrid=!0,o.initializeGrid(n),o.fillGrid(p),!o.validGrid&&5>r)Math.seedrandom(c+"_retry_"+r),r++,r%2===0&&n++;else{if(o.validGrid)break;r++}var s=o.getHTML();e.append(s).data("grid",o).data("wordList",p),b.removeAttr("data-words");var t=new RCF.Handlers.WordSearch.SelectionHandler(e);if(e.data("selectionHandler",t),m){var u=o.cells;e.find("tr").each(function(b){var c=a(this);c.find("td").each(function(c){var d=u[b][c],e=a(this);e.data("cell",d)})}),e.on("rcf.selectionChanged",function(a,b){d._renderSelections(f,b)}),f.on("mouseover",".wordSearchSelection",function(){var b=a(this),c=b.attr("data-selid"),d=t.getSelection(c);d&&d.cells&&(d.cells.addClass("ws-glowing"),setTimeout(function(){d.cells.removeClass("ws-glowing")},400))}),f.on("click",".removeWordListItem",function(b){var c=a(this),d=c.closest(".wordSearchSelection").attr("data-selid");return t.removeSelection(d),a(this).closest("li").fadeOut(200,function(){a(this).remove()}),b.preventDefault(),b.stopPropagation(),b.preventDefault(),!1})}}),this.$activity.on("rcf.single.answer","*[data-rcfInteraction=wordSearch]",function(b,c,e){var f=a(this),g=c.elm;if(g===f.attr("data-rcfid")){for(var h=[],i=null,j=null,k=f.find(".wordSearchWords"),l=f.find(".wordSearchGridContainer").data("selectionHandler"),m=c.value[e],n=0;e+1>n;n++)m=c.value[n],i=f.find(".rcfWSCell[data-words*='|"+m+"|']"),j="showAnswers_"+n,i.each(function(){var b=a(this),c=b.data("selectionID")||"";c.indexOf("|"+j+"|")<0&&(c+="|"+j+"|"),b.data("selectionID",c)}),h.push({id:"showAnswers_"+n,word:m,cells:i});"y"==f.attr("data-interactive")&&d._renderSelections(k,h),l.setSelections(h)}})},_renderSelections:function(a,b){var c="";for(var d in b)c+="<li><span data-selid='"+b[d].id+"' data-item='"+b[d].word+"' class='wordSearchSelection markable'><span>"+b[d].word+"</span><span class='mark'>    </span><a class='removeWordListItem'>x</a></span></span></li>";a.html(c)},_showGridAnswers:function(b,c,d,e){var f=[],g=b.find(".wordSearchGridContainer").data("selectionHandler");g.setUserSelections(a.extend(!0,[],g.selectedWords)),g.clearHighlighting();for(var h in c.value){var i=c.value[h];if(!d||d&&"1"==c.verification[h]){var j=b.find(".rcfWSCell[data-words*='|"+i+"|']"),k="showAnswers_"+h;j.each(function(){var b=a(this),c=b.data("selectionID")||"";c.indexOf("|"+k+"|")<0&&(c+="|"+k+"|"),b.data("selectionID",c)}),f.push({id:"showAnswers_"+h,word:i,cells:j})}}e&&this._renderSelections(b.find(".wordSearchWords"),f),g.setSelections(f)},showAnswers:function(a,b){for(var c in a.answers){var d=a.answers[c],e=d.elm;if(!RCF.Utils.isEmpty(e)){var f=this.$activity.find("*[data-rcfinteraction='wordSearch'][data-rcfid='"+e+"']");RCF.Utils.isEmpty(f)||this._showGridAnswers(f,d,b,"y"===f.attr("data-interactive"))}}},showMarkedAnswers:function(a){this.clearMarkedAnswers();for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)&&!RCF.Utils.isEmpty(c.verification)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e)&&"y"===e.attr("data-interactive"))for(var f in c.value){var g=c.value[f],h="1"==c.verification[f];e.find(".wordSearchSelection[data-item='"+g+"']").find(".mark").addClass(h?"correct":"wrong")}}}},clearMarkedAnswers:function(){this.$selector.find(".mark").removeClass("correct wrong")},showUserAnswers:function(){var b=this;this.$selector.each(function(){var c=a(this),d=c.find(".wordSearchGridContainer"),e=c.find(".wordSearchWords"),f=d.data("selectionHandler"),g=f.userSelections;g&&(f.clearHighlighting(),f.setSelections(g),b._renderSelections(e,g))})},isComplete:function(){var b=!0;return this.$selector.each(function(){var c=a(this),d="y"===c.attr("data-interactive");if(d){for(var e=0,f=c.find(".wordSearchGridContainer").data("wordList"),g=0;g<f.words.length;g++){var h=f.words[g];h.example||e++}var i=c.find(".wordsContainer .wordSearchWords li");e!==i.length&&(b=!1)}}),b},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this),c=b.find(".wordSearchGridContainer"),d="y"===b.attr("data-interactive"),e=c.data("selectionHandler")||{userSelections:null},f=d?function(){return e&&e.selectedWords?e.selectedWords.map(function(a){return a.word}):[]}():[];return{elm:b.attr("data-rcfid"),type:"list",marked:d?"item":"unmarked",value:f}}).get();return b},reset:function(){this.$selector.each(function(){var b=a(this),c=b.find(".wordSearchGridContainer"),d=c.data("selectionHandler");b.removeData("selectionID"),b.find(".isWord").removeClass("showAnswer"),b.find(".wordSearchWords li").remove(),d&&(d.clearUserSelections(),d.clearSelections())})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Marked=RCF.Behaviors.Marked||{},RCF.Behaviors.Marked[RCF.BehaviorName.WORDSNAKE]=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty Activity passed into the behavior constructor (TextInput)";this.$activity=b,this.$selector=this.$activity.find("*[data-rcfinteraction=wordsnake]"),this.deviceMode=RCF.Utils.cookie("deviceMode"),RCF.Utils.isEmpty(this.deviceMode)&&(this.deviceMode="desktop");var c="desktop"!=this.deviceMode,d=function(a,b){for(var c=a.data("selectionUID")||0,d=!1,e="",f=b.first().prev(),g=b.last().next();!d;)e="highlight"+c++%5,f.length>0?f.hasClass(e)||(g.length>0?g.hasClass(e)||(d=!0):d=!0):g.length>0?g.hasClass(e)||(d=!0):d=!0;return a.data("selectionUID",c),e},e=function(b){var c=b.data("selectionUID")||0,e=b.find("li.ui-selecting");if(e.filter(".rangeMade").each(function(){var c=a(this),d=c.data("selectedRange");d&&b.find(d).removeClass("highlight0 highlight1 highlight2 highlight3 highlight4 rangeMade").removeAttr("data-selid").removeData("selectedRange")}),e.length>1){c++;var f=d(b,e),g=e.map(function(){return"#"+this.id}).get().join(",");e.data("selectedRange",g).removeClass("ui-selecting").addClass("rangeMade").removeAttr("data-selid").attr("data-selid","selection_"+c).addClass(f)}else e.removeClass("ui-selecting");b.removeData("startElem").removeAttr("selecting")},f=function(a,b,c){var d=a.find("li"),e=d.index(b),f=d.index(c),g=Math.min(e,f),h=Math.max(e,f)+1,i=d.slice(g,h),j=i.filter(".example");if(d.removeClass("ui-selecting"),j.length>0){var k=d.index(j.first()),l=d.index(j.last());k>e?h=k:g=l+1,i=d.slice(g,h)}i.addClass("ui-selecting")};this.$selector.filter("[data-interactive=y]").each(function(){var b=a(this),d=b.find(".wordSnake"),g=!0,h=this;c&&(g=!1),g&&(g="y"===b.attr("data-draggable")),g?(b.on("mousedown",".wordSnake li.letter:not(.example)",function(b){1===b.which&&(d.attr("selecting","y").data("startElem",a(this)),a(this).addClass("ui-selecting")),h.mouseDown=!0}),b.on("mousemove",".wordSnake li.letter:not(.example)",function(){h.mouseDown&&f(d,d.data("startElem"),a(this))}),b.on("rcf.stopselecting",".wordSnake",function(){h.mouseDown=!1,e(d)}),b.on("mouseup",".wordSnake li",function(a){h.mouseDown&&e(d),a.preventDefault()}),a(document).on("mouseup",function(){h.mouseDown=!1,e(d)})):(b.addClass("mobile"),b.on("click",".wordSnake li.letter:not(.example)",function(){var b="y"===d.attr("selecting"),c=null,g=null;b?(c=d.data("startElem"),g=a(this),d.removeAttr("selecting").removeData("startElem"),f(d,c,g),e(d),c=null,g=null):(c=a(this),c.addClass("ui-selecting"),d.attr("selecting","y").data("startElem",c))}))}),a(document).on("mouseup",function(){a(".wordSnake[selecting='y']").length>0&&a(".wordSnake[selecting='y']").trigger("rcf.stopselecting")});var g=0;this.$activity.on("rcf.single.answer","*[data-rcfinteraction=wordsnake]",function(b,c,d){var e=a(this),f=c.elm;if(f===e.attr("data-rcfid")){g=d%5;var h=c.value[d],i=a.map(h.split(","),function(a){return"#"+a}).join(",");e.find(i).attr("data-selid","selection_"+d).attr("class","letter rangeMade highlight"+g)}})},showAnswers:function(b,c){for(var d in b.answers){var e=b.answers[d],f=e.elm;if(!RCF.Utils.isEmpty(f)){var g=this.$selector.filter("[data-rcfid='"+f+"']");if(!RCF.Utils.isEmpty(g)){g.find("li.letter").each(function(){var b=a(this);b.data("userSelection",{className:b.attr("class"),selectionID:b.attr("data-selid")})}),g.removeData("startElem").removeAttr("selecting").find("li.letter:not(.example)").attr("class","letter").removeAttr("data-selid").removeData("selectedRange");for(var h in e.value){var i=e.value[h],j=a.map(i.split(","),function(a){return"#"+a}).join(","),k=0;c?"1"==e.verification[h]&&(k=h%5,g.find(j).attr("class","letter rangeMade highlight"+k)):(k=h%5,g.find(j).attr("data-selid","selection_"+h).attr("class","letter rangeMade highlight"+k))}}}}},showMarkedAnswers:function(b){this.clearMarkedAnswers();for(var c in b.answers){var d=b.answers[c],e=d.elm;if(!RCF.Utils.isEmpty(e)&&!RCF.Utils.isEmpty(d.verification)){var f=this.$selector.filter("[data-rcfid="+e+"]");if(!RCF.Utils.isEmpty(f))for(var g in d.value){var h=d.value[g],i=a.map(h.split(","),function(a){return"#"+a}),j=i.length,k=f.find(i[j-1]),l="1"==d.verification[g]?"correct":"wrong";k.length>0&&a("<span class='markContext'><span class='mark "+l+"'></span></span>").appendTo(k)}}}},showUserAnswers:function(){this.$selector.find("li.letter").each(function(){var b=a(this),c=b.data("userSelection")||{className:"letter",selectionID:""};b.attr("class",c.className),b.attr("data-selid",c.selectionID)})},isComplete:function(){var b=!0;return this.$selector.filter("[data-interactive='y']:not(.example)").each(function(){var c=a(this).find(".wordSnake"),d=c.find(".letter:not(.example)");d.length!==d.filter(".rangeMade").length&&(b=!1)}),b},getUserAnswers:function(){var b=this.$selector.filter("[data-interactive=y]:not(.example)").map(function(){var b=a(this),c=a(this).find(".wordSnake"),d="",e=[],f=[],g=c.find(".rangeMade");return g.each(function(b){var c=a(this),h=c.attr("data-selid");""===d&&(d=h),h!==d&&(f.push(e.join(",").replace(/#/g,"")),d=h,e=[]),e.push(this.id),b===g.length-1&&f.push(e.join(",").replace(/#/g,""))}),{elm:b.attr("data-rcfid"),type:"list",value:f}}).get();return b},clearMarkedAnswers:function(){this.$selector.find(".markContext").remove()},close:function(){a(document).off("mouseup")},reset:function(){this.$selector.find(".wordSnake:not(.example)").removeData("startElem").removeAttr("selecting").find("li.letter:not(.example)").removeData("userSelection").attr("class","letter").removeAttr("data-selid").removeData("selectedRange")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.CanDo=function(){function b(a){this._initialize(a)
}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty $canDo selector passed to CanDo behavior constructor";this.$activity=b,this.$activity.find(".canDoList").length>0&&this.$activity.on("click","a.canDoButton",function(){var b=a(this);b.closest("div.textControls").find("a.selected").removeClass("selected"),b.addClass("selected")})},showAnswers:function(a){for(var b in a.answers){var c=a.answers[b]||{},d=c.elm||"";if(!RCF.Utils.isEmpty(d)){var e=this.$activity.find(".canDoList[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e))for(var f in c.value){var g=c.value[f]||{},h=g.elm||"",i=g.value;if(!RCF.Utils.isEmpty(h)&&!RCF.Utils.isEmpty(i)){var j=e.find(".canDoItem[data-rcfid='"+h+"']");j.find("a[data-level='"+i+"']").addClass("selected")}}}}},getUserAnswers:function(){var b=this.$activity.find(".canDoList").map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"composite",value:b.find(".canDoItem").map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"simple",value:b.find("a.selected").attr("data-level")||""}}).get()}}).get();return b},reset:function(){this.$activity.find(".canDoButton").removeClass(".selected")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.CarouselElements=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){this.$carouselElements=b,this.$activity=this.$carouselElements.closest(".activity");var c="mobile"==RCF.Application.getDeviceMode(),d=this;this.$carouselElements=b,b.each(function(){var b=a(this),e=b.hasClass("simple"),f=b.children().length,g="y"==b.attr("data-singlepanelview"),h="y"==b.attr("data-autoheight"),i=b.attr("data-numitems")||1,j=g?1:i>f?f:i;if(b.owlCarousel({items:j,touchDrag:c,mouseDrag:!1,margin:10,nav:!e,autoHeight:e?!1:h,center:!0,navSpeed:200,singleItem:!0,navText:["<b>&#9664;</b>","<b>&#9658;</b>"]}),e){var k=a("<div class='navLeftButton'></div>"),l=a("<div class='navRightButton'></div>");b.append(k).append(l),k.on("click",function(){var a=b.data("owlCarousel");a._current>0?a.prev():b.trigger("to.owl.carousel",a._items.length-1)}),l.on("click",function(){var a=b.data("owlCarousel");a._current<a._items.length-1?a.next():b.trigger("to.owl.carousel",0)}),b.on("changed.owl.carousel",function(){d.$activity.trigger("rcf.stop.audio"),RCF.publish("rcf.stop.video"),RCF.publish("rcf.reset.triggers")})}else{var m=b.find(".owl-item.active .block.card").attr("data-audio");m&&m.length>0&&b.find(".owl-item.active .cardTitle .inlinePlayerContainer").trigger("click"),b.find(".owl-nav .owl-prev").hide();var n=b.find(".owl-nav .owl-next"),o=b.find(".owl-nav .owl-prev");n.toggle(b.find(".owl-item").length>1),b.on("changed.owl.carousel",function(c){n.toggle(c.page.index<c.page.count-1),o.toggle(c.page.index>0);var e=a(b.find(".owl-item")[c.page.index]);RCF.publish("rcf.new.carousel.page",[e]),RCF.publish("rcf.reset.triggers");var f=e.find(".block.card").attr("data-audio");d.$activity.trigger("rcf.stop.audio"),f&&f.length>0&&e.find(".cardTitle .inlinePlayerContainer").trigger("click"),RCF.publish("rcf.stop.video")})}})},showAnswers:function(a,b){b||this._clearMarkedDots()},_clearMarkedDots:function(){this.$activity.find(".owl-dot").removeClass("containsWrongAnswer containsCorrectAnswer")},showMarkedAnswers:function(){var b=this;b.$carouselElements.each(function(){var b=a(this),c=b.find(".owl-dot");c.removeClass("containsCorrectAnswer containsWrongAnswer"),b.find(".wrong").each(function(){var d=a(this).closest(".owl-item"),e=b.find(".owl-item").index(d);a(c[e]).addClass("containsWrongAnswer")}),b.find(".correct").each(function(){var d=a(this).closest(".owl-item"),e=b.find(".owl-item").index(d);a(c[e]).addClass("containsCorrectAnswer")})})},reset:function(a){a||this.$carouselElements.trigger("to.owl.carousel",0),this._clearMarkedDots()}},b}()}(jQuery,window),function(a,b,c){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.Chase=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty $chase selector passed into Chase behavior constructor";this.$selector=b,this.score=0,this.finalClass="",this.countDownInterval=0,this.interval=0,this.$chaseContents=this.$selector.find(".chaseDiv"),this.$playHeadControls=this.$selector.find(".playheadControls"),this.$countDownElement=this.$selector.find(".chaseCountDown"),this.$speedControls=this.$selector.find(".chaseControls.speedControls");var d=this.$chaseContents[0],e=c.createElement("span");e.className="chaseWord beforeChase",findAndReplaceDOMText(/([^\s<>]+)(?![^<>]*>)(?:(?=[<\s])|$)/g,d,e),this.chaseSpeed=0,this.interval=0;var f=this;this.$speedControls.on("click","a",function(){var b=a(this),c=b.attr("data-level");f.chaseSpeed=c,f.$speedControls.find("a").removeClass("selected"),b.addClass("selected"),f.interval>0&&(clearInterval(f.interval),f.interval=0,f._createInterval())}),this.$speedControls.filter("a:first").addClass("selected"),this.chaseSpeed=this.$speedControls.find("a:first").attr("data-level"),this.$playHeadControls.on("click","a",function(){switch(f.chaseType=f.$speedControls.attr("data-chasetype"),f.timed=f.$speedControls.attr("data-timed"),f.begin=f.$speedControls.attr("data-begin"),f.showCountDown=f.$speedControls.attr("data-countdown"),f.chaseType){case"appear":f.finalClass="";break;case"blur":f.finalClass="blurred";break;case"fade":f.finalClass="chaseFade";break;case"highlight":f.finalClass="chaseHighlight"}var b=a(this);b.hasClass("play")&&("Start"==b.text()?f.interval>0||f.countDownInterval>0?(f.pagePaused=!1,b.text("Pause")):f._startChase():(f.pagePaused=!0,b.text("Start"))),b.hasClass("stop")&&(f._stopCountDown(),f._stopChase(),f.reset())})},_startChase:function(){if(delete this.$pageWords,this.$playHeadControls.find(".play").text("Pause"),this.interval>0&&(clearInterval(this.interval),this.interval=0),this.$pageWords=this.$chaseContents.find(".chaseWord"),this.wordTotal=this.$pageWords.length,"appear"==this.chaseType&&this.$pageWords.addClass("beforeChase"),("fade"==this.chaseType||"highlight"==this.chaseType||"blur"==this.chaseType)&&this.$pageWords.removeClass("beforeChase chaseFade chaseBlurred chaseHighlight"),this.wordCounter=0,this.pagePaused=!1,"y"==this.timed){var a=this;this.countDownTimer=this.begin,this.countDownInterval=setInterval(function(){if(!a.pagePaused)if(0===a.countDownTimer)a._stopCountDown(),a._createInterval();else{var b=a.countDownTimer--,c=parseInt(b/3600)%24,d=parseInt(b/60)%60,e=parseInt(b%60,10),f=(10>c?"0"+c:c)+":"+(10>d?"0"+d:d)+":"+(10>e?"0"+e:e);a.$countDownElement.text("("+f+")")}},1e3)}else this._createInterval()},_createInterval:function(){var b=this;this.interval=setInterval(function(){if(!b.pagePaused)if(b.wordCounter>b.wordTotal)clearInterval(b.interval),b.pagePaused=!0,b.$playHeadControls.find(".play").text("Start"),b.interval=0;else{var c=a(b.$pageWords[b.wordCounter++]);"fade"==b.chaseType||"highlight"==b.chaseType||"blur"==b.chaseType?c.addClass(b.finalClass):c.removeClass("beforeChase")}},this.chaseSpeed)},_stopChase:function(){this.interval>0&&(clearInterval(this.interval),this.interval=0),RCF.Utils.isEmpty(this.$pageWords)||this.$pageWords.removeClass(this.finalClass),delete this.$pageWords,this.$playHeadControls.find(".play").text("Start"),this.wordCounter=0},_stopCountDown:function(){this.countDownInterval>0&&clearInterval(this.countDownInterval),this.countDownInterval=0,this.$countDownElement.text("")},reset:function(){"appear"!=this.chaseType?this.$chaseContents.find(".chaseWord").removeClass(this.finalClass).addClass("beforeChase"):this.$chaseContents.find(".chaseWord").addClass("beforeChase")},pause:function(){this._stopCountDown(),this._stopChase()},close:function(){this._stopCountDown(),this._stopChase(),this.$speedControls.off("click","a"),this.$playHeadControls.off("click","a")}},b}(),b.findAndReplaceDOMText=function(){function a(a,c,g,h){var i,j=[],k=d(c),l=f(g);if(k){if(a.global)for(;i=a.exec(k);)j.push(b(i,h));else i=k.match(a),j.push(b(i,h));j.length&&e(c,j,l)}}function b(a,b){if(b=b||0,!a[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var c=a.index;if(b>0){var d=a[b];if(!d)throw"Invalid capture group";c+=a[0].indexOf(d),a[0]=d}return[c,c+a[0].length,[a[0]]]}function d(a){if(3===a.nodeType)return a.data;var b="";if(a=a.firstChild)do b+=d(a);while(a=a.nextSibling);return b}function e(a,b,c){var d,e,f,g,h=[],i=0,j=a,k=b.shift(),l=0;a:for(;;){if(3===j.nodeType&&(!e&&j.length+i>=k[1]?(e=j,g=k[1]-i):d&&h.push(j),!d&&j.length+i>k[0]&&(d=j,f=k[0]-i),i+=j.length),d&&e){if(j=c({startNode:d,startNodeIndex:f,endNode:e,endNodeIndex:g,innerNodes:h,match:k[2],matchIndex:l}),i-=e.length-g,d=null,e=null,h=[],k=b.shift(),l++,!k)break}else if(j.firstChild||j.nextSibling){j=j.firstChild||j.nextSibling;continue}for(;;){if(j.nextSibling){j=j.nextSibling;break}if(j.parentNode===a)break a;j=j.parentNode}}}function f(a){g=[];var b;if("function"!=typeof a){var d=a.nodeType?a:c.createElement(a);b=function(a){var b,e=c.createElement("div");return e.innerHTML=d.outerHTML||(new XMLSerializer).serializeToString(d),b=e.firstChild,a&&b.appendChild(c.createTextNode(a)),b}}else b=a;return function(a){var d=a.startNode,e=a.endNode,f=a.matchIndex,h=0,i=0;if(d===e){var j=d;a.startNodeIndex>0&&(i=c.createTextNode(j.data.substring(0,a.startNodeIndex)),j.parentNode.insertBefore(i,j));var k=b(a.match[0],f);return j.parentNode.insertBefore(k,j),a.endNodeIndex<j.length&&(h=c.createTextNode(j.data.substring(a.endNodeIndex)),j.parentNode.insertBefore(h,j)),j.parentNode.removeChild(j),g.push(function(){var a=k.parentNode;a.insertBefore(k.firstChild,k),a.removeChild(k),a.normalize()}),k}i=c.createTextNode(d.data.substring(0,a.startNodeIndex)),h=c.createTextNode(e.data.substring(a.endNodeIndex));for(var l=b(d.data.substring(a.startNodeIndex),f),m=[],n=0,o=a.innerNodes.length;o>n;++n){var p=a.innerNodes[n],q=b(p.data,f);p.parentNode.replaceChild(q,p),m.push(q)}var r=b(e.data.substring(0,a.endNodeIndex),f);return d.parentNode.insertBefore(i,d),d.parentNode.insertBefore(l,d),d.parentNode.removeChild(d),e.parentNode.insertBefore(r,e),e.parentNode.insertBefore(h,e),e.parentNode.removeChild(e),g.push(function(){m.unshift(l),m.push(r);for(var a=0,b=m.length;b>a;++a){var c=m[a],d=c.parentNode;d.insertBefore(c.firstChild,c),d.removeChild(c),d.normalize()}}),r}}var g;return a.revert=function(){for(var a=0,b=g.length;b>a;++a)g[a]();g=[]},a}()}(jQuery,window,document),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.CollapsibleBlock=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){this.$selector=b,this.$selector.on("click",".collapsibleButton",function(){var b=a(this),c=a(this).closest(".collapsibleContainer"),d=c.find(".block:first"),e=c.find(".infoBlock:first");if(d.length<1){if(e.length<1)return;d=e}d.slideToggle({start:function(){b.text(b.attr(d.hasClass("collapsibleOpen")?"data-captionwhenclosed":"data-captionwhenopen"))},done:function(){d.toggleClass("collapsibleOpen")}})})},reset:function(){this.$selector.each(function(){var b=a(this),c=b.find(".block:first"),d=b.find(".collapsibleButton"),e=b.attr("data-initialopen");(!e||e.length<1)&&(e="n"),d.text(d.attr("y"==e?"data-captionwhenopen":"data-captionwhenclosed")),("y"==e&&!c.is(":visible")||"n"==e&&c.is(":visible"))&&c.slideToggle()})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.FlashcardContainer=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){this.$activity=b,this._setupFlashcardMenu(),this.$activity.find(".flashcardContainer[data-shownextbutton='n'] .cardDefinition[data-tobedisplayed='y']").addClass("show"),this.$activity.on("click",".cardDefinitionsContainer .nextDefinitionButton",function(){var b=a(this).closest(".cardDefinitionsContainer"),c=b.find(".cardDefinition[data-tobedisplayed='y']:not(.show)");if(c.length>0){var d=c.first(),e=d.attr("data-audio");d.addClass("show"),e&&b.closest(".activity").trigger("rcf.play.audio",e),1==c.length&&a(this).text("Restart")}else a(this).text("Show next"),b.find(".cardDefinition").removeClass("show")}),RCF.subscribe("rcf.new.carousel.page",function(a,b){"y"==b.closest("[data-rcfinteraction=flashcard]").attr("data-shownextbutton")&&(b.find(".nextDefinitionButton").text("Show next"),b.find(".cardDefinition[data-tobedisplayed='y']").removeClass("show")),b.find(".interactiveImageContainer.timed").find(".controlsContainer .singleButton.play").trigger("click")})},_setupFlashcardMenu:function(){var b=this;this.$activity.on("click",".flashcardMenuButton",function(c){var d=a(this).closest(".flashcardContainer"),e=d.find(".flashcardMenu"),f=b.$activity.find(".rcfFlashcardMask"),g=d.data("onclick");return e.hasClass("show")?(f.removeClass("show"),e.removeClass("show"),g&&(document.onClick=g),b.reset(),c.stopPropagation(),void c.preventDefault()):(g=document.onclick,g&&d.data("onclick",g),document.onclick=function(c){var d=c.target||c.srcElement;a(d).closest(".flashcardMenu").length>0||(f.removeClass("show"),e.removeClass("show"),document.onclick=g,b.reset())},f.addClass("show"),e.addClass("show"),c.stopPropagation(),void c.preventDefault())}),this.$activity.on("click",".descriptorToggle",function(b){var c=a(this),d=c.closest(".flashcardContainer"),e=!1;c.find(".on.selected").length>0?(c.find(".on").removeClass("selected"),c.find(".off").addClass("selected")):(e=!0,c.find(".on").addClass("selected"),c.find(".off").removeClass("selected"));var f=c.closest(".descriptorMenuItem").attr("data-descriptorID"),g="y"==d.attr("data-shownextbutton");d.find(".cardDefinition[data-descriptorid='"+f+"']").attr("data-tobedisplayed",e?"y":"n").toggleClass(g?"":"show"),b.stopPropagation(),b.preventDefault()}),this.$activity.on("click",".resetMenu",function(){b._resetDescriptorMenu()})},close:function(){RCF.unsubscribe("rcf.new.carousel.page")},_resetDescriptors:function(){this.$activity.find(".nextDefinitionButton").text("Show next"),this.$activity.find(".flashcardContainer[data-shownextbutton='y'] .cardDefinitionsContainer .cardDefinition").removeClass("show")},reset:function(){this._resetDescriptors()}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.FlashObject=function(){function b(a){this.assetURL=a.closest(".activity").attr("data-levelassetsurl"),this.assetURL&&(this.assetURL+="/swf/"),this._initialize(a)}return b.prototype={_initialize:function(b){var c=this;b.each(function(){var b=a(this),d=b.find(".flashObjectPlaceHolder");if(swfobject){var e=JSON.parse(d.attr("data-flashvars")||"{}"),f=JSON.parse(d.attr("data-flashparams")||"{}"),g=JSON.parse(d.attr("data-flashattributes")||"{}");try{swfobject.embedSWF(c.assetURL+d.attr("data-src"),d[0].id,"100%","100%","9.0.0",e,f,g)}catch(h){}try{b.find(" object")[0].Rewind()}catch(i){}var j="<div class='rcfFlashControls'><div class='flashPlayButton singleButton'>Play</div><div class='flashStopButton singleButton'>Stop</div></div>";b.append(j),b.on("click",".flashPlayButton",function(){var c=a(this),d=b.data("playing")||!1;d=!d,b.data("playing",d),d?(b.find("object")[0].Play(),c.text("Pause")):(b.find("object")[0].StopPlay(),c.text("Play"))}),b.on("click",".flashStopButton",function(){b.data("playing",!1),b.find("object")[0].Rewind(),b.find(".flashPlayButton").text("Play")})}})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.Hangman=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty selector passed to Hangman";Math.seedrandom(),this.$selector=b;var c=this;this.$selector.each(function(){var b=a(this),d=b.data("attempt")||0,e=b.attr("data-numattempts"),f=b.find(".hangmanGame"),g=f.find(".triesRemaining");b.data("attempt",d),e=e.length>0?parseInt(e,10):8,c._setupWords(b);var h=b.find(".letterChooser"),i=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];i.forEach(function(b){h.append(a("<div class='letter' data-letter='"+b+"'>"+b+"</div>"))});var j=b.find(".wordContainer");b.on("click",".letterChooser .letter:not(.clicked)",function(){if(!b.hasClass("gameOver")){var c=a(this),d=b.data("attempt")||0;if(e>d){c.addClass("clicked");var h=c.attr("data-letter"),i=j.data("word");i.toUpperCase().indexOf(h.toUpperCase())>-1?(j.find(".letter[data-letter='"+h+"']").addClass("correct"),j.find(".correct").length==i.length&&b.addClass("gameOver youWin")):(d++,g.length>0&&g.find(".tries").text(e-d),f.find(".stage.current").removeClass("current"),f.find(".stage"+d).addClass("current shown"),d>e-1&&b.addClass("gameOver"),b.data("attempt",d))}}})})},_setupWords:function(b){var c=b.attr("data-wordlist").split("|"),d=b.attr("data-cluelist").split("|"),e=Math.floor(Math.random()*c.length),f=b.find(".wordContainer"),g=b.find(".wordClue"),h=c[e],i=d[e]||"",j=b.find(".triesRemaining"),k=b.attr("data-numattempts");k=k.length>0?parseInt(k,10):8,j.length>0&&j.find(".tries").text(k),h=h.replace(/\s|-|\'|\"/g,"").toUpperCase(),g.text(i),f.data("word",h),f.find(".letterContainer").remove(),h.split("").forEach(function(b){"-_ '\"".indexOf(b)<0&&f.append(a("<div class='letterContainer'><div class='letter' data-letter='"+b+"'>"+b+"</div></div>"))})},_resetHangmanGame:function(a){a.removeClass("gameOver youWin").data("attempt",0).find(".stage").removeClass("current shown"),a.find(".current").removeClass("current"),a.find(".letter.clicked").removeClass("clicked"),a.find(".letterContainer .letter.correct").removeClass("correct")},reset:function(){var b=this;this.$selector.each(function(){var c=a(this);b._resetHangmanGame(c),b._setupWords(c)})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.InteractiveImageSets=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){b.find(".imageContainer").magnificPopup({type:"image",closeOnContentClick:!0,closeBtnInside:!0,fixedContentPos:!0,mainClass:"rcfImagePopup",image:{verticalFit:!0,titleSrc:function(b){return a(b.el).find(".innerCaption").html()}},zoom:{enabled:!0,duration:300}})},close:function(){a.magnificPopup.close()}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.InteractiveImages=function(){function c(a){this._initalize(a)}return c.prototype={_initalize:function(b){this.$interactiveImages=b,this.$activity=b.closest(".activity");var c=this;this.$interactiveImages.each(function(){var b=a(this),d=b.attr("data-type");"blur"===d&&c._createBlurInteractiveImage(b),"spotlight"==d&&c._createSpotlightInteractiveImage(b),"timed"==d&&c._createTimedInteractiveImage(b)})},_createBlurInteractiveImage:function(a){a.on("click",function(){var b=a.data("blurLevel")||0;a.removeClass("blur"+b),b++,b>3&&(b=0),a.addClass("blur"+b).data("blurLevel",b)})},_createSpotlightInteractiveImage:function(a){var b=a.find(".spotlight"),c=a.find(".reveal");c.on("click",function(b){a.find(".hidden").removeClass("hidden"),a.one("click",function(){a.find("img").addClass("hidden")}),b.stopPropagation()}),b.css({background:"url("+a.attr("data-imagesrc")+") no-repeat 0 0"}).draggable({containment:"parent",drag:function(a,c){var d=-parseInt(c.position.left)+"px "+-parseInt(c.position.top)+"px";b.css({backgroundPosition:d})}}).resizable({containment:"parent",handles:{nw:".nwgrip",ne:".negrip",sw:".swgrip",se:".segrip",n:".ngrip",e:".egrip",s:".sgrip",w:".wgrip"},minHeight:75,minWidth:75,resize:function(a,c){var d=-parseInt(c.position.left)+"px "+-parseInt(c.position.top)+"px";b.css({backgroundPosition:d})}})},_createTimedInteractiveImage:function(a){var c=a.find(".controlsContainer"),d=this;c.on("click",".play:not(.playing)",function(){var e=a.attr("data-intervalcount")||0,f=a.attr("data-duration")||2;c.fadeOut(),c.find(".singleButton").addClass("playing disabled inactive"),a.find(".interactiveImage").addClass("show");var g=b.setInterval(function(){return e++,e>f-1?(d._stopInterval(a),void c.fadeIn()):void 0},1e3);a.attr("data-interval",g)}),c.on("click",".reveal:not(.playing)",function(){d._stopInterval(a),a.find(".interactiveImage").toggleClass("show")})},_stopInterval:function(a){var c=a.attr("data-interval")||0;c>0&&(b.clearInterval(c),a.removeAttr("data-interval").removeAttr("intervalCount").find(".interactiveImage.show").removeClass("show"),a.find(".singleButton").removeClass("playing disabled inactive"))},close:function(){this.reset()},reset:function(){this.$interactiveImages.find(".torch.spotlight").removeClass("size1 size2 size3").addClass("size0").css({left:"0px",top:"0px",backgroundPosition:"0px 0px"}).parent().find("img").addClass("hidden"),this.$interactiveImages.filter(".timed").each(function(){var c=a(this),d=c.attr("data-interval")||0;d>0&&b.clearInterval(d),c.removeAttr("data-interval").removeAttr("data-intervalCount").end().find(".singleButton").removeClass("playing disabled inactive").end().find(".show").removeClass("show")})}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.InteractiveText=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){switch(this.$interactiveTextBlock=b,this.startInterval=0,this.interval=0,this.catType="",this.showCountDown="",this.playing=!1,this.paused=!1,this.$blockControls=this.$interactiveTextBlock.find(".speedControls"),this.$eElements=this.$interactiveTextBlock.find(".eSpan, .eDiv"),this.catType=this.$blockControls.attr("data-cattype"),this.timed=this.$blockControls.attr("data-timed"),this.showCountDown=this.$blockControls.attr("data-countdown"),this.startInterval=this.$blockControls.attr("data-begin"),this.controlType=this.$blockControls.attr("data-controltype"),this.cumulative="cumulative"==this.controlType,RCF.Utils.isEmpty(this.startInterval)&&(this.startInterval=0),this._setCatList(this.$blockControls.attr("data-catlist")),this.catType){case"blur":this.classToToggle="blurred";break;case"hide":case"show":this.classToToggle="hidden";break;case"highlight":this.classToToggle="highlight"}var c=this;if("y"==c.timed){if(!RCF.Utils.isEmpty(this.catList)){var d=this.catList;this.counter=0;var e=this.$blockControls.find(".play");this.$blockControls.find(".reset").on("click",function(){e.text("Start"),c.playing=!1,c.paused=!1,c.reset()}),e.on("click",function(){if(c.playing&&(c.paused="Pause"==e.text()),e.text("Start"==e.text()?"Pause":"Start"),!c.paused&&!c.playing){c.reset(),c.playing=!0;var a=0,b=parseInt(c.startInterval)+parseInt(d[d.length-1][1]);c.interval=setInterval(function(){if(!c.paused){if("y"==c.showCountDown){var e=b-c.counter,f=parseInt(e/3600)%24,g=parseInt(e/60)%60,h=parseInt(e%60,10),i=(10>f?"0"+f:f)+":"+(10>g?"0"+g:g)+":"+(10>h?"0"+h:h);c.$blockControls.find(".countDown").text("("+i+")")}for(var j=a;j<d.length;j++){var k=parseInt(d[j][1])+parseInt(c.startInterval);if(c.counter==k){var l=c.$eElements.filter("[data-cat='"+d[j][0].replace("'","\\'")+"']");switch(a=j,c.catType){case"hide":l.addClass(c.classToToggle);break;case"show":l.removeClass(c.classToToggle);break;case"highlight":case"blur":l.addClass(c.classToToggle)}j==d.length-1&&(clearInterval(c.interval),c.counter=0,c.$blockControls.find(".play").text("Start"),c.playing=!1,c.paused=!1,c.$blockControls.find(".countDown").text(""))}}c.counter++}},1e3)}})}}else{var f=this.$blockControls.attr("data-defaultcatid");RCF.Utils.isEmpty(f)||(c.cumulative?this._processCumulativeCategory(f,!0):c._toggleCategory(f)),this.$blockControls.on("click","a[data-cat]",function(){var b=a(this),d=b.attr("data-cat"),e=b.attr("data-oncaption"),f=b.attr("data-offcaption");return c.cumulative||"radio"==c.controlType?void c._toggleCategory(d):(b.toggleClass("selected"),RCF.Utils.isEmpty(f)&&(f=b.text()),RCF.Utils.isEmpty(e)&&(e=f),b.text(b.hasClass("selected")?e:f),void c.$eElements.filter("[data-cat='"+d.replace("'","\\'")+"']").toggleClass(c.classToToggle))})}},_setCatList:function(a){if(this.catList=null,!RCF.Utils.isEmpty(a)){for(var b=a.split("|"),c=0,d=0;d<b.length;d++){var e=b[d].split(":");RCF.Utils.isEmpty(e[1])||isNaN(e[1])?e[1]=0:c+=parseInt(e[1]),b[d]=e}c>0&&b.sort(function(a,b){var c=parseInt(a[1]),d=parseInt(b[1]);return c===d?0:d>c?-1:c>d?1:0}),this.catList=b}},_toggleCategory:function(a){var b=this.$blockControls.find("a[data-cat='"+a.replace("'","\\'")+"']"),c=b.hasClass("selected");"radio"===this.controlType||"cumulative"===this.controlType?(b.parent().find("a").removeClass("selected"),c=!c,b.addClass("selected"),this.cumulative?this._processCumulativeCategory(a,!0):(this.$eElements.removeClass(this.classToToggle),this.$eElements.filter("[data-cat='"+a.replace("'","\\'")+"']").addClass(this.classToToggle))):(b.toggleClass("selected"),this.$eElements.filter("[data-cat='"+a.replace("'","\\'")+"']").toggleClass(this.classToToggle))},_processCumulativeCategory:function(a){for(var b=!1,c=0;c<this.catList.length;c++){var d=this.catList[this.catList.length-1-c][0],e=this.$eElements.filter("[data-cat='"+d+"']"),f=!1,g=!1;d==a||b?d!=a&&b?(f="show"===this.catType,g="hide"===this.catType):d==a&&(f="hide"===this.catType,g="show"===this.catType,b=!0):(f="hide"===this.catType,g="show"===this.catType),f&&e.addClass("hidden"),g&&e.removeClass("hidden")}},reset:function(){switch(this._clearInterval(),this.counter=0,this.$blockControls.find(" .countDown").text(""),this.catType){case"blur":this.$eElements.removeClass("blurred");break;case"hide":this.$eElements.removeClass("hidden");break;case"show":this.$eElements.addClass("hidden");break;case"highlight":this.$eElements.removeClass("highlight")}if("y"!=this.timed){var a=this.$blockControls.attr("data-defaultcatid");RCF.Utils.isEmpty(a)||(this._processCumulativeCategory(a,!0),this.$blockControls.find("a").removeClass("selected").filter("[data-cat='"+a.replace("'","\\'")+"']").addClass("selected"))}},pause:function(){this._clearInterval()},_clearInterval:function(){this.interval>0&&(clearInterval(this.interval),this.interval=0)},close:function(){this._clearInterval(),this.$blockControls.find(".reset").off(),this.$blockControls.find(".play").off(),this.$blockControls.find("a").off()}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.AudioPlayer=function(){function b(a){this.currentPlayerElemID=null,this.assetURL=a.closest(".activity").attr("data-levelassetsurl"),this.assetURL&&(this.assetURL+="/audio/"),this._initialize(a)}return b.prototype={_initialize:function(b){var c=this;c.$selector=b,b.each(function(){var b=a(this),d=a(this).find(".audioPlayer"),e=d.attr("data-audiosrc"),f=d[0].id.split("_")[1],g="#audioPlayerInterface_"+f,h=e.split("/"),i="",j=null;try{i=h[h.length-1].replace(".mp3",""),j=a(".audioScript[data-audiosrc='"+i.replace(".mp3","")+"']")}catch(k){}var l=d.closest(".audio").find(".audioTrack"),m=d.closest(".audio").find(".continuousPlay"),n=0;RCF.Utils.endsWith(e.toLowerCase(),".mp3")||(e+=".mp3"),d.jPlayer({errorAlerts:!0,warningAlerts:!1,ready:function(){d.jPlayer("setMedia",{mp3:c.assetURL+e,preload:"auto"});var a=b.filter(".large:not(.noSubtitles)");a.length>0&&new RCF.Behaviors.Unmarked.Subtitles(a)},swfPath:RCF.options.swfFallbackURL,supplied:"mp3",cssSelectorAncestor:g,cssSelector:{play:".audioPlayButton",pause:".audioPauseButton",stop:".audioStopButton",seekBar:".audioSeekBar",playBar:".audioPlayBar",mute:".audioMuteButton",unmute:".audioUnmuteButton",currentTime:".audioCurrentTime",duration:".audioDuration"}}).on(a.jPlayer.event.timeupdate,function(c){var d=c.jPlayer.status.currentTime,e=b.find(".audioScript"),f=b.data("lastLine");d=parseInt(d);var g=b.find(".subTitleLine").filter(function(){return parseInt(a(this).attr("data-time")||0)<d+1}).last();if(g.length>0&&f!==g.attr("data-time")&&(b.find(".subTitleLine.playing").removeClass("playing"),b.data("lastLine",g.attr("data-time")),g.addClass("playing"),"y"===b.attr("data-autoscroll"))){var h=e.scrollTop()+g.position().top-e.height()/2+g.height()/2;e.animate({scrollTop:h},200)}}).on(a.jPlayer.event.play,function(){a(this).jPlayer("pauseOthers").closest(".activity").trigger("rcf.stop.audio"),"y"===b.attr("data-autocc")&&b.find(".audioScript.popupPanel:visible").length<1&&b.find(".audioScriptButton").trigger("click")}).on(a.jPlayer.event.ended,function(){j.length>0&&j.find("p.playing").removeClass("playing");var b=a(this);if(m.length>0&&m[0].checked&&n<l.length-1){n++;var c=a(l[n]),d=c.attr("data-audiosrc"),e=d.split("/"),f="",g=j.length>0&&j.is(":visible");g&&j.hide();try{f=e[e.length-1].replace(".mp3",""),j=a(".audioScript[data-audiosrc='"+f.replace(".mp3","")+"']")}catch(h){}j.find("p.playing").removeClass("playing"),g&&j.show(),b.jPlayer("setMedia",{mp3:d}),b.jPlayer("play")}}).on(a.jPlayer.event.timeupdate,function(a){var b=a.jPlayer.status.currentTime;b=parseInt(b);var c=j.find("[data-time='"+b+"']");c.length>0&&(j.find("p.playing").removeClass("playing"),c.addClass("playing"))}),b.on("click",".audioScriptButton",function(c){var d=b.find(".audioScript.popupPanel"),e=b.closest(".activity").find(".audioScript.popupPanel");return e.removeClass("currentScript"),a(this).blur(),d.is(":visible")?d.removeClass("currentScript").slideUp():d.addClass("currentScript").slideDown(),e.filter(":not(.currentScript)").slideUp(),c.preventDefault(),c.stopImmediatePropagation(),!1}),b.on("click",".subTitleLine",function(b){var c=a(this),e=c.attr("data-time");return d.jPlayer("play",parseInt(e)),b.preventDefault(),!1})})},_stopAll:function(){this.$selector.find(".audioPlayer").each(function(){a(this).jPlayer("stop")})},reset:function(){this._stopAll()},close:function(){this.reset(),this.$selector.find(".audioPlayer").each(function(){a(this).jPlayer("destroy")})}},b}(),RCF.Behaviors.Unmarked.VideoPlayer=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){var c=this;this.$selector=b.find(".videoPlayer"),this.videoAssetURL=b.closest(".activity").attr("data-levelassetsurl"),this.videoAssetURL&&(this.videoAssetURL+="/video/"),RCF.subscribe("rcf.stop.video",function(){c._stopAll()}),this.suffix=RCF.Utils.isTabletDevice()||RCF.Utils.isMobileDevice()?"-SD":"-HD",this.$selector.each(function(){var b=a(this),d="y"==b.attr("data-switchvideo")||!1,e=b.attr("src"),f=b.closest(".rcfVideo")[0].id;d||(c.suffix=""),e=c.videoAssetURL+(RCF.Utils.endsWith(c.videoAssetURL,"/")?"":"/")+b.attr("src").replace(".mp4",c.suffix+".mp4");var g=function(){return RCF.Utils.isMobileDevice()?RCF.options.videoSize.mobile:RCF.options.videoSize.desktop}();b.jPlayer({errorAlerts:!0,warningAlerts:!1,preload:"auto",ready:function(){a(this).jPlayer("setMedia",{m4v:e,mp4:e})},swfPath:RCF.options.swfFallbackURL,supplied:"m4v,mp4",size:g,autoHide:{restored:!1,full:!1,fadeOut:1e4},cssSelectorAncestor:"#"+f}).bind(a.jPlayer.event.play,function(){a(this).jPlayer("pauseothers")}).bind(a.jPlayer.event.timeupdate,function(){})})},_stopAll:function(){this.$selector.each(function(){a(this).jPlayer("stop")})},reset:function(){this._stopAll()},close:function(){this.reset(),RCF.unsubscribe("rcf.stop.video"),this.$selector.each(function(){a(this).jPlayer("destroy")})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.Popup=function(){function c(a){this._initialize(a)}return c.prototype={_initialize:function(c){if(RCF.Utils.isEmpty(c))throw"Empty Activity passed into PopupElement Behavior";
this.$activity=c,this.activityID=c[0].id,this.$selector=this.$activity.find(".popupLink"),this.$popups=this.$activity.find(".popup"),this.$activity.on("click",".popupLink",function(c){var d=a(this),e=d.attr("data-infoblockid"),f=a("#"+e);f.detach().prependTo(d).css({display:"absolute",bottom:f.height(),"z-index":"10020"}),c.pageX+f.width()>a(b).width()-40?f.css("left",a(b).width()-(f.width()+40)):f.css("left",0),f.addClass("showPopup").fadeIn()}),this.$popups.on("click",".popupClose",function(){var b=a(this).parent();b.fadeOut()})}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.Subtitles=function(){function b(a){this.$audioContainer=a;var b=a.closest(".activity").attr("data-levelassetsurl");RCF.Utils.isEmpty(b)||(RCF.Utils.endsWith(b,"/")||(b+="/"),b+="srt/"+a.find(".audioPlayer").attr("data-lookforid")+".srt",this.url=b,this._initialize())}function c(a){var b=0;if(a)for(var c=a.split(":"),d=0;d<c.length;d++)b=60*b+parseFloat(c[d].replace(",","."));return b}function d(a){return a.replace(/^\s+|\s+$/g,"")}return b.prototype={_initialize:function(){var b=this,e=[],f=null;a.ajax({url:b.url,dataType:"text",async:!1}).done(function(g){f=g,f=f.replace(/\r\n|\r|\n/g,"\n"),f=d(f);var h=f.split("\n\n"),i=b.$audioContainer.find(".audioScript .script");for(var j in h){var k=h[j].split("\n");if(k.length>=2){var l=d(k[1].split(" --> ")[0]),m=d(k[1].split(" --> ")[1]),n=k[2];if(k.length>2)for(var o=3;o<k.length;o++)n+="\n"+k[o];var p=parseInt(c(l));RCF.Utils.isEmpty(n)&&(n=""),e[p]={i:l,o:m,t:n};var q=a("<p class='subTitleLine' data-time='"+p+"'><span>"+n+"</span>");i.append(q)}}b.$audioContainer.removeClass("noSubtitles")}).fail(function(){b.$audioContainer.addClass("noSubtitles").find(".audioScriptButton").hide()})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.TimedMarkupBlock=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){this.$selector=b,this.$activity=b.closest(".activity"),this.$activity.on("click",".timedMarkupBlock .singleButton.play:not(.playing, .inactive)",function(){var b=a(this);b.addClass("playing disabled inactive").parent().find(".reveal").addClass("playing disabled inactive");var c=b.closest(".timedMarkupBlock"),d=parseInt(c.attr("data-duration"),10),e=c.attr("data-initialclass"),f=c.attr("data-activeclass"),g=c.attr("data-finalclass"),h=this;c.removeClass(g).removeClass(e).addClass(f);var i=function(){var a=d,e=parseInt(a/3600)%24,i=parseInt(a/60)%60,j=parseInt(a%60,10),k=(10>e?"0"+e:e)+":"+(10>i?"0"+i:i)+":"+(10>j?"0"+j:j);c.find(".countDown").text(k),1>d&&(clearInterval(h.interval),c.removeData("interval").removeClass(f).addClass(g).find(".singleButton").removeClass("playing disabled inactive").end().find(".countDown").text(""),b.removeClass("playing disabled inactive")),d--};i(),this.interval=setInterval(i,1e3),c.data("interval",this.interval)}),this.$activity.on("click",".timedMarkupBlock .singleButton.reveal:not(.playing, .inactive)",function(){var b=a(this).closest(".timedMarkupBlock"),c=b.attr("data-activeclass"),d=b.attr("data-finalclass");b.removeData("interval").removeClass(d).addClass(c).find(".singleButton").remove("playing disabled inactive").end().find(".countDown").text("")})},reset:function(){this.$selector.each(function(){var b=a(this),c=b.attr("data-activeclass"),d=b.attr("data-initialclass"),e=b.attr("data-finalclass"),f=b.data("interval");f&&clearInterval(f),b.removeClass(c+" "+e).addClass(d).find(".singleButton").removeClass("playing disabled inactive").end().find(".countDown").text("")})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.ToggleElements=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty $ToggleElements passed into Toggle behavior constructor";this.$selector=b,RCF.Utils.isEmpty(this.$selector)||this.$selector.closest(".activity").on("click","span.toggle",function(){var b=a(this),c=b.attr("data-toggleStates");RCF.Utils.isEmpty(c)&&(c=2);var d=b.data("toggleState");RCF.Utils.isEmpty(d)&&(d=1),b.removeClass("toggleState"+d),++d>c&&(d=0),d>0?(b.addClass("toggleState"+d),b.data("toggleState",d)):b.removeData("toggleState")})},showAnswers:function(a){for(var b in a.answers){var c=a.answers[b],d=c.elm;if(!RCF.Utils.isEmpty(d)){var e=this.$selector.filter("[data-rcfid='"+d+"']");if(!RCF.Utils.isEmpty(e)){var f=e,g=0;try{g=parseInt(f.attr("data-toggleStates"))}catch(h){g=2}if(!RCF.Utils.isEmpty(c.value)){for(var i=0;g+1>i;i++)f.removeClass("toggleState"+i);f.addClass("toggleState"+c.value)}}}}},getUserAnswers:function(){var b=this.$selector.map(function(){var b=a(this);return{elm:b.attr("data-rcfid"),type:"simple",value:b.data("toggleState")||""}}).get();return b},reset:function(){this.$selector.each(function(){var b=a(this),c=0;try{c=parseInt(b.attr("data-toggleStates"))}catch(d){c=2}for(var e=0;c+1>e;e++)b.removeClass("toggleState"+e);b.removeData("toggleState")})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.TriggerElements=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){var c=this;this.$triggerableElements=b,this.$activity=this.$triggerableElements.closest(".activity"),this.$triggerableElements.on("click",function(b){var d=a(this).addClass("triggered"),e=d.attr("data-triggerClass"),f="y"==d.attr("data-triggerLoop"),g=parseInt(d.attr("data-triggerNumber"))||1,h="y"===d.attr("data-triggerExclusive"),i=parseInt(d.data("triggerCount"))||0;return h&&(c._removeTriggerClasses(c.$triggerableElements),c.$triggerableElements.each(function(){var b=a(this);b.attr("data-triggerClass")!=e&&c._removeTriggerClasses(b)})),f&&i===g?(d.removeClass(e+i),c.$activity.removeClass(e+i),i=0,d.removeClass("triggered"),void d.data("triggerCount",i)):(g>i&&(d.removeClass(e+i),c.$activity.removeClass(e+i),i++,g>=i&&(d.addClass(e+i),c.$activity.addClass(e+i)),d.data("triggerCount",i)),b.stopImmediatePropagation(),b.stopPropagation(),void b.preventDefault())}),RCF.subscribe("rcf.reset.triggers",function(){c.reset()})},_removeTriggerClasses:function(b){var c=this;b.each(function(){var b=a(this);b.removeClass("triggered");for(var d=b[0].className.split(" "),e=0;e<d.length;e++)"tr_"===d[e].toLowerCase().substr(0,4)&&(b.removeClass(d[e]).removeData("triggerCount"),c.$activity.removeClass(d[e]))})},reset:function(){this._removeTriggerClasses(this.$triggerableElements),this.$triggerableElements.data("triggerCount",0);for(var a=this.$activity.attr("class").trim().split(" "),b=0;b<a.length;b++)a[b].indexOf("tr_")>-1&&this.$activity.removeClass(a[b])}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.TextInput=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){if(RCF.Utils.isEmpty(b))throw"Empty $activity selector passed to Unmarked Text Input constructor";this.$activity=b,this.$selector=b.find("[data-rcfinteraction=unmarkedTextInput]"),this.$activity.on("input keyup change paste",".unmarkedTextInput",function(){a(this).toggleClass("populated",a(this).val().length>0)})},showAnswers:function(b){var c=b.id,d=this.$activity.attr("id");if(c!=d)throw"Invalid JSON Answers provided for activity ["+d+"]\n\nAnswers provided were for activity ["+b.id+"]";for(var e in b.answers){var f=b.answers[e],g=f.elm,h=this.$activity.find("[data-rcfid='"+g+"']");if(!RCF.Utils.isEmpty(h)){var i=h,j=(a.isArray(f.value)?f.value[0]:f.value)||"";i.val(j).trigger("autosize.resize").toggleClass("populated",j.length>0)}}},getUserAnswers:function(){var b=[];return this.$selector.each(function(){var c=a(this);b.push({elm:c.attr("data-rcfid"),type:"simple",value:c.val()||""})}),b},reset:function(){this.$selector.val("").removeClass("populated").trigger("autosize.resize")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Behaviors=RCF.Behaviors||{},RCF.Behaviors.Unmarked=RCF.Behaviors.Unmarked||{},RCF.Behaviors.Unmarked.WordBox=function(){function b(a){this._initialize(a)}return b.prototype={_initialize:function(b){this.$wordBox=b,this.getWordItems().each(function(){var b=a(this);b.data("wordItemID",b.attr("data-rcfid"))})},randomizeItems:function(){this.$wordBox.mmRandomize("li")},getWordItem:function(a){return this.$wordBox.find("li[data-rcfid='"+a+"']:not(.ui-draggable-dragging)")},getWordItems:function(){return this.$wordBox.find("li")},removeWordItem:function(a){if(a){if(a.data("moved",""),!a.attr("data-restrictcount"))return void(a.hasClass("complex")||a.addClass("dragged"));var b=a.data("displayCount")||parseInt(a.attr("data-restrictcount"));1>b||(--b<1&&a.addClass("dragged"),a.data("displayCount",b))}},addWordItem:function(a){if(a&&(a.data("moved","N").removeClass("dragged").hide().fadeIn("fast"),a.attr("data-restrictcount"))){var b=parseInt(a.attr("data-restrictcount")||0);if(!(1>b)){var c=a.data("displayCount");isNaN(c)&&(c=b),b>=c&&a.data("displayCount",++c)}}},reset:function(){var b=this.getWordItems();b.removeClass("selected").data("moved","").removeClass("dragged").hide().fadeIn("fast"),b.each(function(){var b=a(this);b.data("displayCount",b.attr("data-restrictcount"))})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Handlers=RCF.Handlers||{},RCF.Handlers.ClickStickHandler=function(){function b(a,b,c,d){if(this.$activity=a,this.sourceClass=b,this.targetClass=c,this.$sourceItem=null,this.$destinationItem=null,RCF.Utils.isEmpty(d)&&(d=!0),this.removeAfterMove=d,this.$wordList=a.find(".wordBox"),this.$wordList.length<1)throw"No wordlist available for activity ["+this.$activity[0].id+"] - initializing click stick handler";this.wordBox=new RCF.Behaviors.Unmarked.WordBox(this.$wordList),this.dropTargets=new RCF.Handlers.DroppableTargetHandler(this.$activity),this._initialize()}return b.prototype={_initialize:function(){var b=this;this.$wordList.on("click",function(){if(!RCF.Utils.isEmpty(b.$sourceItem)&&b._itemIsDropTarget(b.$sourceItem)){var a=b.$sourceItem.data("wordItemID");RCF.Utils.isEmpty(a)||(b.wordBox.addWordItem(b.wordBox.getWordItem(a)),b.dropTargets.clearDropTargets(b.$sourceItem),b.$sourceItem=null,b.$destinationItem=null)}});var c=["."+this.sourceClass,"."+this.targetClass].join(",");this.$activity.on("click",c,function(c){if(!a(this).hasClass("example")){if(RCF.Utils.isEmpty(b.$sourceItem))return b._selectFirstItem(a(this)),void c.preventDefault();b.$destinationItem=a(this);var d=b.$sourceItem[0].id,e=b.$destinationItem[0].id;if(d==e)return b.$destinationItem.removeClass("selected"),b.$sourceItem=null,b.$destinationItem=null,void c.preventDefault();if(b._bothItemsInWordList())return b.$sourceItem.removeClass("selected"),b.$destinationItem.addClass("selected"),b.$sourceItem=b.$destinationItem,b.$destinationItem=null,void c.preventDefault();if(b._movingFromDropTargetToWordList()){var f=b.$sourceItem.data("wordItemID");return RCF.Utils.isEmpty(f)||(b.wordBox.addWordItem(b.wordBox.getWordItem(f)),b.dropTargets.clearDropTargets(b.$sourceItem),b.$destinationItem.removeClass("selected"),b.$sourceItem=null,b.$destinationItem=null),void c.preventDefault()}b.$destinationItem.addClass("selected");var g="",h=b.$destinationItem.data("wordItemID"),i=a.trim(b.wordBox.getWordItem(b.$sourceItem.data("wordItemID")).html());b._itemIsDropTarget(b.$sourceItem)&&b.$sourceItem.html(i),b._itemIsWordListItem(b.$sourceItem)?(b.wordBox.removeWordItem(b.$sourceItem),g=b.$sourceItem.attr("data-rcfid")):(g=b.$sourceItem.data("wordItemID"),RCF.Utils.isEmpty(g)&&(g=b.$sourceItem.parent().attr("data-rcfid")),i=b.wordBox.getWordItem(g).html()),RCF.Utils.isEmpty(h)||(b.wordBox.addWordItem(b.wordBox.getWordItem(h)),b.dropTargets.clearDropTargets(b.$destinationItem)),b.$sourceItem.removeClass("selected"),b.$destinationItem.html(i).removeClass("selected"),b.$destinationItem.hasClass("capitalise")&&b.dropTargets.capitalizeDropTarget(b.$destinationItem),b.dropTargets.populateDropTarget(b.$destinationItem,b.$sourceItem),b.$destinationItem.data("user-answer",g),b._itemIsDropTarget(b.$sourceItem)&&b.dropTargets.clearDropTargets(b.$sourceItem),b._itemIsWordListItem(b.$sourceItem)||b.$sourceItem.removeAttr("data-audiolink").removeAttr("data-audiolinkid"),b.$sourceItem=null,b.$destinationItem=null,c.preventDefault()}})},_itemIsDropTarget:function(a){return a.hasClass(this.targetClass)},_itemIsWordListItem:function(a){return a.hasClass(this.sourceClass)},_selectFirstItem:function(b){if(!b.data("wordItemID")&&a.trim(b.html()).length<1)return void(this.$sourceItem=null);this.$sourceItem=b;var c=b.attr("data-audiolink");return c&&c.length>0&&b.trigger("rcf.play.audio",c),this.$activity.hasClass("marking")?void(this.$sourceItem=null):(b.addClass("selected"),void(this.$destinationItem=null))},_bothItemsInWordList:function(){return this.$sourceItem.hasClass(this.sourceClass)&&this.$destinationItem.hasClass(this.sourceClass)},_movingFromDropTargetToWordList:function(){return this.$sourceItem.hasClass(this.targetClass)&&this.$destinationItem.hasClass(this.sourceClass)},reset:function(){var a=this.$sourceItem,b=this.$destinationItem;RCF.Utils.isEmpty(a)||a.data("wordItemID","").data("user-answer","").removeClass("selected populated inline"),RCF.Utils.isEmpty(b)||b.data("wordItemID").data("user-answer","").removeAttr("data-audiolink").removeAttr("data-audiolinkid").removeClass("selected populated inline"),this.$sourceItem=null,this.$destinationItem=null},close:function(){this.$wordList.off("click");var a=["."+this.sourceClass,"."+this.targetClass].join(",");this.$activity.off("click",a)}},b}(),RCF.Handlers.ClickStickCategoriseHandler=function(){function c(a,b,c){if(this.$activity=a,this.highlightClass=b,this.$sourceItem=null,this.$destinationItem=null,RCF.Utils.isEmpty(c)&&(c=!0),this.removeAfterMove=c,this.$wordList=a.find(".wordBox"),0===this.$wordList.length)throw"No wordlist available for the categorise in activity [ "+this.$activity[0].id+" ]";this._initialize()}return c.prototype={_initialize:function(){var b=this,c=b.$activity.find(".category .dropTarget"),d=function(a,b){var c=b.attr("data-audiolink"),d=b.find(".inlinePlayer");d.hasClass("playing")?b.trigger("rcf.pause.audio"):b.trigger("rcf.play.audio",c)};b.$wordList.find("[data-audiolink]").on("click",function(b){var c=a(this);d(b,c),c.hasClass("audio")}),c.on("click","[data-audiolink]",function(b){d(b,a(this)),a(this).hasClass("audio")}),b.$wordList.on("click","li.dragItem:not(.example)",function(c){b._listItemClicked(a(this),c),c.stopImmediatePropagation(),c.preventDefault()}),c.on("click","li.dragItem",function(c){b._listItemClicked(a(this),c),c.stopImmediatePropagation(),c.preventDefault()}),b.$wordList.on("click",function(a){if(!RCF.Utils.isEmpty(b.$sourceItem)){if(b.$sourceItem.closest(".wordBox").length>0)return a.stopImmediatePropagation(),void a.preventDefault();b._moveFromCategoriseToWordList(b.$sourceItem,b.$wordList),a.stopImmediatePropagation(),a.preventDefault()}}),c.on("click",function(c){var d=a(this);if(RCF.Utils.isEmpty(b.$sourceItem))return c.stopImmediatePropagation(),void c.preventDefault();if(b.$sourceItem.closest(".wordBox").length>0)b._moveFromWordListToCategorise(b.$sourceItem,d),b.$sourceItem=null;else if(b.$sourceItem.hasClass("dragItem")){var e=b.$sourceItem.closest(".dropTarget").attr("id"),f=this.id;e!=f&&(b._moveFromCategoryToCategory(b.$sourceItem,d),b.$sourceItem=null)}c.stopImmediatePropagation(),c.preventDefault()}),b.$wordList.parent().on("click",function(c){if(!(a(c.target).closest(".inlinePlayer").length>0)){if(RCF.Utils.isEmpty(b.$sourceItem)||b.$sourceItem.closest(".wordBox").length>0)return c.stopImmediatePropagation(),void c.preventDefault();b._moveFromCategoriseToWordList(b.$sourceItem,b.$wordList),b.$sourceItem=null,c.stopImmediatePropagation(),c.preventDefault()}})},_listItemClicked:function(a,b){var c=this;if(RCF.Utils.isEmpty(c.$sourceItem))return c.$sourceItem=a,c.$sourceItem.addClass(c.highlightClass),b.stopImmediatePropagation(),void b.preventDefault();var d=a,e=d[0].id,f=c.$sourceItem[0].id,g=c.$sourceItem.closest(".wordBox"),h=c.$sourceItem.closest(".category .dropTarget"),i=d.closest(".wordBox"),j=d.closest(".category .dropTarget");if(e==f)return c.$sourceItem.removeClass(c.highlightClass),c.$sourceItem=null,b.stopImmediatePropagation(),void b.preventDefault();if(g.length>0)return i.length>0?(c.$sourceItem.removeClass(c.highlightClass),c.$sourceItem=d,c.$sourceItem.addClass(c.highlightClass)):(c._moveFromWordListToCategorise(c.$sourceItem,j),c.$sourceItem=null),b.stopImmediatePropagation(),void b.preventDefault();if(h.length>0){var k=h[0].id;if(j.length>0){if(k==j[0].id)return c.$sourceItem.removeClass(c.highlightClass),c.$sourceItem=a,c.$sourceItem.addClass(c.highlightClass),b.stopImmediatePropagation(),void b.preventDefault();c._moveFromCategoryToCategory(c.$sourceItem,j),c.$sourceItem=null}else c._moveFromCategoriseToWordList(c.$sourceItem)}RCF.Utils.isEmpty(c.$sourceItem)||c.$sourceItem.removeClass(c.highlightClass),c.$sourceItem=null,b.stopImmediatePropagation(),b.preventDefault()},_moveFromWordListToCategorise:function(a,b){var c=this,d=a,e=d.clone(),f=b.find("ul");return!c.removeAfterMove&&f.find("#"+d[0].id).length>0?void d.removeClass(c.highlightClass):(d.removeClass(c.highlightClass),e.removeClass(c.highlightClass).appendTo(b.find("ul")),c.removeAfterMove&&d.addClass("dragged"),c.$sourceItem=null,void c._triggerResize())},_moveFromCategoryToCategory:function(a,b){var c=this;return!c.removeAfterMove&&b.find("#"+a[0].id).length>0?(a.removeClass(c.highlightClass),void(c.$sourceItem=null)):(a.removeClass(c.highlightClass).appendTo(b.find("ul")),c.$sourceItem=null,void c._triggerResize())},_moveFromCategoriseToWordList:function(a,b){var c=this,d=a[0].id,e=b.find("li[id='"+d+"']");RCF.Utils.isEmpty(e)||(e.removeClass("dragged"),e.removeClass(c.highlightClass),a.remove()),c.$sourceItem=null,c._triggerResize()},_triggerResize:function(){setTimeout(function(){b.RCF.publish("update.categories.size")},50)}},c}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Handlers=RCF.Handlers||{},RCF.Handlers.DraggableActivityHandler=function(){function b(a){if(this.$activity=a,this.$wordList=a.find("div.wordBox ul"),RCF.Utils.isEmpty(this.$activity))throw"No Activity passed to the DraggableActivity constructor !";if(RCF.Utils.isEmpty(this.$wordList))throw"No WordList inside DraggableActivity Activity !";this.wordBox=new RCF.Behaviors.Unmarked.WordBox(this.$wordList),this.dropTargets=new RCF.Handlers.DroppableTargetHandler(this.$activity),this._initialize()}return b.prototype={_initialize:function(){var b=this;this.$dragTargets=this.$activity.find(".dragTarget.movable:not(.example)"),this.wordBox.getWordItems().draggable({cursor:"pointer",scroll:!0,scrollSensitivity:100,helper:function(){var b=null;try{b=a(this).clone().css({width:a(this).width()+2+"px"})}catch(c){}return b},start:function(){var c=a(this),d=c.attr("data-audiolink");b.wordBox.removeWordItem(c),d&&d.length>0&&c.trigger("rcf.play.audio",d)},stop:function(){var c=a(this);"Y"!=c.data("moved")&&b.wordBox.addWordItem(c)}}),b.$wordList.parent().droppable({cursor:"pointer",tolerance:"intersect",hoverClass:"dragOverDrop",accept:b.$wordList.closest(".activity").find(".dragTarget"),drop:function(a,c){var d=c.draggable.data("wordItemID"),e=b.wordBox.getWordItem(d);b.wordBox.addWordItem(e.data("moved","N"));try{b.dropTargets.clearDropTargets(c.draggable),c.draggable.data("moved","Y").draggable("option","disabled",!0)}catch(f){console.log("Error removing 'dropTarget' draggable object ! \n\n"+f)}}}),b.$dragTargets.draggable({hoverClass:"dragOverDrop",scroll:!0,scrollSensitivity:100,disabled:!0,helper:function(){var c=a(this).data("wordItemID");if(RCF.Utils.isEmpty(c))return null;var d=b.wordBox.getWordItem(c).show(),e=d.clone().removeClass("dragged"),f=a(this).width()+1,g=b.$dragTargets;return Math.abs(f-d.width())>10?g.draggable("option","cursorAt",{left:25,top:5}):g.draggable("option","cursorAt",null),b.$wordList.prepend(e),e.attr("id",e.attr("id")+"_clone"),e},start:function(){var b=a(this),c=b.attr("data-audiolink"),d=b.html();b.data("moved","N").data("html",d).removeClass("populated").html(""),c&&c.length>0&&b.trigger("rcf.play.audio",c)},stop:function(){var b=a(this);"Y"!=b.data("moved")?b.data("moved","").addClass("populated").html(b.data("html")).removeData("html"):b.data("moved","").removeClass("populated").html("").removeData("html").removeAttr("data-audiolink").removeAttr("data-audiolinkid").removeData("wordItemID")}}),b.$dragTargets.droppable({accept:b.$activity.find(".dragItem, .dragTarget"),hoverClass:"dragOverDrop",revert:"invalid",greedy:"true",tolerance:"pointer",drop:function(c,d){var e=d.draggable,f=a(this),g=a.trim(e.html()),h=f.data("wordItemID"),i=b.wordBox.getWordItem(h);RCF.Utils.isEmpty(h)||b.wordBox.addWordItem(i);var j=d.helper.width(),k=f.width(),l=e.hasClass("dragItem")?e.attr("data-rcfid"):e.data("wordItemID");if(f.attr("data-audioLink",e.attr("data-audiolink")||"").attr("data-audiolinkid",e.attr("data-audiolinkid")||"").data("wordItemID",l).data("user-answer",l),e.data("moved","Y"),e.hasClass("dragItem")||(g=a.trim(b.wordBox.getWordItem(l).html()),e.removeClass("populated inline").removeData("wordItemID").removeData("user-answer").draggable("option","disabled",!0)),f.html(g).addClass("populated").draggable("option","disabled",!1),f.hasClass("capitalise")){var m=f.contents().last()[0],n="";if(m)try{n=m.textContent,n=n.charAt(0).toUpperCase()+n.slice(1),f.contents().last()[0].textContent=n}catch(o){}}j>k?f.addClass("inline"):f.removeClass("inline")},over:function(a,b){b.helper.addClass("dragOverDrop")},out:function(a,b){b.helper.removeClass("dragOverDrop")}})},enableDraggables:function(a){this.wordBox.getWordItems().draggable("option","disabled",!a),this.$activity.find(".dragTarget.movable.populated:not(.example)").draggable("option","disabled",!a)},reset:function(){this.$dragTargets.draggable("option","disabled",!0)},close:function(){var a=this;try{a.wordBox.getWordItems().draggable("destroy")}catch(b){}try{a.$wordList.droppable("destroy")}catch(b){}try{a.$dragTargets.draggable("destroy")}catch(b){}try{a.$dragTargets.droppable("destroy")}catch(b){}}},b}(),RCF.Handlers.DraggableCategoriseHandler=function(){function b(a,b,c){if(this.$container=a,this.highlightClass=b,RCF.Utils.isEmpty(c)&&(c=!1),this.removeAfterMove=!c,this.$wordList=a.find(".wordBox"),RCF.Utils.isEmpty(this.$wordList))throw"No wordlist available for the categorise in activity [ "+this.closest(".activity")[0].id+" ]";this._initialize()}return b.prototype={_initialize:function(){this._setupWordBoxDragging(),this._setupWordBoxDropping(),this._setupCategoryDragging(),this._setupCategoryDropping()},_setupWordBoxDragging:function(){var b=this;this.$wordList.find("li.dragItem").draggable({scroll:!0,scrollSensitivity:200,hoverClass:"dragOverDrop",containment:"document",helper:function(){return a(this).clone().removeClass("dragged")},start:function(){var c=a(this),d=c.attr("data-audiolink");b.removeAfterMove&&c.addClass("dragged"),d&&d.length>0&&c.trigger("rcf.play.audio",d)},stop:function(){var c=a(this);b.removeAfterMove&&("Y"==c.data("moved")?c.addClass("dragged"):c.removeClass("dragged").attr("style",""))}})},_setupWordBoxDropping:function(){var a=this;a.$wordList.droppable({cursor:"pointer",tolerance:"intersect",hoverClass:"dragOverDrop",drop:function(b,c){var d=c.draggable,e=d.attr("id"),f=a.$wordList.find("#"+e);f.hide().removeClass("dragged").fadeIn("fast").data("moved","N").attr("style",""),d.data("moved","Y"),d.closest(".category").length>0&&d.data("remove-me",!0),setTimeout(function(){RCF.publish("update.categories.size")},50)},accept:function(b){return b.closest(".dropTarget").length<1||b.closest(".categorise").attr("data-rcfid")!==a.$container.attr("data-rcfid")?!1:!0}})},_setupCategoryDragging:function(){var b=this;try{b.$container.find(".category .dropTarget li.dragItem").draggable("destroy")}catch(c){}b.$container.find(".category .dropTarget li.dragItem").draggable({scroll:!0,scrollSensitivity:100,cursor:"pointer",hoverClass:"dragOverDrop",helper:function(){var c=a(this);c.removeClass("dragged");var d=c.clone().removeClass("dragged");return d.attr("id",d.attr("id")+"_clone").removeClass("dragged"),a(this).addClass("dragged"),b.removeAfterMove&&c.addClass("dragged"),d},start:function(){var b=a(this),c=b.attr("data-audiolink");c&&c.length>0&&b.trigger("rcf.play.audio",c)},stop:function(){var b=a(this);"Y"!=b.data("moved")&&b.removeClass("dragged"),b.closest(".categorise").find(".mark").removeClass("wrong correct"),b.data("remove-me")&&b.remove(),setTimeout(function(){RCF.publish("update.categories.size")},50)}})},_setupCategoryDropping:function(){var b=this;try{b.$container.find(".category .dropTarget").droppable("destroy")}catch(c){}b.$container.find(".category .dropTarget").droppable({accept:function(c){if(c.closest(".categorise").attr("data-rcfid")!==b.$container.attr("data-rcfid"))return!1;var d=c.closest(".dropTarget"),e=d.attr("id"),f=a(this).attr("id"),g=c.attr("data-rcfid"),h=!1;return h=b.removeAfterMove?(c.hasClass("dragItem")||c.hasClass("dragTarget"))&&f!=e:0===a(this).find("li[data-rcfid='"+g+"']").length},hoverClass:"dragOverDrop",revert:"invalid",tolerance:"pointer",drop:function(c,d){var e=d.draggable,f=a(this),g=e.closest(".wordBox").length>0,h=e.closest(".category").length>0,i=null;!b.removeAfterMove&&f.find("#"+e.attr("id")).length>0||(h?i=b.$wordList.find("li[id='"+e.attr("id")+"']"):g&&(i=e),i.data("moved","Y"),f.find("ul").append(e.removeClass("dragged").clone()),b.removeAfterMove&&e.addClass("dragged"),h&&e.data("remove-me",!0),b._setupCategoryDragging(),setTimeout(function(){RCF.publish("update.categories.size")},50))}})}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Handlers=RCF.Handlers||{},RCF.Handlers.DroppableTargetHandler=function(){function b(a){if(this.$activity=a,this.$wordList=a.find("div.wordBox ul"),RCF.Utils.isEmpty(this.$activity))throw"No Activity passed to the DraggableActivity constructor !";if(RCF.Utils.isEmpty(this.$wordList))throw"No WordList inside DraggableActivity Activity !";this._initialize()}return b.prototype={_initialize:function(){var b=this;this.$dropTargets=this.$activity.find(".dragTarget.movable:not(.example)"),this.$activity.find(".dragTarget.example.capitalise").each(function(){b.capitalizeDropTarget(a(this))})},capitalizeDropTarget:function(a){var b="",c=a.contents().last()[0];if(c)try{b=c.textContent,c.textContent=b.charAt(0).toUpperCase()+b.slice(1)}catch(d){}},getDropTarget:function(a){return this.$activity.find(".rcfDroppable[data-rcfid='"+a+"'] .dragTarget.movable")},populateDropTarget:function(a,b){a.removeAttr("data-audiolink").removeAttr("data-audiolinkid");var c=b.width()>a.width()?"inline":"";if(RCF.Utils.isEmpty(b))return void this.clearDropTargets(a);RCF.Utils.containsString(b.html().toLowerCase(),"<img")&&(c=""),b.data("moved","Y"),a.addClass("populated").attr("data-audiolink",b.attr("data-audiolink")||"").attr("data-audiolinkid",b.attr("data-audiolinkid")||"").data("wordItemID",b.attr("data-rcfid")||b.data("wordItemID")).toggleClass("inline",c.length>0);var d=b.html();a.html(d),a.hasClass("capitalise")&&b.contents().last()[0]&&this.capitalizeDropTarget(a)},clearDropTargets:function(a){a.data("user-answer","").data("wordItemID","").data("moved","").removeAttr("data-audiolink").removeAttr("data-audiolinkid").removeClass("selected populated inline").html("")}},b}()}(jQuery,window),function(a,b){b.RCF=b.RCF||{},RCF.Handlers=RCF.Handlers||{},RCF.Handlers.MovableCategoriseHandler=function(){function a(a,b){this.$container=a,this.$wordList=this.$container.find("div.wordBox ul"),this.$wordList.hasClass("randomized")||(this.$wordList.mmRandomize("li").find("li").removeAttr("data-rank"),this.$wordList.addClass("randomized")),this.isComplexCategorise=this.$container.hasClass("complexCategorise"),this.mode=b,this._initialize()}return a.prototype={_initialize:function(){var a=this;"draggable"==a.mode?a._setupDraggableCategorise():a._setupTouchCategorise()},_setupDraggableCategorise:function(){var a=this;a.$container.one("mouseover.rcf.categories",function(){a.draggableHandler=new RCF.Handlers.DraggableCategoriseHandler(a.$container,"selected",a.isComplexCategorise)})},_setupTouchCategorise:function(){var a=this;RCF.Utils.isEmpty(a.clickStickHandler)&&(a.clickStickHandler=new RCF.Handlers.ClickStickCategoriseHandler(a.$container,"selected",!a.isComplexCategorise))}},a}()}(jQuery,window),function(a){window.RCF=window.RCF||{},RCF.Handlers=RCF.Handlers||{},RCF.Handlers.WordSearch=RCF.Handlers.WordSearch||{},RCF.Handlers.WordSearch.Cell=function(){var a=function(){this.DEFAULT="-",this.wordIndex=[],this.value=this.DEFAULT,this.containsWord=!1,this.example=!1,this.isUnwritten=function(){return this.value===this.DEFAULT},this.getWordIndexes=function(){var a="";if(this.wordIndex)for(var b=0;b<this.wordIndex.length;b++)a+="word"+this.wordIndex[b]+" ";return a}};return a}(),RCF.Handlers.WordSearch.Word=function(){var a=function(a,b){this.value=a.word.toUpperCase(),this.example=!!a.example&&"y"==a.example,this.wordIndex=b,this.originalValue=this.value,this.isFound=!1,this.cellsUsed=[],this.isPlaced=!1,this.row=-1,this.col=-1,this.size=-1,this.chars=null,this.init=function(){this.chars=this.value.split(""),this.size=this.chars.length},this.init(),this.containedIn=function(a){a.wordIndex.push(this.wordIndex),a.example||(a.example=this.example),a.containsWord=!0,this.cellsUsed.push(a)},this.checkIfSimilar=function(a){var b=this.originalValue.split("").reverse().join(""),c=this.value.split("").reverse().join("");return this.originalValue==a||this.value==a||b==a||c==a?(this.isFound=!0,!0):!1}};return a}(),RCF.Handlers.WordSearch.WordList=function(){var a=function(a){this.words=[],this.useReverse=!!a&&"y"===a;var b=this;this.loadWords=function(a){var c=JSON.parse(a);if(c.words&&c.words.length>0)for(var d=0;d<c.words.length;d++)b.add(new RCF.Handlers.WordSearch.Word(c.words[d],d))},this.add=function(a){if(this.useReverse&&!a.example&&10*Math.random()>7){for(var b="",c=a.size-1;c>=0;c--)b+=a.value.charAt(c);a.value=b,a.init()}this.words[this.words.length]=a},this.size=function(){return this.words.length},this.get=function(a){return this.words[a]},this.isWordPresent=function(a){for(var b=0;b<this.words.length;b++)if(this.words[b].checkIfSimilar(a))return b;return-1},this.getOriginalWord=function(a){var b=this.isWordPresent(a);return b>-1?this.get(b).originalValue:null}};return a}(),RCF.Handlers.WordSearch.Grid=function(){var a=function(a,b){function c(a,b,c,d){var e=0,f=0,g=c-1,h=d-1,i=0,j=0;switch(b){case"Horizontal":g=c-a.length,e=0,i=1;break;case"Vertical":f=0,h=d-a.length,j=1;break;case"LeftDiagonal":h=d-1,f=a.length-1,j=-1,g=c-a.length,e=0,i=1;break;case"RightDiagonal":f=0,h=d-a.length,j=1,g=c-a.length,e=0,i=1}return{maxX:g,maxY:h,minX:e,minY:f,dx:i,dy:j}}this.cells=null,this.directions=[],this.directions.push("Horizontal"),b&&"y"===b&&this.directions.push("Vertical"),"y"===a&&(this.directions.push("LeftDiagonal"),this.directions.push("RightDiagonal")),this.validGrid=!0,this.initializeGrid=function(a){this.size=a,this.cells=new Array(a);for(var b=0;a>b;b++){this.cells[b]=new Array(a);for(var c=0;a>c;c++){var d=new RCF.Handlers.WordSearch.Cell;this.cells[b][c]=d}}},this.fillGrid=function(a){var b=20,d=[],e=this.size,f=this.size,g=0,h=0,i=0,j=0;this.wordList=a;for(var k=0;k<a.words.length;k++){for(var l=a.words[k].value,m=a.words[k],n=0;b>n;){var o=this.directions[Math.floor(Math.random()*this.directions.length)],p=c(l,o,f,e);if(p.maxX<0||p.maxY<0||p.maxY<p.minY||p.maxX<p.minX){d.push(l);break}i=Math.round(Math.random()*(p.maxX-p.minX)+p.minX),g=i,j=Math.round(Math.random()*(p.maxY-p.minY)+p.minY),h=j;
var q=!0,r=0,s=0,t=null;for(s=0;s<l.length;s++){if(t=this.cells[h][g],!t.isUnwritten()){if(t.value!==l.charAt(s)){q=!1;break}r++}h+=p.dy,g+=p.dx}if(q&&!(r>=l.length)){for(g=i,h=j,s=0;s<l.length;s++)t=this.cells[h][g],t.value=l.charAt(s),m.containedIn(t),m.isPlaced=!0,h+=p.dy,g+=p.dx;break}n++}n>=b&&(d.push(l),this.validGrid=!1)}for(h=0;e>h;h++)for(g=0;f>g;g++)this.cells[h][g].isUnwritten()&&(this.cells[h][g].value=String.fromCharCode(Math.floor(65+26*Math.random())))},this.getHTML=function(){for(var a="<div class='rcfWordSearchGrid "+(this.validGrid?"":"tooSmall")+"'><table class='rcfTableGrid' cellspacing=0 cellpadding=0>",b="",c=this.size,d="grd"+parseInt(100*Math.random()),e=0;c>e;e++){a+="<tr>";for(var f=0;c>f;f++){var g=d+"_r"+e+"c"+f,h=this.cells[e][f],i="";if(h.containsWord)for(var j=h.getWordIndexes().trim().replace(/word/g,""),k=j.split(" "),l=0;l<k.length;l++)i+="|"+this.wordList.words[k[l]].originalValue+"|";b=h.containsWord?"isWord "+h.getWordIndexes():"",b+=h.example?" example ":"",a+="<td id='"+g+"' data-cellid='r"+e+"c"+f+"' class='rcfWSCell "+b+"' data-words='"+i+"'>"+h.value+"</td>"}a+="</td>"}return a+="</table>"+(this.validGrid?"":"<span>Not all words can fit in a grid this small</span>")+"</div>"}};return a}(),RCF.Handlers.WordSearch.SelectionHandler=function(){var b=function(b){var c=this;if(this.$wordSearch=b,this.$startCell=null,this.$currentCell=null,this.selectedWords=[],"y"===b.closest(".wordSearchContainer").attr("data-interactive")){var d=!0,e="mobile"===RCF.Application.getDeviceMode();e&&(d=!1),d&&(d="y"===b.closest(".wordSearchContainer").attr("data-draggable")),d?(this.mouseDown=!1,b.on("mousedown","td",function(d){1==d.which&&(b.find(".ws-start").removeClass("ws-start"),a(this).addClass("ws-start ws-highlight")),c.mouseDown=!0}),b.on("mousemove","td",function(){return c.mouseDown?(c.$currentCell=a(this),RCF.Utils.isEmpty(c.$startCell)&&(c.$startCell=b.find("td.ws-start")),RCF.Utils.isEmpty(c.$startCell)?void(c.mouseDown=!1):void(c.allowSelection()&&(b.find(".ws-glowing").removeClass("ws-glowing"),c.getSelectedCells().addClass("ws-glowing")))):void 0}),b.on("mouseup",function(){c.mouseDown=!1;var a=b.find(".ws-glowing, .ws-highlight");c.makeSelection(a)}),a(document).on("mouseup",function(){var a=b.find(".ws-glowing, .ws-highlight");c.mouseDown&&(c.mouseDown=!1,c.makeSelection(a))})):b.on("click","td",function(){return null===c.$startCell?(c.$startCell=a(this),b.find(".ws-start").removeClass("ws-start"),void c.$startCell.addClass("ws-start ws-highlight")):(c.$currentCell=a(this),c.$currentCell.attr("data-cellid")===c.$startCell.attr("data-cellid")?(c.$startCell.removeClass("ws-start ws-highlight"),void(c.$startCell=null)):(b.find(".ws-highlight:not(.ws-start)").removeClass("ws-highlight"),void(c.allowSelection()&&c.makeSelection(c.getSelectedCells()))))})}};return b.prototype.getSelectedCells=function(){var b=this.getGridSelection(),c=[],d=parseInt(b.currentRow>b.startRow?1:b.currentRow<b.startRow?-1:0),e=parseInt(b.currentCol>b.startCol?1:b.currentCol<b.startCol?-1:0),f="r"+parseInt(b.currentRow)+"c"+parseInt(b.currentCol),g=b.startRow,h=b.startCol;for(c.push("#"+this.$startCell[0].id);;){var i=null;if(g+=d,h+=e,i="r"+parseInt(g)+"c"+parseInt(h),c.push("#"+this.$wordSearch.find("[data-cellid='"+i+"']")[0].id),i===f)break}return a(c.join(","))},b.prototype.setSelections=function(a){this.clearSelections();var b=0;for(var c in a){var d=a[c].id,e=a[c].cells,f=a[c].word;this.getSelectionByWord(f)||(e.data("selectionID",d).addClass("ws-selected"),b++,this.selectedWords.push(a[c]))}this.$wordSearch.data("selectionID",b)},b.prototype.setUserSelections=function(a){this.clearUserSelections(),this.userSelections=a},b.prototype.clearHighlighting=function(){this.$wordSearch.find("td").removeData("selectionID").removeData("selected").removeClass("ws-glowing ws-armed ws-highlight ws-selected")},b.prototype.clearUserSelections=function(){this.userSelections=[]},b.prototype.clearSelections=function(){this.clearHighlighting(),this.selectedWords=[]},b.prototype.getSelection=function(a){for(var b in this.selectedWords)if(this.selectedWords[b].id==a)return this.selectedWords[b];return null},b.prototype.getSelectionByWord=function(a){for(var b in this.selectedWords)if(this.selectedWords[b].word==a)return this.selectedWords[b];return null},b.prototype.removeSelection=function(b){for(var c in this.selectedWords)if(this.selectedWords[c].id==b){var d=this.selectedWords[c].cells;d.removeClass("ws-glowing").each(function(){var c=a(this),d=c.data("selectionID")||"";d=d.indexOf("|")>-1?d.replace("|"+b+"|",""):d.replace(b,""),c.data("selectionID",d),d.length<1&&c.removeClass("ws-selected")}),this.selectedWords.splice(c,1)}},b.prototype.makeSelection=function(b){var c=this.$wordSearch,d=c.data("selectionID")||0,e="",f=this;if(d++,c.data("selectionID",d),b.removeClass("ws-glowing ws-highlight"),b.length>1&&(b.each(function(){var b=a(this),c=b.data("cell");c&&(e+=c.value||"")}),!this.getSelectionByWord(e))){b.each(function(){var b=a(this);if(b.data("cell")){b.addClass("ws-selected");var c=b.data("selectionID")||"";c+="|"+d+"|",b.data("selectionID",c),b.data("selected",!0)}});var g=c.data("wordList"),h=g.getOriginalWord(e)||e;e=h,f.selectedWords.push({id:d,word:e,cells:b}),c.trigger("rcf.selectionChanged",[f.selectedWords])}b.removeClass("ws-start"),c.find("td.ws-start").removeClass("ws-start"),f.$startCell=null},b.prototype.getGridSelection=function(){var a=this,b=/r(\d+)c(\d+)/,c=b.exec(a.$startCell.attr("data-cellid")),d=b.exec(a.$currentCell.attr("data-cellid"));return{startRow:parseInt(c[1]),startCol:parseInt(c[2]),currentRow:parseInt(d[1]),currentCol:parseInt(d[2])}},b.prototype.allowSelection=function(){var a=this.getGridSelection(),b=Math.abs(a.startRow-a.currentRow),c=Math.abs(a.startCol-a.currentCol);return 1>b&&1>c||b>0&&(b===c||1>c)||1>b},b}()}(jQuery);